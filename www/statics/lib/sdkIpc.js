var deviceSdk={initVariable:function(){this.wfs;this.streamHead=1;this.streamType=36;this.motionDetectionFlag=25;this.codeNull=-1;this.codeSucess=0;this.codeJump=101;this.codeError=203;this.httpOk=200;this.encodingMjpeg=3;this.encodingG711A=16;this.encodingG711U=17;this.encodingAAC=21;this.encodingH264=96;this.encodingH265=150;this.playStatus=false;this.audioSwitch=false;this.ptz={stop:0,zoomOut:21,zoomIn:20,top:10,down:11,left:12,right:13,focusOut:23,focusIn:22};deviceSdk.loadingRenderFile();this.clientNum=0;this.monitorPlayNum={v265:0,other:0}},init:function(a){this.videoTags=document.getElementById(a.tags);this.url=a.deviceIp+":"+a.devicePort;this.user=a.user;this.password=a.password;this.stream=a.stream;this.videoCode=a.videoCode;this.audioCode=a.audioCode;this.loginMode=a.loginMode;this.width=a.width;this.height=a.height;this.sessionID=a.sessionID;this.tags=a.tags;this.onCallback=a.onCallback},callHttp:function(b,d,e,a){var c="/api.html?n="+b;$.ajax({type:"POST",url:c,cache:false,contentType:"application/json; charset=utf-8",data:JSON.stringify({api:b,data:d===undefined?null:d}),complete:function(i,h){var g=deviceSdk.codeNull;if(i.status!=deviceSdk.httpOk){return deviceSdk.httpError(a,b)}var f=$.parseJSON(i.responseText);g=f.code=parseInt(f.code);switch(g){case deviceSdk.codeSucess:e&&e(f.data);break;case deviceSdk.codeJump:case deviceSdk.codeError:deviceSdk.httpError(a,b);break}},error:function(){deviceSdk.httpError(a,b)}})},httpError:function(a,b){deviceSdk.playStatus=false;a?a():alert(lang.deviceinfo.labQequestFail+": "+b)},loadingRenderFile:function(){var a=document.createElement("canvas").getContext("webgl2");renderUrl=a?"/statics/lib/super-render20.js":"/statics/lib/super-render10.js";$.getScript(renderUrl)},setInitData:function(b){for(var a in b){deviceSdk[a]=b[a]}},login:function(a,b,c){deviceSdk.callHttp("login",{username:a,password:b},function(d){deviceSdk.sessionID=d.Cookie.split("sessionID=")[1];c&&c()})},getVideoEncoding:function(a){deviceSdk.callHttp("getEncodingPropertyPro",null,a)},getAudioEncoding:function(a){deviceSdk.callHttp("getEncodingProperty2",{streamType:"52"},a)},play:function(c,b,f,e){if(Wfs.isSupported()){var a={openSound:c,aencType:parseInt(this.audioCode),width:this.width,height:this.height,onCallback:deviceSdk.onReceiveMessageCallback,loginMode:this.loginMode,tags:this.tags,id:b,wsId:e},d={action:"play",data:{channel:parseInt(b),stream:parseInt(f),sessionID:deviceSdk.sessionID}};deviceSdk.wfs=new Wfs(a,this.tags);deviceSdk.wfs.attachMedia(this.videoTags,this.url,d,this.videoCode,deviceSdk.clientNum);deviceSdk.clientNum++}},stopVideo:function(a){deviceSdk.closeSocket(a)},playAudio:function(a){if(a==null){return}deviceSdk.wfs.setConfig("openSound",true,a)},stopAudio:function(a){if(a==null){return}deviceSdk.wfs.config[a]&&deviceSdk.wfs.setConfig("openSound",false,a)},setPtz:function(b){var a=b?b:this.ptz.stop;deviceSdk.callHttp("pTZCtrl",{ch:"0",optType:String(a),presetPointIndex:"0",cruiseLineIndex:"0"})},closeSocket:function(a){if(deviceSdk.wfs){deviceSdk.wfs.destroy(a);deviceSdk.wfs.stopWebsocket(a)}$(this.videoTags).hide()},onOpenSocket:function(){},onCloseSocket:function(){$(this.videoTags).hide()},onReceiveMessageCallback:function(a,c,b){$(deviceSdk.videoTags).show();switch(a){case"video":if(c.nbMsg%deviceSdk.motionDetectionFlag===0){}if(c.encodingtype==deviceSdk.encodingMjpeg){alert(lang.videoplay.labNonSupportStreamType);return deviceSdk.closeSocket()}loading(false);deviceSdk.playStatus=true;break;case"code":break;case"open":deviceSdk.onOpenSocket();deviceSdk.playStatus=false;break;case"close":deviceSdk.onCloseSocket();deviceSdk.playStatus=false;break;case"currPbTime":break}deviceSdk.onCallback&&deviceSdk.onCallback(a,c,b)},monitorValueChange:function(c,b,a){Object.defineProperty(c,b,{get:function(){return c.label},set:function(d){if(d){return a(b,d)}}})},enlarge:function(a,d,b){var g=document.getElementById(a),f=document.getElementById(b),i=g.getContext("2d"),c=$(this.videoTags).width(),h=$(this.videoTags).height(),e=this;g.width=c;g.height=h;e.drawRc={};i.strokeStyle="red";if(!d){$("#"+b).attr("style","");return $(g).off("mousedown").off("mouseup").off("mouseout")}$(g).on("contextmenu",function(j){j.preventDefault()}).on("mousedown",function(j){switch(j.button){case 0:e.drawRc.left=e.drawRc.right=j.offsetX;e.drawRc.top=e.drawRc.bottom=j.offsetY;e.bZoomMove=true;$(this).on("mousemove",function(k){e.drawRc.right=k.offsetX;e.drawRc.bottom=k.offsetY;i.clearRect(0,0,g.width,g.height);i.strokeRect(e.drawRc.left,e.drawRc.top,e.drawRc.right-e.drawRc.left,e.drawRc.bottom-e.drawRc.top)});break;case 2:f.style.transform="";g.style.transform="";break}}).on("mouseup",function(j){if(j.button==0){if(j.button!=0||!e.bZoomMove){return}e.drawRc.right=j.offsetX;e.drawRc.bottom=j.offsetY;e.bZoomMove=false;$(this).off("mousemove");i.clearRect(0,0,g.width,g.height);e.zoom(e.drawRc,$("#"+a),$("#"+b))}}).on("mousemove",function(j){$(this).off("mousemove");if(e.bZoomMove){e.bZoomMove=false;i.clearRect(0,0,g.width,g.height);e.zoom(e.drawRc,$("#"+a),$("#"+b))}})},zoom:function(a,f,d){if(a){if(a.left>a.right){var g=a.left;a.left=a.right;a.right=g}if(a.top>a.bottom){var g=a.top;a.top=a.bottom;a.bottom=g}if(a.right-a.left<4||a.bottom-a.top<4){return this.$ele}var h=f[0],l=[1,0,0,1,0,0],m=d.css("transform");if(m!=="none"){l=$.map(m.substr(7,m.lastIndexOf(")")-7).split(","),function(n){return Number(n)})}else{if(l[0]>=10||l[3]>=10){return this.$ele}}var k=parseInt((l[0]-1)*h.width/2),i=parseInt((l[3]-1)*h.height/2),e=parseInt((a.left-l[4]+k)/l[0]),j=parseInt((a.top-l[5]+i)/l[3]),c=h.width/(a.right-a.left),b=h.height/(a.bottom-a.top);l[0]*=c;l[3]*=b;k=parseInt((l[0]-1)*h.width/2);i=parseInt((l[3]-1)*h.height/2);l[4]=0-e*l[0]+k;l[5]=0-j*l[3]+i;a.left=e;a.top=j;a.right=parseInt(e+h.width/l[0]);a.bottom=parseInt(j+h.height/l[3]);d.css("transform","matrix("+l.join(",")+")")}},capture:function(f,h,b,d){if($("#v264"+f).is(":visible")){if(isSafari()){return alert(lang.videoplay.screenshotTips)}var c=document.createElement("canvas"),i=c.getContext("2d"),e=d?d:this.videoTags,a=e.videoWidth,g=e.videoHeight;c.width=a;c.height=g;i.drawImage(e,0,0,a,g);if(c.toDataURL()&&h){h(c.toDataURL())}}else{h265Conver[b].capVideo=true;h265Conver[b].capVideoData="";h265Conver[b].captureId=b;deviceSdk.monitorValueChange(h265Conver[b],"capVideoData",function(j,k){if(k&&h){h(k)}})}},errorCode:function(a){var b="";switch(a){case 4004:b=lang.previewBitstreamDropping;break}b&&alert(b)}};