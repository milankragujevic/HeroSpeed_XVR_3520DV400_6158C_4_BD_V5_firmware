(function(f,e,a,b){var c=function(){e.__jdfInst||(e.__jdfInst=new jDateFunctions());return e.__jdfInst};var d=function(j,g){var h=this;this.$ele=j;this.defaults={onSelectDate:function(k){},onChangeMonthYear:function(k){},dateSel:new Date(),bUsePdCal:false,bAwayShow:true,minDate:new Date(0),maxDate:new Date(),hightlightMax:0};this.arrHlDates=[];this.opts=f.extend({},this.defaults,g);this.opts.hlClsName="specialdays";if(this.opts.bUsePdCal){this.$ele.persianDatepicker({alwaysShow:this.opts.bAwayShow?true:false,onSelect:function(l){if(h.opts.onSelectDate){var m=h.$ele.persianDatepicker(true).calendar.find(".selday").data("gdate");var k=new Date(m);h.opts.onSelectDate(k)}},onShow:function(){var k=h.$ele.persianDatepicker(true).calendar},onRender:function(){var o=h.$ele.persianDatepicker(true);if(!o||!o.calendar){return}var k=o.persianDate;if(h._lastDate.month!=k.month||h._lastDate.year!=k.year){h._lastDate=f.extend({},k);h.opts.onChangeMonthYear&&h.opts.onChangeMonthYear(c().getGDate(k))}else{h._lastDate=f.extend({},k)}var n=o.calendar;n.find("div."+h.opts.hlClsName).removeClass(h.opts.hlClsName);for(var l=0;l<h.arrHlDates.length;++l){var m=h.arrHlDates[l].getFullYear()+"/"+(h.arrHlDates[l].getMonth()+1)+"/"+h.arrHlDates[l].getDate();n.find('div.cell[data-gdate="'+m+'"]').addClass(h.opts.hlClsName)}},startDate:c().getPersianDate(this.opts.minDate).toString(),endDate:c().getPersianDate(this.opts.maxDate).toString(),sDate:c().getPersianDate(this.opts.minDate),eDate:c().getPersianDate(this.opts.maxDate),cellWidth:30,cellHeight:32,selectedDate:c().getPersianDate(this.opts.dateSel).toString()});this._lastDate=c().getPersianDate(this.opts.dateSel)}else{var i=this.opts.minDate.getFullYear()+":"+this.opts.maxDate.getFullYear();this.$ele.datepicker({changeMonth:true,changeYear:true,yearRange:i,minDate:this.opts.minDate,maxDate:this.opts.maxDate,gotoCurrent:true,dateFormat:"yy-mm-dd",onChangeMonthYear:function(m,o,n){if(h.opts.onChangeMonthYear){var k=f(this).datepicker("getDate");var l=new Date(m,o-1,1);if(l<k){k.setDate(0);l.setDate(k.getDate())}h.opts.onChangeMonthYear(l)}},onSelect:function(l,k){h.opts.onSelectDate&&h.opts.onSelectDate(new Date(l))},beforeShowDay:function(l){var n=l.getTime();var k=false;for(var m=0;m<h.arrHlDates.length;++m){if(h.arrHlDates[m].getFullYear()===l.getFullYear()&&h.arrHlDates[m].getMonth()===l.getMonth()&&h.arrHlDates[m].getDate()===l.getDate()){k=true;break}}return[n>=h.opts.minDate.getTime()&&n<=h.opts.maxDate.getTime(),k?h.opts.hlClsName:""]},defaultDate:this.opts.dateSel})}};d.prototype={hlDates:function(n){if(this.opts.hightlightMax>0&&n){var g=new Date(this.opts.maxDate.getTime());var m=0;for(var k=n.length-1;k>=0;--k){var l=g.getDate()-n[k].getDate();if(l>=this.opts.hightlightMax){m=k+1;break}else{if(l<0){var j=new Date(n[k].getTime());j.setDate(0);l+=j.getDate();if(l>=this.opts.hightlightMax){m=k+1;break}}}}m>0&&n.splice(0,m)}this.arrHlDates=n?n:[];if(this.opts.bUsePdCal){var h=this.$ele.persianDatepicker(true).getGDate();this.$ele.persianDatepicker(true).render();this.$ele.persianDatepicker(true).setGDate(h)}else{this.refresh()}return this.$ele},getYearMonthStr:function(h){if(this.opts.bUsePdCal){var g=c().getPersianDate(h);return g.year+"/"+g.month}else{return h.getFullYear()+"/"+(h.getMonth()+1)}},getDateStr:function(i,h){h=h||"/";if(this.opts.bUsePdCal){var g=c().getPersianDate(i);return[g.year,g.month,g.date].join(h)}else{return[i.getFullYear(),i.getMonth()+1,i.getDate()].join(h)}},getMonthFirstDay:function(h){if(this.opts.bUsePdCal){var g=c().getPersianDate(h?h:this.getSelDate());g.date=1;var j=c().getGDate(g);j.setHours(0);j.setMinutes(0);j.setSeconds(0);return j}else{var i=new Date(h?h.getTime():this.getSelDate());i.setDate(1);i.setHours(0);i.setMinutes(0);i.setSeconds(0);return i}},getMonthLastDay:function(h){if(this.opts.bUsePdCal){var g=c().getPersianDate(h?h:this.getSelDate());g.addMonth(1);g.date=1;g.addDay(-1);var j=c().getGDate(g);j.setHours(0);j.setMinutes(0);j.setSeconds(0);return j}else{var i=new Date(h?h.getTime():this.getSelDate());i.setMonth(i.getMonth()+1);i.setDate(0);i.setHours(0);i.setMinutes(0);i.setSeconds(0);return i}},refresh:function(){if(this.opts.bUsePdCal){this.$ele.persianDatepicker(true).render()}else{this.$ele.datepicker("refresh");var g=this;setTimeout(function(){g.$ele.find(".ui-state-hover").removeClass("ui-state-hover")},10)}return this.$ele},getSelDate:function(){if(this.opts.bUsePdCal){return this.$ele.persianDatepicker(true).getGDate()}else{return this.$ele.datepicker("getDate")}},setSelDate:function(g){g===undefined&&(g=this.opts.maxDate);if(this.opts.bUsePdCal){this.$ele.persianDatepicker(true).setGDate(g)}else{this.$ele.datepicker("setDate",g);var h=this;setTimeout(function(){h.$ele.find(".ui-state-hover").removeClass("ui-state-hover")},10)}return this.$ele}};f.fn.commCal=function(g){if(this.length===0){console.log("Cal selector empty")}else{if(!this[0].commCalInst){this[0].commCalInst=new d(this,g)}else{if(!g||!this[0].commCalInst[g]){console.log("Func name '"+g+"' not exist.")}else{return this[0].commCalInst[g].apply(this[0].commCalInst,Array.prototype.slice.call(arguments,1))}}}return this}})(jQuery,window,document);