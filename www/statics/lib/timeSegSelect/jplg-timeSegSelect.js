(function(c,i,n,j){var e=function(u,w){if(w){for(var v=0;v<u.length;++v){u[v][0]=k(u[v][0]);u[v][1]=k(u[v][1])}}u.sort(function(A,z){return A[0]===z[0]?(A[1]-z[1]):(A[0]-z[0])});for(var v=u.length-1;v>0;--v){var y=v-1;if(u[v][0]<=u[y][1]){var x=u[y][0],t=Math.max(u[v][1],u[y][1]);u.splice(y,2,[x,t])}}};var k=function(t){return Math.max(0,Math.min(t,1440))};var l=function(u){var v=Math.floor(u/60),t=u%60;v<10&&(v="0"+v);t<10&&(t="0"+t);return v+":"+t};var m=function(w,x,u,t){w=parseInt(w,10),x=parseInt(x,10);var v="left:"+(w/14.4)+"%;width:"+Math.max((x-w)/14.4,1)+"%;;background-color:"+u+";height:"+t+"px;";return'        <div class="timeSel-seg" style="'+v+'">            <span class="ui-icon ui-icon-arrowthick-2-e-w timeSel-leftDrag"></span>            <span class="ui-icon ui-icon-arrowthick-2-e-w timeSel-RightDrag"></span>        </div>'};var f=function(z){var u=c(this);if(u.attr("timesel-disabled")=="true"){return}var w=u.parents("div.timeSel-Main").parent();var y=w[0].timeSegInst;var v=u.attr("timesel-day"),t=u.attr("timesel-cname");if(!c(z.target).hasClass("timeSel-tdSel")||!y.opts.onDrawBegin(v,t)){return}var B=z.clientX-u.offset().left;var C=Math.min(Math.max(0,Math.floor(B/y.opts.width*1440)),1440-y.opts.newSegLen);y.addCateTimeData(v,t,C,C+y.opts.newSegLen);var A=y.getDtIdx(v,t,C);if(A!==-1){s.call(w.find("td.timeSel-tdSel.timeSel-day"+v+"[timesel-cname='"+t+"']>div")[A],z)}};var s=function(x){var v=c(this).parents("div.timeSel-Main").parent();v.find("td>div.select").removeClass("select");v[0].timeSegInst.mx=x.pageX;v[0].timeSegInst.backup();var y=c(this).addClass("select drag").parent("td");if(y.attr("timesel-disabled")=="true"){return}var w=y.attr("timesel-day"),u=y.attr("timesel-cname"),t=c(this).index();v[0].timeSegInst.refresh(w,u,t)};var r=function(t){c(this).addClass("drag")};var p=function(A){var x=c("div.timeSel-Main").parent();var y=x.find("div.drag");var v=y.parent("td");if(v.attr("timesel-disabled")=="true"){return}if(v.length!=0){var z=x[0].timeSegInst,w=v.attr("timesel-day"),u=v.attr("timesel-cname");var B=z.getCateTimeData(w,u);var t=B.length;e(B);if(!x[0].timeSegInst.opts.onDrawEnd(w,u)){x[0].timeSegInst.rollback()}else{x[0].timeSegInst.opts.onSegChg.call(x[0].timeSegInst,w,u,B)}if(t!==B.length){z.refresh(w,u)}else{x[0].timeSegInst.opts.onSelect&&x[0].timeSegInst.opts.onSelect(w,u,y.index(),y)}}c("table.timeSel-tabMain .drag").removeClass("drag");c("div.timeSel-Main div.timeSel-mvTipContainer").hide()};var g=function(v){var u=c(this);var t=u.attr("cday");u.parents("div.timeSel-Main").find("div.timeSel-dlgCopy").show().position({of:u,at:"left",my:"right"}).attr("cday",t).find("input").prop("disabled",false).prop("checked",false).filter("[day='"+t+"']").prop("disabled",true).prop("checked",true)};var o=function(v){var u=c(this);var t=u.parents("div.timeSel-dlgCopy");t.find("input:enabled").prop("checked",u.prop("checked"))};var b=function(z){var A=c(this);var u=A.parents("div.timeSel-dlgCopy");var C=u.find("input[day]:enabled:checked");if(C.length>0){var v=u.parents("div.timeSel-Main").parent();var D=parseInt(u.find("input:disabled").attr("day"),10);var y=v[0].timeSegInst;for(var x=0;x<C.length;++x){var B=parseInt(C.eq(x).attr("day"),10);for(var w=0;w<y.opts.cate.length;++w){var t=y.getCateTimeData(D,y.opts.cate[w]["name"]);y.setCateTimeData(B,y.opts.cate[w]["name"],t)}}}u.hide()};var d=function(t){c(this).parents("div.timeSel-dlgCopy").hide()};var a=function(t){p()};var h=function(E){var x=(E.which!==j)?E.which:E.button;if(x!=1){return}var y=c("div.timeSel-Main").parent();var z=y.find(".drag");if(z.length===0){return}var C=y[0].timeSegInst;var B=E.pageX-C.mx;var u=z.parents("td").eq(0);var v=parseInt(u.attr("timeSel-day"),10);var t=u.attr("timeSel-cname");var w=C.getCateTimeData(v,t);var H=Math.abs(B);if(H>3){B=B*C.min2axis}else{if(H>1){B*=2}}B=Math.floor(B);if(B===0){return}var A=0,G=1440,F=-1;if(z.length===2){var D=u.find("span.drag").index();F=u.find("div.drag").index();if(D===0){if(F>0){A=w[F-1][1]}G=w[F][1]-1}else{A=w[F][0]+1;if(F<w.length-1){G=w[w.length-1][0]}}w[F][D]=Math.max(A,Math.min(B+w[F][D],G))}else{F=z.index();if(F>0){A=w[F-1][1]}if(F<w.length-1){G=w[w.length-1][0]}w[F][0]+=B;w[F][1]+=B;if(w[F][0]<A){w[F][1]+=A-w[F][0];w[F][0]=A}else{if(w[F][1]>G){w[F][0]-=w[F][1]-G;w[F][1]=G}}}C.refresh(v,t,F);C.mx=E.pageX};var q=function(B,t){this.$ele=B;this.defaults={lang:{week:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],save:"保存",confirm:"确认",cancel:"取消",copyTo:"复制到"},weekOrder:[0,1,2,3,4,5,6],width:"600",height:"16",cate:[],buttons:[],newSegLen:10,enableCopy:true,onSegChg:function(L,M,N){},onSelect:function(M,N,L,O){},onDrawBegin:function(L,M){return true},onDrawEnd:function(L,M){return true}};this.opts=c.extend({},this.defaults,t);this.opts.newSegLen=parseInt(this.opts.newSegLen);this.opts.newSegLen||(this.opts.newSegLen=10);this.min2axis=1440/this.opts.width;this.$ele.html('            <div class="timeSel-Main">                <div class="timeSel-header"></div>                <table class="timeSel-tabMain" cellspacing="0">                    <tr class="timeSel-trTimeHead timeSel-trTemplate">                        <td class="timeSel-tdWeek" rowspan="2"></td>                        <td class="timeSel-tdTimeNum">00</td>                        <td class="timeSel-tdTimeNum"></td>                        <td class="timeSel-tdTimeNum">02</td>                        <td class="timeSel-tdTimeNum"></td>                        <td class="timeSel-tdTimeNum">04</td>                        <td class="timeSel-tdTimeNum"></td>                        <td class="timeSel-tdTimeNum">06</td>                        <td class="timeSel-tdTimeNum"></td>                        <td class="timeSel-tdTimeNum">08</td>                        <td class="timeSel-tdTimeNum"></td>                        <td class="timeSel-tdTimeNum">10</td>                        <td class="timeSel-tdTimeNum"></td>                        <td class="timeSel-tdTimeNum">12</td>                        <td class="timeSel-tdTimeNum"></td>                        <td class="timeSel-tdTimeNum">14</td>                        <td class="timeSel-tdTimeNum"></td>                        <td class="timeSel-tdTimeNum">16</td>                        <td class="timeSel-tdTimeNum"></td>                        <td class="timeSel-tdTimeNum">18</td>                        <td class="timeSel-tdTimeNum"></td>                        <td class="timeSel-tdTimeNum">20</td>                        <td class="timeSel-tdTimeNum"></td>                        <td class="timeSel-tdTimeNum">22</td>                        <td class="timeSel-tdTimeNum"></td>                        <td class="timeSel-tdTimeNum">24</td>                    </tr>                    <tr class="timeSel-trScale timeSel-trTemplate">                        <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="vhide"></td>                    </tr>                    <tr class="timeSel-trSel timeSel-trTemplate">                        <td class="vhide"></td>                        <td class="timeSel-tdSel" colspan="24" style="overflow:hidden;"></td>                        <td class="vhide"></td>                    </tr>                    <tr><td class="timeSel-footer" colspan="26"></td></tr>                </table>                <div class="timeSel-mvTipContainer timeSel-left"><div class="timeSel-mvTip"></div></div>                <div class="timeSel-mvTipContainer timeSel-right"><div class="timeSel-mvTip"></div></div>                <div class="timeSel-dlgCopy">                    <table>                        <tr>                            <td colspan="2">                                <label>'+this.opts.lang.copyTo+'</label>                            </td>                            <td>                                <label><input class="timeSel-cpyChkAll" type="checkbox" />'+this.opts.lang.selectAll+'</label>                            </td>                        </tr>                        <tr><td colspan="3" class="timeSel-cpySep"><div class="timeSel-cpySep"></div></td></tr>                        <tr>                            <td colspan="3" class="timeSel-cpyFooter">                                <button type="button" class="ui-button ui-widget ui-corner-all timeSel-btnCpyOk">'+this.opts.lang.confirm+'</button>                                <button type="button" class="ui-button ui-widget ui-corner-all timeSel-btnCpyCancle">'+this.opts.lang.cancel+'</button>                            </td>                        </tr>                    </table>                </div>            </div>            <div class="time-popup-block J-time-popup-block">            <div class="time-popup">                <div class="popup-header">                    <span class="ui-icon ui-icon-close pointer J-close-popup"></span>                </div>                <div class="hide popup-top-content J-check-type">                    <label><input type="checkbox" class="J-check-all" name="chkAll">'+this.opts.lang.allchannel+'</label>                </div>                <div class="popup-bottom-content J-time-edit">                    <input type=" text" min="0" max="23" def="0" maxlength="3" class="iptHour">&nbsp;:&nbsp;                    <input type="text" min="0" max="59" def="0" maxlength="3" class="iptMin">&nbsp;&nbsp;-&nbsp;&nbsp;                    <input type="text" min="0" max="24" def="0" maxlength="3" class="iptHour">&nbsp;:&nbsp;                    <input type="text" min="0" max="59" def="0" maxlength="3" class="iptMin">                </div>                <div class="btns popup-foot">                    <label onclick="onDelSegClk();" class="first pointer J-del-of-in">'+this.opts.lang.del+'</label>                    <label onclick="onSaveSegClk();" class="pointer J-save-of-in">'+this.opts.lang.save+"</label>                </div>            </div>        </div>            ");var G=this.opts.width/24;var v=this.$ele.find("tr");var A=this.$ele.find("table.timeSel-tabMain").css("min-width",G*26).find("tr:last");var J=this.$ele.find("td.timeSel-footer");var E=null,D=this.$ele.find("div.timeSel-dlgCopy tr:last");this.timeDt=new Array(7);for(var H=0;H<this.opts.weekOrder.length;++H){var y=v.eq(0).clone().removeClass("timeSel-trTemplate");var x=v.eq(1).clone().removeClass("timeSel-trTemplate");y.find(".timeSel-tdWeek").html(this.opts.lang["week"][this.opts.weekOrder[H]]);y.find("td.timeSel-tdTimeNum").width(G);y.insertBefore(A);x.insertBefore(A);this.name2idx={};this.timeDt[this.opts.weekOrder[H]]=new Array(this.opts.cate.length);var C=true;for(var F=0;F<this.opts.cate.length;++F){var w=v.eq(2).clone().removeClass("timeSel-trTemplate").css("height",this.opts.height+"px");w.find(".timeSel-tdSel").attr("timeSel-bgc",this.opts.cate[F]["color"]).attr("timeSel-cname",this.opts.cate[F]["name"]).attr("timesel-disabled",this.opts.cate[F]["disabled"]).attr("timeSel-day",this.opts.weekOrder[H]).addClass("timeSel-day"+this.opts.weekOrder[H]);w.insertBefore(A);if(H===0){if(this.opts.cate[F]["disabled"]){c('<div class="timeSel-footerBlk"><div class="timeSel-clrIcon" style="background-color:'+this.opts.cate[F]["color"]+';"></div><span style="color:'+this.opts.cate[F]["color"]+';">'+this.opts.cate[F]["name"]+"</span></div>").appendTo(J)}else{c('<div class="timeSel-footerBlk"><div class="timeSel-clrIcon" style="background-color:'+this.opts.cate[F]["color"]+';"></div><span>'+this.opts.cate[F]["name"]+"</span></div>").appendTo(J)}}if(F===0){w.find("td:last").attr("rowspan",this.opts.cate.length).removeClass("vhide").addClass("ui-state-error-text").html('<span class="ui-icon ui-icon-copy timeSel-btnCopy"></span>').find("span").attr({cday:this.opts.weekOrder[H],title:this.opts.lang.copyTo})}this.name2idx[this.opts.cate[F]["name"]]=F;this.timeDt[this.opts.weekOrder[H]][F]=[]}var u=H%3;if(u===0){E&&E.insertBefore(D);E=c("<tr><td><label></label></td><td><label></label></td><td><label></label></td></tr>")}E.children().eq(u).children().html('<input type="checkbox" day="'+this.opts.weekOrder[H]+'" />'+this.opts.lang.week[this.opts.weekOrder[H]])}E&&E.insertBefore(D);var I="";for(var H=0;H<this.opts.buttons.length;++H){var z=this.opts.buttons[H];I+='<button class="ui-button ui-widget ui-corner-all '+(z.classes?z.classes:"")+'">'+z.name+"</button>"}var K=this.$ele.find(".timeSel-header").html(I).find("button");for(var H=0;H<K.length;++H){this.opts.buttons[H]["click"]&&K.eq(H).click(this.opts.buttons[H]["click"])}};c("body").on("mousedown","td.timeSel-tdSel",f);c("body").on("mousedown","td.timeSel-tdSel>div.timeSel-seg",s);c("body").on("mousedown","td.timeSel-tdSel>div.timeSel-seg>span.ui-icon",r);c("body").on("click","div.timeSel-Main tr.timeSel-trSel span.timeSel-btnCopy",g);c("body").on("click","div.timeSel-Main div.timeSel-dlgCopy input.timeSel-cpyChkAll",o);c("body").on("click","div.timeSel-Main div.timeSel-dlgCopy .timeSel-btnCpyOk",b);c("body").on("click","div.timeSel-Main div.timeSel-dlgCopy .timeSel-btnCpyCancle",d);c("body").on("mouseup",p);c(n).on("mouseleave",a);c(n).on("mousemove",h);q.prototype={getCateTimeData:function(t,u){t=parseInt(t,10);var v=this.getCateIdx(u);if(t>=0&&t<7&&v>=0&&v<this.opts.cate.length){return this.timeDt[t][v]}return[]},setCateTimeData:function(t,w,u){var v=this.getCateTimeData(t,w);v.splice(0,v.length);c.extend(true,v,u);e(v,true);this.opts.onSegChg.call(this,t,w,v);this.refresh(t,w);return this.$ele},backup:function(){this.bk=c.extend(true,[],this.timeDt)},rollback:function(){this.timeDt.splice(0,this.timeDt.length);if(this.bk){c.extend(true,this.timeDt,this.bk)}this.refresh()},clearAll:function(){this.clear();return this.$ele},clear:function(t,v){if(t===j){for(var u=0;u<this.opts.weekOrder.length;++u){this.clear(u)}}else{if(v===j){for(var u=0;u<this.opts.cate.length;++u){this.clear(t,u)}}else{var x=this.getCateTimeData(t,v);x.splice(0,x.length);var w=this.getCateIdx(v);this.refresh(t,v)}}return this.$ele},getCateIdx:function(t){if(c.isNumeric(t)){return parseInt(t,10)}else{return this.name2idx[t]}},getCateName:function(t){if(c.isNumeric(t)){return this.opts[t]["name"]}return t},getDtIdx:function(t,w,u){var x=this.getCateTimeData(t,w);for(var v=0;v<x.length;++v){if(u>=x[v][0]&&u<=x[v][1]){return v}}return -1},addCateTimeData:function(t,w,u,x){var v=this.getCateTimeData(t,w);u=k(u);x=k(x);v.push([u,x]);e(v);this.opts.onSegChg.call(this,t,w,v);this.refresh(t,w);return this.$ele},delCateTimeData:function(t,x,v){var w=this.getCateTimeData(t,x);var u=true;if(v===j){w.splice(0,w.length)}else{v=parseInt(v,10);if(v>=0&&v<w.length){w.splice(v,1)}else{u=false}}if(u){this.refresh(t,x)}return this.$ele},delCateTimeInTime:function(t,y,u,z){var x=this.getCateTimeData(t,y);u=k(u);z=k(z);var w=false;for(var v=x.length-1;v>=0;--v){if(x[v][0]>=u&&x[v][1]<=z){x.splice(v,1);w=true}else{if(x[v][0]>=u&&x[v][0]<z){x[v][0]=z;w=true}else{if(x[v][1]<=z&&x[v][1]>u){x[v][1]=u;w=true}else{if(u>=x[v][0]&&z<=x[v][1]){x.splice(v+1,0,[z,x[v][1]]);x[v][1]=u;w=true}}}}}w&&this.refresh(t,y);return this.$ele},refresh:function(z,y,B){if(z===j){for(var x=0;x<7;++x){this.refresh(x)}}else{if(y===j){for(var x=0;x<this.opts.cate.length;++x){this.refresh(z,x)}}else{if(!c.isNumeric(B)){var t=this.getCateIdx(y);if(t!==j){if(this.timeDt[z][t].length===0){c("div.timeSel-Main td.timeSel-tdSel.timeSel-day"+z+"[timesel-cname='"+this.opts.cate[t]["name"]+"'] div").remove()}else{for(var x=0;x<this.timeDt[z][t].length;++x){this.refresh(z,t,x)}}}}else{var t=this.getCateIdx(y);if(t!==j){var u=this.$ele.find("td.timeSel-day"+z+"[timeSel-cname='"+this.opts.cate[t]["name"]+"']");var E=u.find("div.timeSel-seg");var v=u.attr("timeSel-bgc");var A=this.getCateTimeData(z,y),D=null;if(E.length<=B){D=c(m(A[B][0],A[B][1],v,this.opts.height));D.appendTo(u)}else{D=E.eq(B);D.css({left:A[B][0]/14.4+"%",width:Math.max((A[B][1]-A[B][0])/14.4,1)+"%"});if(E.length>=A.length){for(var x=E.length-1;x>=A.length;--x){E.eq(x).remove()}}}var w=false,C=false;if(D.children().eq(0).hasClass("drag")){w=true}else{if(D.children().eq(1).hasClass("drag")){C=true}else{if(D.hasClass("drag")){w=C=true}}}if(w){c("div.timeSel-Main div.timeSel-mvTipContainer.timeSel-left").show().position({of:D.children()[0],my:"bottom",at:"top"}).children().text(l(A[B][0]))}else{c("div.timeSel-Main div.timeSel-mvTipContainer.timeSel-left").hide()}if(C){c("div.timeSel-Main div.timeSel-mvTipContainer.timeSel-right").show().position({of:D.children()[1],my:"bottom",at:"top"}).children().text(l(A[B][1]))}else{c("div.timeSel-Main div.timeSel-mvTipContainer.timeSel-right").hide()}}}}}return this.$ele},showTimeTip:function(t){return this.$ele},destroy:function(){var t=this.$ele;t[0].timeSegInst=null;t.html("");return t}};c.fn.timeSegSelect=function(t){if(!this[0].timeSegInst){this[0].timeSegInst=new q(this,t)}else{if(!t||!this[0].timeSegInst[t]){console.log("Func name '"+t+"' not exist.")}else{return this[0].timeSegInst[t].apply(this[0].timeSegInst,Array.prototype.slice.call(arguments,1))}}return this}})(jQuery,window,document);