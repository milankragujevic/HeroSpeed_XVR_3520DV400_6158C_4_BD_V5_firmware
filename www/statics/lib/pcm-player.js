function PCMPlayer(a){!isSafari()&&this.init(a)}PCMPlayer.prototype.init=function(a){var b={encoding:"16bitInt",channels:1,sampleRate:8000,flushingTime:1000};this.option=$.extend(b,a);this.samples=new Float32Array();this.flush=this.flush.bind(this);this.interval=setInterval(this.flush,this.option.flushingTime);this.maxValue=this.getMaxValue();this.typedArray=this.getTypedArray();this.createContext()};PCMPlayer.prototype.getMaxValue=function(){var a={"8bitInt":128,"16bitInt":32768,"32bitInt":2147483648,"32bitFloat":1};return a[this.option.encoding]?a[this.option.encoding]:a["16bitInt"]};PCMPlayer.prototype.getTypedArray=function(){var a={"8bitInt":Int8Array,"16bitInt":Int16Array,"32bitInt":Int32Array,"32bitFloat":Float32Array};return a[this.option.encoding]?a[this.option.encoding]:a["16bitInt"]};PCMPlayer.prototype.createContext=function(){if(!window.AudioContext&&!window.webkitAudioContext){this.audioNoSupport=true;return}this.audioCtx=new (window.AudioContext||window.webkitAudioContext)();this.gainNode=this.audioCtx.createGain();this.gainNode.gain.value=1;this.gainNode.connect(this.audioCtx.destination);this.startTime=this.audioCtx.currentTime};PCMPlayer.prototype.isTypedArray=function(a){return(a.byteLength&&a.buffer&&a.buffer.constructor==ArrayBuffer)};PCMPlayer.prototype.feed=function(b){if(!this.isTypedArray(b)||this.audioNoSupport){return}b=this.getFormatedValue(b);var a=new Float32Array(this.samples.length+b.length);a.set(this.samples,0);a.set(b,this.samples.length);this.samples=a};PCMPlayer.prototype.getFormatedValue=function(c){var c=new this.typedArray(c.buffer),a=new Float32Array(c.length),b;for(b=0;b<c.length;b++){a[b]=c[b]/this.maxValue}return a};PCMPlayer.prototype.volume=function(a){this.gainNode.gain.value=a};PCMPlayer.prototype.destroy=function(){if(isSafari()){return}if(this.interval){clearInterval(this.interval)}this.samples=null;this.audioCtx.close();this.audioCtx=null};PCMPlayer.prototype.flush=function(){if(!this.samples.length){return}var g=this.audioCtx.createBufferSource(),e=this.samples.length/this.option.channels,d=this.audioCtx.createBuffer(this.option.channels,e,this.option.sampleRate),a,c,h,b,f;for(c=0;c<this.option.channels;c++){a=d.getChannelData(c);h=c;f=50;for(b=0;b<e;b++){a[b]=this.samples[h];if(b<50){a[b]=(a[b]*b)/50}if(b>=(e-51)){a[b]=(a[b]*f--)/50}h+=this.option.channels}}if(this.startTime<this.audioCtx.currentTime){this.startTime=this.audioCtx.currentTime}g.buffer=d;g.connect(this.gainNode);g.start(this.startTime);this.startTime+=d.duration;this.samples=new Float32Array()};