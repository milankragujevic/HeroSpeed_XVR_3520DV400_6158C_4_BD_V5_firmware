(function(b){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=b()}else{if(typeof define==="function"&&define.amd){define([],b)}else{var a;if(typeof window!=="undefined"){a=window}else{if(typeof global!=="undefined"){a=global}else{if(typeof self!=="undefined"){a=self}else{a=this}}}a.AV=b()}}})(function(){var d,b,a;return(function c(f,k,h){function g(q,n){if(!k[q]){if(!f[q]){var m=typeof require=="function"&&require;if(!n&&m){return m(q,!0)}if(e){return e(q,!0)}var p=new Error("Cannot find module '"+q+"'");throw p.code="MODULE_NOT_FOUND",p}var i=k[q]={exports:{}};f[q][0].call(i.exports,function(l){var o=f[q][1][l];return g(o?o:l)},i,i.exports,c,f,k,h)}return k[q].exports}var e=typeof require=="function"&&require;for(var j=0;j<h.length;j++){g(h[j])}return g})({1:[function(f,g,e){(function(){var h,n,p,o,q,m,i,l=function(r,s){return function(){return r.apply(s,arguments)}},k=function(u,s){for(var r in s){if(j.call(s,r)){u[r]=s[r]}}function t(){this.constructor=u}t.prototype=s.prototype;u.prototype=new t();u.__super__=s.prototype;return u},j={}.hasOwnProperty;q=f("./core/events");i=f("./sources/node/http");m=f("./sources/node/file");n=f("./sources/buffer");o=f("./demuxer");p=f("./decoder");h=(function(s){k(r,s);function r(t){this.source=t;this._decode=l(this._decode,this);this.findDecoder=l(this.findDecoder,this);this.probe=l(this.probe,this);this.buffered=0;this.duration=null;this.format=null;this.metadata=null;this.active=false;this.demuxer=null;this.decoder=null;this.source.once("data",this.probe);this.source.on("error",(function(u){return function(v){u.emit("error",v);return u.stop()}})(this));this.source.on("progress",(function(u){return function(v){u.buffered=v;return u.emit("buffer",u.buffered)}})(this))}r.fromURL=function(t,u){return new r(new i(t,u))};r.fromFile=function(t){return new r(new m(t))};r.fromBuffer=function(t){return new r(new n(t))};r.prototype.start=function(t){if(this.active){return}if(t!=null){this.shouldDecode=t}if(this.shouldDecode==null){this.shouldDecode=true}this.active=true;this.source.start();if(this.decoder&&this.shouldDecode){return this._decode()}};r.prototype.stop=function(){if(!this.active){return}this.active=false;return this.source.pause()};r.prototype.get=function(t,u){if(t!=="format"&&t!=="duration"&&t!=="metadata"){return}if(this[t]!=null){return u(this[t])}else{this.once(t,(function(v){return function(w){v.stop();return u(w)}})(this));return this.start()}};r.prototype.decodePacket=function(){return this.decoder.decode()};r.prototype.decodeToBuffer=function(w){var v,t,u;u=0;v=[];this.on("data",t=function(x){u+=x.length;return v.push(x)});this.once("end",function(){var A,z,y,x,B;A=new Float32Array(u);B=0;for(y=0,x=v.length;y<x;y++){z=v[y];A.set(z,B);B+=z.length}this.off("data",t);return w(A)});return this.start()};r.prototype.probe=function(t){var u;if(!this.active){return}u=o.find(t);if(!u){return this.emit("error","A demuxer for this container was not found.")}this.demuxer=new u(this.source,t);this.demuxer.on("format",this.findDecoder);this.demuxer.on("duration",(function(v){return function(w){v.duration=w;return v.emit("duration",v.duration)}})(this));this.demuxer.on("metadata",(function(v){return function(w){v.metadata=w;return v.emit("metadata",v.metadata)}})(this));return this.demuxer.on("error",(function(v){return function(w){v.emit("error",w);return v.stop()}})(this))};r.prototype.findDecoder=function(t){var v,u;this.format=t;if(!this.active){return}this.emit("format",this.format);v=p.find(this.format.formatID);if(!v){return this.emit("error","A decoder for "+this.format.formatID+" was not found.")}this.decoder=new v(this.demuxer,this.format);if(this.format.floatingPoint){this.decoder.on("data",(function(w){return function(x){return w.emit("data",x)}})(this))}else{u=Math.pow(2,this.format.bitsPerChannel-1);this.decoder.on("data",(function(w){return function(y){var A,B,z,x,C;A=new Float32Array(y.length);for(B=z=0,x=y.length;z<x;B=++z){C=y[B];A[B]=C/u}return w.emit("data",A)}})(this))}this.decoder.on("error",(function(w){return function(x){w.emit("error",x);return w.stop()}})(this));this.decoder.on("end",(function(w){return function(){return w.emit("end")}})(this));this.emit("decodeStart");if(this.shouldDecode){return this._decode()}};r.prototype._decode=function(){while(this.decoder.decode()&&this.active){continue}if(this.active){return this.decoder.once("data",this._decode)}};r.prototype.destroy=function(){var v,u,t;this.stop();if((v=this.demuxer)!=null){v.off()}if((u=this.decoder)!=null){u.off()}if((t=this.source)!=null){t.off()}return this.off()};return r})(q);g.exports=h}).call(this)},{"./core/events":8,"./decoder":11,"./demuxer":14,"./sources/buffer":31,"./sources/node/file":29,"./sources/node/http":30}],2:[function(f,g,e){(function(){var h,i,j;i=f("./aurora_base");for(h in i){j=i[h];e[h]=j}f("./demuxers/caf");f("./demuxers/m4a");f("./demuxers/aiff");f("./demuxers/wave");f("./demuxers/au");f("./decoders/lpcm");f("./decoders/xlaw")}).call(this)},{"./aurora_base":3,"./decoders/lpcm":12,"./decoders/xlaw":13,"./demuxers/aiff":15,"./demuxers/au":16,"./demuxers/caf":17,"./demuxers/m4a":18,"./demuxers/wave":19}],3:[function(f,g,e){(function(){e.Base=f("./core/base");e.Buffer=f("./core/buffer");e.BufferList=f("./core/bufferlist");e.Stream=f("./core/stream");e.Bitstream=f("./core/bitstream");e.EventEmitter=f("./core/events");e.UnderflowError=f("./core/underflow");e.HTTPSource=f("./sources/node/http");e.FileSource=f("./sources/node/file");e.BufferSource=f("./sources/buffer");e.Demuxer=f("./demuxer");e.Decoder=f("./decoder");e.AudioDevice=f("./device");e.Asset=f("./asset");e.Player=f("./player");e.Filter=f("./filter");e.VolumeFilter=f("./filters/volume");e.BalanceFilter=f("./filters/balance")}).call(this)},{"./asset":1,"./core/base":4,"./core/bitstream":5,"./core/buffer":6,"./core/bufferlist":7,"./core/events":8,"./core/stream":9,"./core/underflow":10,"./decoder":11,"./demuxer":14,"./device":20,"./filter":24,"./filters/balance":25,"./filters/volume":26,"./player":27,"./sources/buffer":31,"./sources/node/file":29,"./sources/node/http":30}],4:[function(f,g,e){(function(){var h,k=function(o,m){for(var l in m){if(j.call(m,l)){o[l]=m[l]}}function n(){this.constructor=o}n.prototype=m.prototype;o.prototype=new n();o.__super__=m.prototype;return o},j={}.hasOwnProperty,i=[].indexOf||function(o){for(var n=0,m=this.length;n<m;n++){if(n in this&&this[n]===o){return n}}return -1};h=(function(){var m;function l(){}m=/\b_super\b/;l.extend=function(t){var n,s,p,o,r,q;n=(function(v){k(u,v);function u(){return u.__super__.constructor.apply(this,arguments)}return u})(this);if(typeof t==="function"){r=Object.keys(n.prototype);t.call(n,n);t={};q=n.prototype;for(o in q){p=q[o];if(i.call(r,o)<0){t[o]=p}}}s=n.__super__;for(o in t){p=t[o];if(typeof p==="function"&&m.test(p)){(function(u,v){return n.prototype[u]=function(){var w,x;x=this._super;this._super=s[u];w=v.apply(this,arguments);this._super=x;return w}})(o,p)}else{n.prototype[o]=p}}return n};return l})();g.exports=h}).call(this)},{}],5:[function(f,g,e){(function(){var h;h=(function(){function i(j){this.stream=j;this.bitPosition=0}i.prototype.copy=function(){var j;j=new i(this.stream.copy());j.bitPosition=this.bitPosition;return j};i.prototype.offset=function(){return 8*this.stream.offset+this.bitPosition};i.prototype.available=function(j){return this.stream.available((j+8-this.bitPosition)/8)};i.prototype.advance=function(j){var k;k=this.bitPosition+j;this.stream.advance(k>>3);return this.bitPosition=k&7};i.prototype.rewind=function(j){var k;k=this.bitPosition-j;this.stream.rewind(Math.abs(k>>3));return this.bitPosition=k&7};i.prototype.seek=function(k){var j;j=this.offset();if(k>j){return this.advance(k-j)}else{if(k<j){return this.rewind(j-k)}}};i.prototype.align=function(){if(this.bitPosition!==0){this.bitPosition=0;return this.stream.advance(1)}};i.prototype.read=function(q,n){var p,m,l,k,j,r,o;if(q===0){return 0}o=q+this.bitPosition;if(o<=8){p=((this.stream.peekUInt8()<<this.bitPosition)&255)>>>(8-q)}else{if(o<=16){p=((this.stream.peekUInt16()<<this.bitPosition)&65535)>>>(16-q)}else{if(o<=24){p=((this.stream.peekUInt24()<<this.bitPosition)&16777215)>>>(24-q)}else{if(o<=32){p=(this.stream.peekUInt32()<<this.bitPosition)>>>(32-q)}else{if(o<=40){m=this.stream.peekUInt8(0)*4294967296;l=this.stream.peekUInt8(1)<<24>>>0;k=this.stream.peekUInt8(2)<<16;j=this.stream.peekUInt8(3)<<8;r=this.stream.peekUInt8(4);p=m+l+k+j+r;p%=Math.pow(2,40-this.bitPosition);p=Math.floor(p/Math.pow(2,40-this.bitPosition-q))}else{throw new Error("Too many bits!")}}}}}if(n){if(o<32){if(p>>>(q-1)){p=((1<<q>>>0)-p)*-1}}else{if(p/Math.pow(2,q-1)|0){p=(Math.pow(2,q)-p)*-1}}}this.advance(q);return p};i.prototype.peek=function(q,n){var p,m,l,k,j,r,o;if(q===0){return 0}o=q+this.bitPosition;if(o<=8){p=((this.stream.peekUInt8()<<this.bitPosition)&255)>>>(8-q)}else{if(o<=16){p=((this.stream.peekUInt16()<<this.bitPosition)&65535)>>>(16-q)}else{if(o<=24){p=((this.stream.peekUInt24()<<this.bitPosition)&16777215)>>>(24-q)}else{if(o<=32){p=(this.stream.peekUInt32()<<this.bitPosition)>>>(32-q)}else{if(o<=40){m=this.stream.peekUInt8(0)*4294967296;l=this.stream.peekUInt8(1)<<24>>>0;k=this.stream.peekUInt8(2)<<16;j=this.stream.peekUInt8(3)<<8;r=this.stream.peekUInt8(4);p=m+l+k+j+r;p%=Math.pow(2,40-this.bitPosition);p=Math.floor(p/Math.pow(2,40-this.bitPosition-q))}else{throw new Error("Too many bits!")}}}}}if(n){if(o<32){if(p>>>(q-1)){p=((1<<q>>>0)-p)*-1}}else{if(p/Math.pow(2,q-1)|0){p=(Math.pow(2,q)-p)*-1}}}return p};i.prototype.readLSB=function(l,k){var j,m;if(l===0){return 0}if(l>40){throw new Error("Too many bits!")}m=l+this.bitPosition;j=(this.stream.peekUInt8(0))>>>this.bitPosition;if(m>8){j|=(this.stream.peekUInt8(1))<<(8-this.bitPosition)}if(m>16){j|=(this.stream.peekUInt8(2))<<(16-this.bitPosition)}if(m>24){j+=(this.stream.peekUInt8(3))<<(24-this.bitPosition)>>>0}if(m>32){j+=(this.stream.peekUInt8(4))*Math.pow(2,32-this.bitPosition)}if(m>=32){j%=Math.pow(2,l)}else{j&=(1<<l)-1}if(k){if(m<32){if(j>>>(l-1)){j=((1<<l>>>0)-j)*-1}}else{if(j/Math.pow(2,l-1)|0){j=(Math.pow(2,l)-j)*-1}}}this.advance(l);return j};i.prototype.peekLSB=function(l,k){var j,m;if(l===0){return 0}if(l>40){throw new Error("Too many bits!")}m=l+this.bitPosition;j=(this.stream.peekUInt8(0))>>>this.bitPosition;if(m>8){j|=(this.stream.peekUInt8(1))<<(8-this.bitPosition)}if(m>16){j|=(this.stream.peekUInt8(2))<<(16-this.bitPosition)}if(m>24){j+=(this.stream.peekUInt8(3))<<(24-this.bitPosition)>>>0}if(m>32){j+=(this.stream.peekUInt8(4))*Math.pow(2,32-this.bitPosition)}if(m>=32){j%=Math.pow(2,l)}else{j&=(1<<l)-1}if(k){if(m<32){if(j>>>(l-1)){j=((1<<l>>>0)-j)*-1}}else{if(j/Math.pow(2,l-1)|0){j=(Math.pow(2,l)-j)*-1}}}return j};return i})();g.exports=h}).call(this)},{}],6:[function(f,g,e){(function(h){(function(){var i;i=(function(){var k,j;function l(m){var n;if(m instanceof Uint8Array){this.data=m}else{if(m instanceof ArrayBuffer||Array.isArray(m)||typeof m==="number"||((n=h.Buffer)!=null?n.isBuffer(m):void 0)){this.data=new Uint8Array(m)}else{if(m.buffer instanceof ArrayBuffer){this.data=new Uint8Array(m.buffer,m.byteOffset,m.length*m.BYTES_PER_ELEMENT)}else{if(m instanceof l){this.data=m.data}else{throw new Error("Constructing buffer with unknown type.")}}}}this.length=this.data.length;this.next=null;this.prev=null}l.allocate=function(m){return new l(m)};l.prototype.copy=function(){return new l(new Uint8Array(this.data))};l.prototype.slice=function(m,n){if(n==null){n=this.length}if(m===0&&n>=this.length){return new l(this.data)}else{return new l(this.data.subarray(m,m+n))}};k=h.BlobBuilder||h.MozBlobBuilder||h.WebKitBlobBuilder;j=h.URL||h.webkitURL||h.mozURL;l.makeBlob=function(n,m){var p;if(m==null){m="application/octet-stream"}try{return new Blob([n],{type:m})}catch(o){}if(k!=null){p=new k;p.append(n);return p.getBlob(m)}return null};l.makeBlobURL=function(n,m){return j!=null?j.createObjectURL(this.makeBlob(n,m)):void 0};l.revokeBlobURL=function(m){return j!=null?j.revokeObjectURL(m):void 0};l.prototype.toBlob=function(){return l.makeBlob(this.data.buffer)};l.prototype.toBlobURL=function(){return l.makeBlobURL(this.data.buffer)};return l})();g.exports=i}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],7:[function(f,g,e){(function(){var h;h=(function(){function i(){this.first=null;this.last=null;this.numBuffers=0;this.availableBytes=0;this.availableBuffers=0}i.prototype.copy=function(){var j;j=new i;j.first=this.first;j.last=this.last;j.numBuffers=this.numBuffers;j.availableBytes=this.availableBytes;j.availableBuffers=this.availableBuffers;return j};i.prototype.append=function(j){if(j){var k;j.prev=this.last;if((k=this.last)!=null){k.next=j}this.last=j;if(this.first==null){this.first=j}this.availableBytes+=j.length;this.availableBuffers++;return this.numBuffers++}};i.prototype.advance=function(){if(this.first){this.availableBytes-=this.first.length;this.availableBuffers--;this.first=this.first.next;return this.first!=null}return false};i.prototype.rewind=function(){var j;if(this.first&&!this.first.prev){return false}this.first=((j=this.first)!=null?j.prev:void 0)||this.last;if(this.first){this.availableBytes+=this.first.length;this.availableBuffers++}return this.first!=null};i.prototype.reset=function(){var j;j=[];while(this.rewind()){continue}return j};return i})();g.exports=h}).call(this)},{}],8:[function(f,g,e){(function(){var h,j,l=function(p,n){for(var m in n){if(i.call(n,m)){p[m]=n[m]}}function o(){this.constructor=p}o.prototype=n.prototype;p.prototype=new o();p.__super__=n.prototype;return p},i={}.hasOwnProperty,k=[].slice;h=f("./base");j=(function(m){l(n,m);function n(){return n.__super__.constructor.apply(this,arguments)}n.prototype.on=function(p,o){var q;if(this.events==null){this.events={}}if((q=this.events)[p]==null){q[p]=[]}return this.events[p].push(o)};n.prototype.off=function(s,q){var p,o,r;if(this.events==null){return}if((r=this.events)!=null?r[s]:void 0){if(q!=null){o=this.events[s].indexOf(q);if(~o){return this.events[s].splice(o,1)}}else{return this.events[s]}}else{if(s==null){return p={}}}};n.prototype.once=function(q,p){var o;return this.on(q,o=function(){this.off(q,o);return p.apply(this,arguments)})};n.prototype.emit=function(){var q,u,s,r,o,t,p;u=arguments[0],q=2<=arguments.length?k.call(arguments,1):[];if(!((t=this.events)!=null?t[u]:void 0)){return}p=this.events[u].slice();for(r=0,o=p.length;r<o;r++){s=p[r];s.apply(this,q)}};return n})(h);g.exports=j}).call(this)},{"./base":4}],9:[function(f,g,e){(function(){var k,j,h,i;j=f("./bufferlist");k=f("./buffer");i=f("./underflow");h=(function(){var n,q,v,t,x,l,y,r,u,p,w,o,s;n=new ArrayBuffer(16);s=new Uint8Array(n);u=new Int8Array(n);w=new Uint16Array(n);y=new Int16Array(n);o=new Uint32Array(n);r=new Int32Array(n);v=new Float32Array(n);if(typeof Float64Array!=="undefined"&&Float64Array!==null){t=new Float64Array(n)}p=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function m(z){this.list=z;this.localOffset=0;this.offset=0}m.fromBuffer=function(z){var A;A=new j;A.append(z);return new m(A)};m.prototype.copy=function(){var z;z=new m(this.list.copy());z.localOffset=this.localOffset;z.offset=this.offset;return z};m.prototype.available=function(z){return z<=this.list.availableBytes-this.localOffset};m.prototype.remainingBytes=function(){return this.list.availableBytes-this.localOffset};m.prototype.advance=function(z){if(!this.available(z)){throw new i()}this.localOffset+=z;this.offset+=z;while(this.list.first&&this.localOffset>=this.list.first.length){this.localOffset-=this.list.first.length;this.list.advance()}return this};m.prototype.rewind=function(z){if(z>this.offset){throw new i()}if(!this.list.first){this.list.rewind();this.localOffset=this.list.first.length}this.localOffset-=z;this.offset-=z;while(this.list.first.prev&&this.localOffset<0){this.list.rewind();this.localOffset+=this.list.first.length}return this};m.prototype.seek=function(z){if(z>this.offset){return this.advance(z-this.offset)}else{if(z<this.offset){return this.rewind(this.offset-z)}}};m.prototype.readUInt8=function(){var z;if(!this.available(1)){throw new i()}z=this.list.first.data[this.localOffset];this.localOffset+=1;this.offset+=1;if(this.localOffset===this.list.first.length){this.localOffset=0;this.list.advance()}return z};m.prototype.peekUInt8=function(A){var z;if(A==null){A=0}if(!this.available(A+1)){throw new i()}A=this.localOffset+A;z=this.list.first;while(z){if(z.length>A){return z.data[A]}A-=z.length;z=z.next}return 0};m.prototype.read=function(z,F){var D,C,B,E,A;if(F==null){F=false}if(F===p){for(D=C=0,E=z;C<E;D=C+=1){s[D]=this.readUInt8()}}else{for(D=B=A=z-1;B>=0;D=B+=-1){s[D]=this.readUInt8()}}};m.prototype.peek=function(z,G,F){var D,C,B,E,A;if(F==null){F=false}if(F===p){for(D=C=0,E=z;C<E;D=C+=1){s[D]=this.peekUInt8(G+D)}}else{for(D=B=0,A=z;B<A;D=B+=1){s[z-D-1]=this.peekUInt8(G+D)}}};m.prototype.readInt8=function(){this.read(1);return u[0]};m.prototype.peekInt8=function(z){if(z==null){z=0}this.peek(1,z);return u[0]};m.prototype.readUInt16=function(z){this.read(2,z);return w[0]};m.prototype.peekUInt16=function(A,z){if(A==null){A=0}this.peek(2,A,z);return w[0]};m.prototype.readInt16=function(z){this.read(2,z);return y[0]};m.prototype.peekInt16=function(A,z){if(A==null){A=0}this.peek(2,A,z);return y[0]};m.prototype.readUInt24=function(z){if(z){return this.readUInt16(true)+(this.readUInt8()<<16)}else{return(this.readUInt16()<<8)+this.readUInt8()}};m.prototype.peekUInt24=function(A,z){if(A==null){A=0}if(z){return this.peekUInt16(A,true)+(this.peekUInt8(A+2)<<16)}else{return(this.peekUInt16(A)<<8)+this.peekUInt8(A+2)}};m.prototype.readInt24=function(z){if(z){return this.readUInt16(true)+(this.readInt8()<<16)}else{return(this.readInt16()<<8)+this.readUInt8()}};m.prototype.peekInt24=function(A,z){if(A==null){A=0}if(z){return this.peekUInt16(A,true)+(this.peekInt8(A+2)<<16)}else{return(this.peekInt16(A)<<8)+this.peekUInt8(A+2)}};m.prototype.readUInt32=function(z){this.read(4,z);return o[0]};m.prototype.peekUInt32=function(A,z){if(A==null){A=0}this.peek(4,A,z);return o[0]};m.prototype.readInt32=function(z){this.read(4,z);return r[0]};m.prototype.peekInt32=function(A,z){if(A==null){A=0}this.peek(4,A,z);return r[0]};m.prototype.readFloat32=function(z){this.read(4,z);return v[0]};m.prototype.peekFloat32=function(A,z){if(A==null){A=0}this.peek(4,A,z);return v[0]};m.prototype.readFloat64=function(z){this.read(8,z);if(t){return t[0]}else{return x()}};x=function(){var E,C,D,z,B,A;z=o[0],D=o[1];if(!D||D===2147483648){return 0}A=1-(D>>>31)*2;E=(D>>>20)&2047;C=D&1048575;if(E===2047){if(C){return NaN}return A*Infinity}E-=1023;B=(C|1048576)*Math.pow(2,E-20);B+=z*Math.pow(2,E-52);return A*B};m.prototype.peekFloat64=function(A,z){if(A==null){A=0}this.peek(8,A,z);if(t){return t[0]}else{return x()}};m.prototype.readFloat80=function(z){this.read(10,z);return l()};l=function(){var C,B,F,E,z,D,A;E=o[0],z=o[1];C=s[9];B=s[8];A=1-(C>>>7)*2;F=((C&127)<<8)|B;if(F===0&&z===0&&E===0){return 0}if(F===32767){if(z===0&&E===0){return A*Infinity}return NaN}F-=16383;D=z*Math.pow(2,F-31);D+=E*Math.pow(2,F-63);return A*D};m.prototype.peekFloat80=function(A,z){if(A==null){A=0}this.peek(10,A,z);return l()};m.prototype.readBuffer=function(D){var B,A,C,z,E;z=k.allocate(D);E=z.data;for(B=A=0,C=D;A<C;B=A+=1){E[B]=this.readUInt8()}return z};m.prototype.peekBuffer=function(E,D){var B,A,C,z,F;if(E==null){E=0}z=k.allocate(D);F=z.data;for(B=A=0,C=D;A<C;B=A+=1){F[B]=this.peekUInt8(E+B)}return z};m.prototype.readSingleBuffer=function(A){var z;z=this.list.first.slice(this.localOffset,A);this.advance(z.length);return z};m.prototype.peekSingleBuffer=function(B,A){var z;z=this.list.first.slice(this.localOffset+B,A);return z};m.prototype.readString=function(A,z){if(z==null){z="ascii"}return q.call(this,0,A,z,true)};m.prototype.peekString=function(B,A,z){if(B==null){B=0}if(z==null){z="ascii"}return q.call(this,B,A,z,false)};q=function(D,A,B,M){var L,K,J,H,N,I,C,z,G,P,O,F,E;B=B.toLowerCase();G=A===null?0:-1;if(A==null){A=Infinity}C=D+A;O="";switch(B){case"ascii":case"latin1":while(D<C&&(I=this.peekUInt8(D++))!==G){O+=String.fromCharCode(I)}break;case"utf8":case"utf-8":while(D<C&&(L=this.peekUInt8(D++))!==G){if((L&128)===0){O+=String.fromCharCode(L)}else{if((L&224)===192){K=this.peekUInt8(D++)&63;O+=String.fromCharCode(((L&31)<<6)|K)}else{if((L&240)===224){K=this.peekUInt8(D++)&63;J=this.peekUInt8(D++)&63;O+=String.fromCharCode(((L&15)<<12)|(K<<6)|J)}else{if((L&248)===240){K=this.peekUInt8(D++)&63;J=this.peekUInt8(D++)&63;H=this.peekUInt8(D++)&63;P=(((L&15)<<18)|(K<<12)|(J<<6)|H)-65536;O+=String.fromCharCode(55296+(P>>10),56320+(P&1023))}}}}}break;case"utf16-be":case"utf16be":case"utf16le":case"utf16-le":case"utf16bom":case"utf16-bom":switch(B){case"utf16be":case"utf16-be":z=false;break;case"utf16le":case"utf16-le":z=true;break;case"utf16bom":case"utf16-bom":if(A<2||(N=this.peekUInt16(D))===G){if(M){this.advance(D+=2)}return O}z=N===65534;D+=2}while(D<C&&(F=this.peekUInt16(D,z))!==G){D+=2;if(F<55296||F>57343){O+=String.fromCharCode(F)}else{if(F>56319){throw new Error("Invalid utf16 sequence.")}E=this.peekUInt16(D,z);if(E<56320||E>57343){throw new Error("Invalid utf16 sequence.")}O+=String.fromCharCode(F,E);D+=2}}if(F===G){D+=2}break;default:throw new Error("Unknown encoding: "+B)}if(M){this.advance(D)}return O};return m})();g.exports=h}).call(this)},{"./buffer":6,"./bufferlist":7,"./underflow":10}],10:[function(f,g,e){(function(){var i,j=function(n,l){for(var k in l){if(h.call(l,k)){n[k]=l[k]}}function m(){this.constructor=n}m.prototype=l.prototype;n.prototype=new m();n.__super__=l.prototype;return n},h={}.hasOwnProperty;i=(function(k){j(l,k);function l(){l.__super__.constructor.apply(this,arguments);this.name="UnderflowError";this.stack=new Error().stack}return l})(Error);g.exports=i}).call(this)},{}],11:[function(f,g,e){(function(){var h,n,l,j,k,m,o=function(s,q){for(var p in q){if(i.call(q,p)){s[p]=q[p]}}function r(){this.constructor=s}r.prototype=q.prototype;s.prototype=new r();s.__super__=q.prototype;return s},i={}.hasOwnProperty;j=f("./core/events");n=f("./core/bufferlist");k=f("./core/stream");h=f("./core/bitstream");m=f("./core/underflow");l=(function(q){var p;o(r,q);function r(s,u){var t;this.demuxer=s;this.format=u;t=new n;this.stream=new k(t);this.bitstream=new h(this.stream);this.receivedFinalBuffer=false;this.waiting=false;this.demuxer.on("cookie",(function(v){return function(x){var w,y;try{return v.setCookie(x)}catch(y){w=y;return v.emit("error",w)}}})(this));this.demuxer.on("data",(function(v){return function(w){t.append(w);if(v.waiting){return v.decode()}}})(this));this.demuxer.on("end",(function(v){return function(){v.receivedFinalBuffer=true;if(v.waiting){return v.decode()}}})(this));this.init()}r.prototype.init=function(){};r.prototype.setCookie=function(s){};r.prototype.readChunk=function(){};r.prototype.decode=function(){var s,v,u,t;this.waiting=!this.receivedFinalBuffer;u=this.bitstream.offset();try{t=this.readChunk()}catch(v){s=v;if(!(s instanceof m)){this.emit("error",s);return false}}if(t){this.emit("data",t);if(this.receivedFinalBuffer){this.emit("end")}return true}else{if(!this.receivedFinalBuffer){this.bitstream.seek(u);this.waiting=true}else{this.emit("end")}}return false};r.prototype.seek=function(t){var s;s=this.demuxer.seek(t);this.stream.seek(s.offset);return s.timestamp};p={};r.register=function(t,s){return p[t]=s};r.find=function(s){return p[s]||null};return r})(j);g.exports=l}).call(this)},{"./core/bitstream":5,"./core/bufferlist":7,"./core/events":8,"./core/stream":9,"./core/underflow":10}],12:[function(f,g,e){(function(){var i,j,l=function(m,n){return function(){return m.apply(n,arguments)}},k=function(p,n){for(var m in n){if(h.call(n,m)){p[m]=n[m]}}function o(){this.constructor=p}o.prototype=n.prototype;p.prototype=new o();p.__super__=n.prototype;return p},h={}.hasOwnProperty;i=f("../decoder");j=(function(m){k(n,m);function n(){this.readChunk=l(this.readChunk,this);return n.__super__.constructor.apply(this,arguments)}i.register("lpcm",n);n.prototype.readChunk=function(){var r,G,F,D,C,E,B,A,z,s,q,x,w,v,u,t,y,p;p=this.stream;E=this.format.littleEndian;r=Math.min(4096,p.remainingBytes());y=r/(this.format.bitsPerChannel/8)|0;if(r<this.format.bitsPerChannel/8){return null}if(this.format.floatingPoint){switch(this.format.bitsPerChannel){case 32:s=new Float32Array(y);for(G=F=0,q=y;F<q;G=F+=1){s[G]=p.readFloat32(E)}break;case 64:s=new Float64Array(y);for(G=D=0,x=y;D<x;G=D+=1){s[G]=p.readFloat64(E)}break;default:throw new Error("Unsupported bit depth.")}}else{switch(this.format.bitsPerChannel){case 8:s=new Int8Array(y);for(G=C=0,w=y;C<w;G=C+=1){s[G]=p.readInt8()}break;case 16:s=new Int16Array(y);for(G=B=0,v=y;B<v;G=B+=1){s[G]=p.readInt16(E)}break;case 24:s=new Int32Array(y);for(G=A=0,u=y;A<u;G=A+=1){s[G]=p.readInt24(E)}break;case 32:s=new Int32Array(y);for(G=z=0,t=y;z<t;G=z+=1){s[G]=p.readInt32(E)}break;default:throw new Error("Unsupported bit depth.")}}return s};return n})(i)}).call(this)},{"../decoder":11}],13:[function(f,g,e){(function(){var i,l,k=function(m,n){return function(){return m.apply(n,arguments)}},j=function(p,n){for(var m in n){if(h.call(n,m)){p[m]=n[m]}}function o(){this.constructor=p}o.prototype=n.prototype;p.prototype=new o();p.__super__=n.prototype;return p},h={}.hasOwnProperty;i=f("../decoder");l=(function(o){var p,n,r,m,q;j(s,o);function s(){this.readChunk=k(this.readChunk,this);return s.__super__.constructor.apply(this,arguments)}i.register("ulaw",s);i.register("alaw",s);q=128;n=15;m=4;r=112;p=132;s.prototype.init=function(){var y,w,v,u,x,z,A;this.format.bitsPerChannel=16;this.table=z=new Int16Array(256);if(this.format.formatID==="ulaw"){for(y=w=0;w<256;y=++w){A=~y;x=((A&n)<<3)+p;x<<=(A&r)>>>m;z[y]=A&q?p-x:x-p}}else{for(y=v=0;v<256;y=++v){A=y^85;x=A&n;u=(A&r)>>>m;if(u){x=(x+x+1+32)<<(u+2)}else{x=(x+x+1)<<3}z[y]=A&q?x:-x}}};s.prototype.readChunk=function(){var w,v,t,y,u,z,x;z=this.stream,x=this.table;u=Math.min(4096,this.stream.remainingBytes());if(u===0){return}t=new Int16Array(u);for(w=v=0,y=u;v<y;w=v+=1){t[w]=x[z.readUInt8()]}return t};return s})(i)}).call(this)},{"../decoder":11}],14:[function(f,g,e){(function(){var l,h,j,k,m=function(q,o){for(var n in o){if(i.call(o,n)){q[n]=o[n]}}function p(){this.constructor=q}p.prototype=o.prototype;q.prototype=new p();q.__super__=o.prototype;return q},i={}.hasOwnProperty;j=f("./core/events");l=f("./core/bufferlist");k=f("./core/stream");h=(function(p){var n;m(o,p);o.probe=function(q){return false};function o(s,q){var r,t;r=new l;r.append(q);this.stream=new k(r);t=false;s.on("data",(function(u){return function(w){var x,v;t=true;r.append(w);try{return u.readChunk(w)}catch(v){x=v;return u.emit("error",x)}}})(this));s.on("error",(function(u){return function(v){return u.emit("error",v)}})(this));s.on("end",(function(u){return function(){if(!t){u.readChunk(q)}return u.emit("end")}})(this));this.seekPoints=[];this.init()}o.prototype.init=function(){};o.prototype.readChunk=function(q){};o.prototype.addSeekPoint=function(s,r){var q;q=this.searchTimestamp(r);return this.seekPoints.splice(q,0,{offset:s,timestamp:r})};o.prototype.searchTimestamp=function(t,v){var s,q,r,u;q=0;s=this.seekPoints.length;if(s>0&&this.seekPoints[s-1].timestamp<t){return s}while(q<s){r=(q+s)>>1;u=this.seekPoints[r].timestamp;if(u<t){q=r+1}else{if(u>=t){s=r}}}if(s>this.seekPoints.length){s=this.seekPoints.length}return s};o.prototype.seek=function(s){var q,r;if(this.format&&this.format.framesPerPacket>0&&this.format.bytesPerPacket>0){r={timestamp:s,offset:this.format.bytesPerPacket*s/this.format.framesPerPacket};return r}else{q=this.searchTimestamp(s);return this.seekPoints[q]}};n=[];o.register=function(q){return n.push(q)};o.find=function(r){var v,s,u,t,q,x,w;w=k.fromBuffer(r);for(t=0,q=n.length;t<q;t++){u=n[t];x=w.offset;try{if(u.probe(w)){return u}}catch(s){v=s}w.seek(x)}return null};return o})(j);g.exports=h}).call(this)},{"./core/bufferlist":7,"./core/events":8,"./core/stream":9}],15:[function(f,g,e){(function(){var j,h,k=function(o,m){for(var l in m){if(i.call(m,l)){o[l]=m[l]}}function n(){this.constructor=o}n.prototype=m.prototype;o.prototype=new n();o.__super__=m.prototype;return o},i={}.hasOwnProperty;h=f("../demuxer");j=(function(l){k(m,l);function m(){return m.__super__.constructor.apply(this,arguments)}h.register(m);m.probe=function(n){var o;return n.peekString(0,4)==="FORM"&&((o=n.peekString(8,4))==="AIFF"||o==="AIFC")};m.prototype.readChunk=function(){var n,p,q,o;if(!this.readStart&&this.stream.available(12)){if(this.stream.readString(4)!=="FORM"){return this.emit("error","Invalid AIFF.")}this.fileSize=this.stream.readUInt32();this.fileType=this.stream.readString(4);this.readStart=true;if((o=this.fileType)!=="AIFF"&&o!=="AIFC"){return this.emit("error","Invalid AIFF.")}}while(this.stream.available(1)){if(!this.readHeaders&&this.stream.available(8)){this.type=this.stream.readString(4);this.len=this.stream.readUInt32()}switch(this.type){case"COMM":if(!this.stream.available(this.len)){return}this.format={formatID:"lpcm",channelsPerFrame:this.stream.readUInt16(),sampleCount:this.stream.readUInt32(),bitsPerChannel:this.stream.readUInt16(),sampleRate:this.stream.readFloat80(),framesPerPacket:1,littleEndian:false,floatingPoint:false};this.format.bytesPerPacket=(this.format.bitsPerChannel/8)*this.format.channelsPerFrame;if(this.fileType==="AIFC"){p=this.stream.readString(4);this.format.littleEndian=p==="sowt"&&this.format.bitsPerChannel>8;this.format.floatingPoint=p==="fl32"||p==="fl64";if(p==="twos"||p==="sowt"||p==="fl32"||p==="fl64"||p==="NONE"){p="lpcm"}this.format.formatID=p;this.len-=4}this.stream.advance(this.len-18);this.emit("format",this.format);this.emit("duration",this.format.sampleCount/this.format.sampleRate*1000|0);break;case"SSND":if(!(this.readSSNDHeader&&this.stream.available(4))){q=this.stream.readUInt32();this.stream.advance(4);this.stream.advance(q);this.readSSNDHeader=true}n=this.stream.readSingleBuffer(this.len);this.len-=n.length;this.readHeaders=this.len>0;this.emit("data",n);break;default:if(!this.stream.available(this.len)){return}this.stream.advance(this.len)}if(this.type!=="SSND"){this.readHeaders=false}}};return m})(h)}).call(this)},{"../demuxer":14}],16:[function(f,g,e){(function(){var i,h,k=function(o,m){for(var l in m){if(j.call(m,l)){o[l]=m[l]}}function n(){this.constructor=o}n.prototype=m.prototype;o.prototype=new n();o.__super__=m.prototype;return o},j={}.hasOwnProperty;h=f("../demuxer");i=(function(o){var m,l;k(n,o);function n(){return n.__super__.constructor.apply(this,arguments)}h.register(n);n.probe=function(p){return p.peekString(0,4)===".snd"};m=[8,8,16,24,32,32,64];m[26]=8;l={1:"ulaw",27:"alaw"};n.prototype.readChunk=function(){var q,p,s,r;if(!this.readHeader&&this.stream.available(24)){if(this.stream.readString(4)!==".snd"){return this.emit("error","Invalid AU file.")}r=this.stream.readUInt32();p=this.stream.readUInt32();s=this.stream.readUInt32();this.format={formatID:l[s]||"lpcm",littleEndian:false,floatingPoint:s===6||s===7,bitsPerChannel:m[s-1],sampleRate:this.stream.readUInt32(),channelsPerFrame:this.stream.readUInt32(),framesPerPacket:1};if(this.format.bitsPerChannel==null){return this.emit("error","Unsupported encoding in AU file.")}this.format.bytesPerPacket=(this.format.bitsPerChannel/8)*this.format.channelsPerFrame;if(p!==4294967295){q=this.format.bitsPerChannel/8;this.emit("duration",p/q/this.format.channelsPerFrame/this.format.sampleRate*1000|0)}this.emit("format",this.format);this.readHeader=true}if(this.readHeader){while(this.stream.available(1)){this.emit("data",this.stream.readSingleBuffer(this.stream.remainingBytes()))}}};return n})(h)}).call(this)},{"../demuxer":14}],17:[function(f,g,e){(function(){var k,h,j,l=function(p,n){for(var m in n){if(i.call(n,m)){p[m]=n[m]}}function o(){this.constructor=p}o.prototype=n.prototype;p.prototype=new o();p.__super__=n.prototype;return p},i={}.hasOwnProperty;h=f("../demuxer");j=f("./m4a");k=(function(m){l(n,m);function n(){return n.__super__.constructor.apply(this,arguments)}h.register(n);n.probe=function(o){return o.peekString(0,4)==="caff"};n.prototype.readChunk=function(){var v,q,o,y,r,w,u,s,C,A,t,p,z,x,B;if(!this.format&&this.stream.available(64)){if(this.stream.readString(4)!=="caff"){return this.emit("error","Invalid CAF, does not begin with 'caff'")}this.stream.advance(4);if(this.stream.readString(4)!=="desc"){return this.emit("error","Invalid CAF, 'caff' is not followed by 'desc'")}if(!(this.stream.readUInt32()===0&&this.stream.readUInt32()===32)){return this.emit("error","Invalid 'desc' size, should be 32")}this.format={};this.format.sampleRate=this.stream.readFloat64();this.format.formatID=this.stream.readString(4);r=this.stream.readUInt32();if(this.format.formatID==="lpcm"){this.format.floatingPoint=Boolean(r&1);this.format.littleEndian=Boolean(r&2)}this.format.bytesPerPacket=this.stream.readUInt32();this.format.framesPerPacket=this.stream.readUInt32();this.format.channelsPerFrame=this.stream.readUInt32();this.format.bitsPerChannel=this.stream.readUInt32();this.emit("format",this.format)}while(this.stream.available(1)){if(!this.headerCache){this.headerCache={type:this.stream.readString(4),oversize:this.stream.readUInt32()!==0,size:this.stream.readUInt32()};if(this.headerCache.oversize){return this.emit("error","Holy Shit, an oversized file, not supported in JS")}}switch(this.headerCache.type){case"kuki":if(this.stream.available(this.headerCache.size)){if(this.format.formatID==="aac "){t=this.stream.offset+this.headerCache.size;if(o=j.readEsds(this.stream)){this.emit("cookie",o)}this.stream.seek(t)}else{v=this.stream.readBuffer(this.headerCache.size);this.emit("cookie",v)}this.headerCache=null}break;case"pakt":if(this.stream.available(this.headerCache.size)){if(this.stream.readUInt32()!==0){return this.emit("error","Sizes greater than 32 bits are not supported.")}this.numPackets=this.stream.readUInt32();if(this.stream.readUInt32()!==0){return this.emit("error","Sizes greater than 32 bits are not supported.")}this.numFrames=this.stream.readUInt32();this.primingFrames=this.stream.readUInt32();this.remainderFrames=this.stream.readUInt32();this.emit("duration",this.numFrames/this.format.sampleRate*1000|0);this.sentDuration=true;q=0;x=0;for(w=u=0,p=this.numPackets;u<p;w=u+=1){this.addSeekPoint(q,x);q+=this.format.bytesPerPacket||j.readDescrLen(this.stream);x+=this.format.framesPerPacket||j.readDescrLen(this.stream)}this.headerCache=null}break;case"info":y=this.stream.readUInt32();A={};for(w=s=0,z=y;0<=z?s<z:s>z;w=0<=z?++s:--s){C=this.stream.readString(null);B=this.stream.readString(null);A[C]=B}this.emit("metadata",A);this.headerCache=null;break;case"data":if(!this.sentFirstDataChunk){this.stream.advance(4);this.headerCache.size-=4;if(this.format.bytesPerPacket!==0&&!this.sentDuration){this.numFrames=this.headerCache.size/this.format.bytesPerPacket;this.emit("duration",this.numFrames/this.format.sampleRate*1000|0)}this.sentFirstDataChunk=true}v=this.stream.readSingleBuffer(this.headerCache.size);this.headerCache.size-=v.length;this.emit("data",v);if(this.headerCache.size<=0){this.headerCache=null}break;default:if(this.stream.available(this.headerCache.size)){this.stream.advance(this.headerCache.size);this.headerCache=null}}}};return n})(h)}).call(this)},{"../demuxer":14,"./m4a":18}],18:[function(f,g,e){(function(){var h,k,l=function(p,n){for(var m in n){if(j.call(n,m)){p[m]=n[m]}}function o(){this.constructor=p}o.prototype=n.prototype;p.prototype=new o();p.__super__=n.prototype;return p},j={}.hasOwnProperty,i=[].indexOf||function(o){for(var n=0,m=this.length;n<m;n++){if(n in this&&this[n]===o){return n}}return -1};h=f("../demuxer");k=(function(v){var x,o,m,t,s,p,n,u,w,y,r;l(q,v);function q(){return q.__super__.constructor.apply(this,arguments)}h.register(q);o=["M4A ","M4P ","M4B ","M4V ","isom","mp42","qt  "];q.probe=function(z){var A;return z.peekString(4,4)==="ftyp"&&(A=z.peekString(8,4),i.call(o,A)>=0)};q.prototype.init=function(){this.atoms=[];this.offsets=[];this.track=null;return this.tracks=[]};s={};n={};t=function(C,D){var F,z,A,B,E;F=[];E=C.split(".").slice(0,-1);for(A=0,B=E.length;A<B;A++){z=E[A];F.push(z);n[F.join(".")]=true}if(s[C]==null){s[C]={}}return s[C].fn=D};m=function(z,A){if(s[z]==null){s[z]={}}return s[z].after=A};q.prototype.readChunk=function(){var A,B,z;this["break"]=false;while(this.stream.available(1)&&!this["break"]){if(!this.readHeaders){if(!this.stream.available(8)){return}this.len=this.stream.readUInt32()-8;this.type=this.stream.readString(4);if(this.len===0){continue}this.atoms.push(this.type);this.offsets.push(this.stream.offset+this.len);this.readHeaders=true}B=this.atoms.join(".");A=s[B];if(A!=null?A.fn:void 0){if(!(this.stream.available(this.len)||B==="mdat")){return}A.fn.call(this);if(B in n){this.readHeaders=false}}else{if(B in n){this.readHeaders=false}else{if(!this.stream.available(this.len)){return}this.stream.advance(this.len)}}while(this.stream.offset>=this.offsets[this.offsets.length-1]){A=s[this.atoms.join(".")];if(A!=null?A.after:void 0){A.after.call(this)}z=this.atoms.pop();this.offsets.pop();this.readHeaders=false}}};t("ftyp",function(){var z;if(z=this.stream.readString(4),i.call(o,z)<0){return this.emit("error","Not a valid M4A file.")}return this.stream.advance(this.len-4)});t("moov.trak",function(){this.track={};return this.tracks.push(this.track)});t("moov.trak.tkhd",function(){this.stream.advance(4);this.stream.advance(8);this.track.id=this.stream.readUInt32();return this.stream.advance(this.len-16)});t("moov.trak.mdia.hdlr",function(){this.stream.advance(4);this.stream.advance(4);this.track.type=this.stream.readString(4);this.stream.advance(12);return this.stream.advance(this.len-24)});t("moov.trak.mdia.mdhd",function(){this.stream.advance(4);this.stream.advance(8);this.track.timeScale=this.stream.readUInt32();this.track.duration=this.stream.readUInt32();return this.stream.advance(4)});x={ulaw:8,alaw:8,in24:24,in32:32,fl32:32,fl64:64};t("moov.trak.mdia.minf.stbl.stsd",function(){var C,D,B,A,z;this.stream.advance(4);D=this.stream.readUInt32();if(this.track.type!=="soun"){return this.stream.advance(this.len-8)}if(D!==1){return this.emit("error","Only expecting one entry in sample description atom!")}this.stream.advance(4);C=this.track.format={};C.formatID=this.stream.readString(4);this.stream.advance(6);this.stream.advance(2);z=this.stream.readUInt16();this.stream.advance(6);C.channelsPerFrame=this.stream.readUInt16();C.bitsPerChannel=this.stream.readUInt16();this.stream.advance(4);C.sampleRate=this.stream.readUInt16();this.stream.advance(2);if(z===1){C.framesPerPacket=this.stream.readUInt32();this.stream.advance(4);C.bytesPerFrame=this.stream.readUInt32();this.stream.advance(4)}else{if(z!==0){this.emit("error","Unknown version in stsd atom")}}if(x[C.formatID]!=null){C.bitsPerChannel=x[C.formatID]}C.floatingPoint=(B=C.formatID)==="fl32"||B==="fl64";C.littleEndian=C.formatID==="sowt"&&C.bitsPerChannel>8;if((A=C.formatID)==="twos"||A==="sowt"||A==="in24"||A==="in32"||A==="fl32"||A==="fl64"||A==="raw "||A==="NONE"){return C.formatID="lpcm"}});t("moov.trak.mdia.minf.stbl.stsd.alac",function(){this.stream.advance(4);return this.track.cookie=this.stream.readBuffer(this.len-4)});t("moov.trak.mdia.minf.stbl.stsd.esds",function(){var z;z=this.stream.offset+this.len;this.track.cookie=q.readEsds(this.stream);return this.stream.seek(z)});t("moov.trak.mdia.minf.stbl.stsd.wave.enda",function(){return this.track.format.littleEndian=!!this.stream.readUInt16()});q.readDescrLen=function(B){var C,A,z;z=0;A=4;while(A--){C=B.readUInt8();z=(z<<7)|(C&127);if(!(C&128)){break}}return z};q.readEsds=function(D){var C,B,A,z;D.advance(4);z=D.readUInt8();A=q.readDescrLen(D);if(z===3){D.advance(2);B=D.readUInt8();if(B&128){D.advance(2)}if(B&64){D.advance(D.readUInt8())}if(B&32){D.advance(2)}}else{D.advance(2)}z=D.readUInt8();A=q.readDescrLen(D);if(z===4){C=D.readUInt8();D.advance(1);D.advance(3);D.advance(4);D.advance(4);z=D.readUInt8();A=q.readDescrLen(D);if(z===5){return D.readBuffer(A)}}return null};t("moov.trak.mdia.minf.stbl.stts",function(){var z,B,A,C;this.stream.advance(4);z=this.stream.readUInt32();this.track.stts=[];for(B=A=0,C=z;A<C;B=A+=1){this.track.stts[B]={count:this.stream.readUInt32(),duration:this.stream.readUInt32()}}return this.setupSeekPoints()});t("moov.trak.mdia.minf.stbl.stsc",function(){var z,B,A,C;this.stream.advance(4);z=this.stream.readUInt32();this.track.stsc=[];for(B=A=0,C=z;A<C;B=A+=1){this.track.stsc[B]={first:this.stream.readUInt32(),count:this.stream.readUInt32(),id:this.stream.readUInt32()}}return this.setupSeekPoints()});t("moov.trak.mdia.minf.stbl.stsz",function(){var z,B,A,C;this.stream.advance(4);this.track.sampleSize=this.stream.readUInt32();z=this.stream.readUInt32();if(this.track.sampleSize===0&&z>0){this.track.sampleSizes=[];for(B=A=0,C=z;A<C;B=A+=1){this.track.sampleSizes[B]=this.stream.readUInt32()}}return this.setupSeekPoints()});t("moov.trak.mdia.minf.stbl.stco",function(){var z,B,A,C;this.stream.advance(4);z=this.stream.readUInt32();this.track.chunkOffsets=[];for(B=A=0,C=z;A<C;B=A+=1){this.track.chunkOffsets[B]=this.stream.readUInt32()}return this.setupSeekPoints()});t("moov.trak.tref.chap",function(){var z,B,A,C;z=this.len>>2;this.track.chapterTracks=[];for(B=A=0,C=z;A<C;B=A+=1){this.track.chapterTracks[B]=this.stream.readUInt32()}});q.prototype.setupSeekPoints=function(){var I,F,C,B,G,E,J,A,L,H,M,O,z,D,N,K;if(!((this.track.chunkOffsets!=null)&&(this.track.stsc!=null)&&(this.track.sampleSize!=null)&&(this.track.stts!=null))){return}z=0;D=0;D=0;N=0;M=0;E=0;K=0;this.track.seekPoints=[];A=this.track.chunkOffsets;H=[];for(I=C=0,G=A.length;C<G;I=++C){J=A[I];for(F=B=0,L=this.track.stsc[z].count;B<L;F=B+=1){this.track.seekPoints.push({offset:E,position:J,timestamp:K});O=this.track.sampleSize||this.track.sampleSizes[M++];E+=O;J+=O;K+=this.track.stts[D].duration;if(D+1<this.track.stts.length&&++N===this.track.stts[D].count){N=0;D++}}if(z+1<this.track.stsc.length&&I+1===this.track.stsc[z+1].first){H.push(z++)}else{H.push(void 0)}}return H};m("moov",function(){var A,B,C,z;if(this.mdatOffset!=null){this.stream.seek(this.mdatOffset-8)}C=this.tracks;for(A=0,B=C.length;A<B;A++){z=C[A];if(!(z.type==="soun")){continue}this.track=z;break}if(this.track.type!=="soun"){this.track=null;return this.emit("error","No audio tracks in m4a file.")}this.emit("format",this.track.format);this.emit("duration",this.track.duration/this.track.timeScale*1000|0);if(this.track.cookie){this.emit("cookie",this.track.cookie)}return this.seekPoints=this.track.seekPoints});t("mdat",function(){var H,B,C,z,E,D,A,F,G;if(!this.startedData){if(this.mdatOffset==null){this.mdatOffset=this.stream.offset}if(this.tracks.length===0){H=Math.min(this.stream.remainingBytes(),this.len);this.stream.advance(H);this.len-=H;return}this.chunkIndex=0;this.stscIndex=0;this.sampleIndex=0;this.tailOffset=0;this.tailSamples=0;this.startedData=true}if(!this.readChapters){this.readChapters=this.parseChapters();if(this["break"]=!this.readChapters){return}this.stream.seek(this.mdatOffset)}D=this.track.chunkOffsets[this.chunkIndex]+this.tailOffset;z=0;if(!this.stream.available(D-this.stream.offset)){this["break"]=true;return}this.stream.seek(D);while(this.chunkIndex<this.track.chunkOffsets.length){E=this.track.stsc[this.stscIndex].count-this.tailSamples;B=0;for(F=C=0,A=E;C<A;F=C+=1){G=this.track.sampleSize||this.track.sampleSizes[this.sampleIndex];if(!this.stream.available(z+G)){break}z+=G;B+=G;this.sampleIndex++}if(F<E){this.tailOffset+=B;this.tailSamples+=F;break}else{this.chunkIndex++;this.tailOffset=0;this.tailSamples=0;if(this.stscIndex+1<this.track.stsc.length&&this.chunkIndex+1===this.track.stsc[this.stscIndex+1].first){this.stscIndex++}if(D+z!==this.track.chunkOffsets[this.chunkIndex]){break}}}if(z>0){this.emit("data",this.stream.readBuffer(z));return this["break"]=this.chunkIndex===this.track.chunkOffsets.length}else{return this["break"]=true}});q.prototype.parseChapters=function(){var L,z,C,G,D,K,J,B,H,F,E,I,A;if(!(((B=this.track.chapterTracks)!=null?B.length:void 0)>0)){return true}z=this.track.chapterTracks[0];H=this.tracks;for(C=0,D=H.length;C<D;C++){A=H[C];if(A.id===z){break}}if(A.id!==z){this.emit("error","Chapter track does not exist.")}if(this.chapters==null){this.chapters=[]}while(this.chapters.length<A.seekPoints.length){J=A.seekPoints[this.chapters.length];if(!this.stream.available(J.position-this.stream.offset+32)){return false}this.stream.seek(J.position);G=this.stream.readUInt16();I=null;if(!this.stream.available(G)){return false}if(G>2){L=this.stream.peekUInt16();if(L===65279||L===65534){I=this.stream.readString(G,"utf16-bom")}}if(I==null){I=this.stream.readString(G,"utf8")}K=(F=(E=A.seekPoints[this.chapters.length+1])!=null?E.timestamp:void 0)!=null?F:A.duration;this.chapters.push({title:I,timestamp:J.timestamp/A.timeScale*1000|0,duration:(K-J.timestamp)/A.timeScale*1000|0})}this.emit("chapters",this.chapters);return true};t("moov.udta.meta",function(){this.metadata={};return this.stream.advance(4)});m("moov.udta.meta",function(){return this.emit("metadata",this.metadata)});y=function(B,z,A){return t("moov.udta.meta.ilst."+B+".data",function(){this.stream.advance(8);this.len-=8;return A.call(this,z)})};r=function(z){return this.metadata[z]=this.stream.readString(this.len,"utf8")};y("©alb","album",r);y("©arg","arranger",r);y("©art","artist",r);y("©ART","artist",r);y("aART","albumArtist",r);y("catg","category",r);y("©com","composer",r);y("©cpy","copyright",r);y("cprt","copyright",r);y("©cmt","comments",r);y("©day","releaseDate",r);y("desc","description",r);y("©gen","genre",r);y("©grp","grouping",r);y("©isr","ISRC",r);y("keyw","keywords",r);y("©lab","recordLabel",r);y("ldes","longDescription",r);y("©lyr","lyrics",r);y("©nam","title",r);y("©phg","recordingCopyright",r);y("©prd","producer",r);y("©prf","performers",r);y("purd","purchaseDate",r);y("purl","podcastURL",r);y("©swf","songwriter",r);y("©too","encoder",r);y("©wrt","composer",r);y("covr","coverArt",function(z){return this.metadata[z]=this.stream.readBuffer(this.len)});w=["Blues","Classic Rock","Country","Dance","Disco","Funk","Grunge","Hip-Hop","Jazz","Metal","New Age","Oldies","Other","Pop","R&B","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death Metal","Pranks","Soundtrack","Euro-Techno","Ambient","Trip-Hop","Vocal","Jazz+Funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound Clip","Gospel","Noise","AlternRock","Bass","Soul","Punk","Space","Meditative","Instrumental Pop","Instrumental Rock","Ethnic","Gothic","Darkwave","Techno-Industrial","Electronic","Pop-Folk","Eurodance","Dream","Southern Rock","Comedy","Cult","Gangsta","Top 40","Christian Rap","Pop/Funk","Jungle","Native American","Cabaret","New Wave","Psychadelic","Rave","Showtunes","Trailer","Lo-Fi","Tribal","Acid Punk","Acid Jazz","Polka","Retro","Musical","Rock & Roll","Hard Rock","Folk","Folk/Rock","National Folk","Swing","Fast Fusion","Bebob","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic Rock","Progressive Rock","Psychedelic Rock","Symphonic Rock","Slow Rock","Big Band","Chorus","Easy Listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber Music","Sonata","Symphony","Booty Bass","Primus","Porn Groove","Satire","Slow Jam","Club","Tango","Samba","Folklore","Ballad","Power Ballad","Rhythmic Soul","Freestyle","Duet","Punk Rock","Drum Solo","A Capella","Euro-House","Dance Hall"];y("gnre","genre",function(z){return this.metadata[z]=w[this.stream.readUInt16()-1]});y("tmpo","tempo",function(z){return this.metadata[z]=this.stream.readUInt16()});y("rtng","rating",function(A){var z;z=this.stream.readUInt8();return this.metadata[A]=z===2?"Clean":z!==0?"Explicit":"None"});u=function(z){this.stream.advance(2);this.metadata[z]=this.stream.readUInt16()+" of "+this.stream.readUInt16();return this.stream.advance(this.len-6)};y("disk","diskNumber",u);y("trkn","trackNumber",u);p=function(z){return this.metadata[z]=this.stream.readUInt8()===1};y("cpil","compilation",p);y("pcst","podcast",p);y("pgap","gapless",p);return q})(h);g.exports=k}).call(this)},{"../demuxer":14}],19:[function(f,g,e){(function(){var h,j,k=function(o,m){for(var l in m){if(i.call(m,l)){o[l]=m[l]}}function n(){this.constructor=o}n.prototype=m.prototype;o.prototype=new n();o.__super__=m.prototype;return o},i={}.hasOwnProperty;h=f("../demuxer");j=(function(m){var l;k(n,m);function n(){return n.__super__.constructor.apply(this,arguments)}h.register(n);n.probe=function(o){return o.peekString(0,4)==="RIFF"&&o.peekString(8,4)==="WAVE"};l={1:"lpcm",3:"lpcm",6:"alaw",7:"ulaw"};n.prototype.readChunk=function(){var p,o,q;if(!this.readStart&&this.stream.available(12)){if(this.stream.readString(4)!=="RIFF"){return this.emit("error","Invalid WAV file.")}this.fileSize=this.stream.readUInt32(true);this.readStart=true;if(this.stream.readString(4)!=="WAVE"){return this.emit("error","Invalid WAV file.")}}while(this.stream.available(1)){if(!this.readHeaders&&this.stream.available(8)){this.type=this.stream.readString(4);this.len=this.stream.readUInt32(true)}switch(this.type){case"fmt ":q=this.stream.readUInt16(true);if(!(q in l)){return this.emit("error","Unsupported format in WAV file.")}this.format={formatID:l[q],floatingPoint:q===3,littleEndian:l[q]==="lpcm",channelsPerFrame:this.stream.readUInt16(true),sampleRate:this.stream.readUInt32(true),framesPerPacket:1};this.stream.advance(4);this.stream.advance(2);this.format.bitsPerChannel=this.stream.readUInt16(true);this.format.bytesPerPacket=(this.format.bitsPerChannel/8)*this.format.channelsPerFrame;this.emit("format",this.format);this.stream.advance(this.len-16);break;case"data":if(!this.sentDuration){o=this.format.bitsPerChannel/8;this.emit("duration",this.len/o/this.format.channelsPerFrame/this.format.sampleRate*1000|0);this.sentDuration=true}p=this.stream.readSingleBuffer(this.len);this.len-=p.length;this.readHeaders=this.len>0;this.emit("data",p);break;default:if(!this.stream.available(this.len)){return}this.stream.advance(this.len)}if(this.type!=="data"){this.readHeaders=false}}};return n})(h)}).call(this)},{"../demuxer":14}],20:[function(f,g,e){(function(){var h,j,l=function(m,n){return function(){return m.apply(n,arguments)}},k=function(p,n){for(var m in n){if(i.call(n,m)){p[m]=n[m]}}function o(){this.constructor=p}o.prototype=n.prototype;p.prototype=new o();p.__super__=n.prototype;return p},i={}.hasOwnProperty;j=f("./core/events");h=(function(o){var m;k(n,o);function n(p,q){this.sampleRate=p;this.channels=q;this.updateTime=l(this.updateTime,this);this.playing=false;this.currentTime=0;this._lastTime=0}n.prototype.start=function(){if(this.playing){return}this.playing=true;if(this.device==null){this.device=n.create(this.sampleRate,this.channels)}if(!this.device){throw new Error("No supported audio device found.")}this._lastTime=this.device.getDeviceTime();this._timer=setInterval(this.updateTime,200);return this.device.on("refill",this.refill=(function(p){return function(q){return p.emit("refill",q)}})(this))};n.prototype.stop=function(){if(!this.playing){return}this.playing=false;this.device.off("refill",this.refill);return clearInterval(this._timer)};n.prototype.destroy=function(){var p;this.stop();return(p=this.device)!=null?p.destroy():void 0};n.prototype.seek=function(p){this.currentTime=p;if(this.playing){this._lastTime=this.device.getDeviceTime()}return this.emit("timeUpdate",this.currentTime)};n.prototype.updateTime=function(){var p;p=this.device.getDeviceTime();this.currentTime+=(p-this._lastTime)/this.device.sampleRate*1000|0;this._lastTime=p;return this.emit("timeUpdate",this.currentTime)};m=[];n.register=function(p){return m.push(p)};n.create=function(r,q){var t,s,p;for(s=0,p=m.length;s<p;s++){t=m[s];if(t.supported){return new t(r,q)}}return null};return n})(j);g.exports=h}).call(this)},{"./core/events":8}],21:[function(f,g,e){(function(){var l,h,k,j,n=function(o,p){return function(){return o.apply(p,arguments)}},m=function(r,p){for(var o in p){if(i.call(p,o)){r[o]=p[o]}}function q(){this.constructor=r}q.prototype=p.prototype;r.prototype=new q();r.__super__=p.prototype;return r},i={}.hasOwnProperty;k=f("../core/events");h=f("../device");l=f("../core/buffer");j=(function(q){var o,r;m(p,q);h.register(p);p.supported=(typeof Audio!=="undefined"&&Audio!==null)&&"mozWriteAudio" in new Audio;function p(t,s){this.sampleRate=t;this.channels=s;this.refill=n(this.refill,this);this.audio=new Audio;this.audio.mozSetup(this.channels,this.sampleRate);this.writePosition=0;this.prebufferSize=this.sampleRate/2;this.tail=null;this.timer=o(this.refill,100)}p.prototype.refill=function(){var v,t,u,s;if(this.tail){s=this.audio.mozWriteAudio(this.tail);this.writePosition+=s;if(this.writePosition<this.tail.length){this.tail=this.tail.subarray(s)}else{this.tail=null}}u=this.audio.mozCurrentSampleOffset();v=u+this.prebufferSize-this.writePosition;if(v>0){t=new Float32Array(v);this.emit("refill",t);s=this.audio.mozWriteAudio(t);if(s<t.length){this.tail=t.subarray(s)}this.writePosition+=s}};p.prototype.destroy=function(){return r(this.timer)};p.prototype.getDeviceTime=function(){return this.audio.mozCurrentSampleOffset()/this.channels};o=function(u,s){var t,v;t=l.makeBlobURL("setInterval(function() { postMessage('ping'); }, "+s+");");if(t==null){return setInterval(u,s)}v=new Worker(t);v.onmessage=u;v.url=t;return v};r=function(s){if(s.terminate){s.terminate();return URL.revokeObjectURL(s.url)}else{return clearInterval(s)}};return p})(k)}).call(this)},{"../core/buffer":6,"../core/events":8,"../device":20}],22:[function(f,g,e){function h(k,l,i,j){this.fromSampleRate=+k;this.toSampleRate=+l;this.channels=i|0;this.inputBufferLength=j;this.initialize()}h.prototype.initialize=function(){if(this.fromSampleRate>0&&this.toSampleRate>0&&this.channels>0){if(this.fromSampleRate==this.toSampleRate){this.resampler=this.bypassResampler;this.ratioWeight=1}else{this.ratioWeight=this.fromSampleRate/this.toSampleRate;if(this.fromSampleRate<this.toSampleRate){this.compileLinearInterpolationFunction();this.lastWeight=1}else{this.compileMultiTapFunction();this.tailExists=false;this.lastWeight=0}var i=(Math.ceil(this.inputBufferLength*this.toSampleRate/this.fromSampleRate/this.channels*1.01)*this.channels)+this.channels;this.outputBuffer=new Float32Array(i);this.lastOutput=new Float32Array(this.channels)}}else{throw (new Error("Invalid settings specified for the resampler."))}};h.prototype.compileLinearInterpolationFunction=function(){var i="var outputOffset = 0;    var bufferLength = buffer.length;    if (bufferLength > 0) {      var weight = this.lastWeight;      var firstWeight = 0;      var secondWeight = 0;      var sourceOffset = 0;      var outputOffset = 0;      var outputBuffer = this.outputBuffer;      for (; weight < 1; weight += "+this.ratioWeight+") {        secondWeight = weight % 1;        firstWeight = 1 - secondWeight;";for(var j=0;j<this.channels;++j){i+="outputBuffer[outputOffset++] = (this.lastOutput["+j+"] * firstWeight) + (buffer["+j+"] * secondWeight);"}i+="}      weight -= 1;      for (bufferLength -= "+this.channels+", sourceOffset = Math.floor(weight) * "+this.channels+"; sourceOffset < bufferLength;) {        secondWeight = weight % 1;        firstWeight = 1 - secondWeight;";for(var j=0;j<this.channels;++j){i+="outputBuffer[outputOffset++] = (buffer[sourceOffset"+((j>0)?(" + "+j):"")+"] * firstWeight) + (buffer[sourceOffset + "+(this.channels+j)+"] * secondWeight);"}i+="weight += "+this.ratioWeight+";        sourceOffset = Math.floor(weight) * "+this.channels+";      }";for(var j=0;j<this.channels;++j){i+="this.lastOutput["+j+"] = buffer[sourceOffset++];"}i+="this.lastWeight = weight % 1;    }    return this.outputBuffer;";this.resampler=Function("buffer",i)};h.prototype.compileMultiTapFunction=function(){var i="var outputOffset = 0;    var bufferLength = buffer.length;    if (bufferLength > 0) {      var weight = 0;";for(var j=0;j<this.channels;++j){i+="var output"+j+" = 0;"}i+="var actualPosition = 0;      var amountToNext = 0;      var alreadyProcessedTail = !this.tailExists;      this.tailExists = false;      var outputBuffer = this.outputBuffer;      var currentPosition = 0;      do {        if (alreadyProcessedTail) {          weight = "+this.ratioWeight+";";for(j=0;j<this.channels;++j){i+="output"+j+" = 0;"}i+="}        else {          weight = this.lastWeight;";for(j=0;j<this.channels;++j){i+="output"+j+" = this.lastOutput["+j+"];"}i+="alreadyProcessedTail = true;        }        while (weight > 0 && actualPosition < bufferLength) {          amountToNext = 1 + actualPosition - currentPosition;          if (weight >= amountToNext) {";for(j=0;j<this.channels;++j){i+="output"+j+" += buffer[actualPosition++] * amountToNext;"}i+="currentPosition = actualPosition;            weight -= amountToNext;          }          else {";for(j=0;j<this.channels;++j){i+="output"+j+" += buffer[actualPosition"+((j>0)?(" + "+j):"")+"] * weight;"}i+="currentPosition += weight;            weight = 0;            break;          }        }        if (weight <= 0) {";for(j=0;j<this.channels;++j){i+="outputBuffer[outputOffset++] = output"+j+" / "+this.ratioWeight+";"}i+="}        else {          this.lastWeight = weight;";for(j=0;j<this.channels;++j){i+="this.lastOutput["+j+"] = output"+j+";"}i+="this.tailExists = true;          break;        }      } while (actualPosition < bufferLength);    }    return this.outputBuffer;";this.resampler=Function("buffer",i)};h.prototype.bypassResampler=function(i){return i};g.exports=h},{}],23:[function(f,g,e){(function(h){(function(){var j,l,m,i,o=function(p,q){return function(){return p.apply(q,arguments)}},n=function(s,q){for(var p in q){if(k.call(q,p)){s[p]=q[p]}}function r(){this.constructor=s}r.prototype=q.prototype;s.prototype=new r();s.__super__=q.prototype;return s},k={}.hasOwnProperty;l=f("../core/events");j=f("../device");m=f("./resampler");i=(function(q){var t,s,r;n(p,q);j.register(p);t=h.AudioContext||h.webkitAudioContext;p.supported=t&&(typeof t.prototype[s="createScriptProcessor"]==="function"||typeof t.prototype[s="createJavaScriptNode"]==="function");r=null;function p(u,v){this.sampleRate=u;this.channels=v;this.refill=o(this.refill,this);this.context=r!=null?r:r=new t;this.deviceSampleRate=this.context.sampleRate;this.bufferSize=Math.ceil(4096/(this.deviceSampleRate/this.sampleRate)*this.channels);this.bufferSize+=this.bufferSize%this.channels;if(this.deviceSampleRate!==this.sampleRate){this.resampler=new m(this.sampleRate,this.deviceSampleRate,this.channels,this.bufferSize)}this.node=this.context[s](4096,this.channels,this.channels);this.node.onaudioprocess=this.refill;this.node.connect(this.context.destination)}p.prototype.refill=function(u){var y,E,C,D,B,A,z,x,v,w,G,F;v=u.outputBuffer;y=v.numberOfChannels;E=new Array(y);for(D=B=0,w=y;B<w;D=B+=1){E[D]=v.getChannelData(D)}C=new Float32Array(this.bufferSize);this.emit("refill",C);if(this.resampler){C=this.resampler.resampler(C)}for(D=A=0,G=v.length;A<G;D=A+=1){for(x=z=0,F=y;z<F;x=z+=1){E[x][D]=C[D*y+x]}}};p.prototype.destroy=function(){return this.node.disconnect(0)};p.prototype.getDeviceTime=function(){return this.context.currentTime*this.sampleRate};return p})(l)}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../core/events":8,"../device":20,"./resampler":22}],24:[function(f,g,e){(function(){var h;h=(function(){function i(k,j){if(k&&j){Object.defineProperty(this,"value",{get:function(){return k[j]}})}}i.prototype.process=function(j){};return i})();g.exports=h}).call(this)},{}],25:[function(f,g,e){(function(){var j,h,k=function(o,m){for(var l in m){if(i.call(m,l)){o[l]=m[l]}}function n(){this.constructor=o}n.prototype=m.prototype;o.prototype=new n();o.__super__=m.prototype;return o},i={}.hasOwnProperty;h=f("../filter");j=(function(l){k(m,l);function m(){return m.__super__.constructor.apply(this,arguments)}m.prototype.process=function(n){var p,o,r,q;if(this.value===0){return}r=Math.max(-50,Math.min(50,this.value));for(p=o=0,q=n.length;o<q;p=o+=2){n[p]*=Math.min(1,(50-r)/50);n[p+1]*=Math.min(1,(50+r)/50)}};return m})(h);g.exports=j}).call(this)},{"../filter":24}],26:[function(f,g,e){(function(){var i,h,k=function(o,m){for(var l in m){if(j.call(m,l)){o[l]=m[l]}}function n(){this.constructor=o}n.prototype=m.prototype;o.prototype=new n();o.__super__=m.prototype;return o},j={}.hasOwnProperty;i=f("../filter");h=(function(m){k(l,m);function l(){return l.__super__.constructor.apply(this,arguments)}l.prototype.process=function(n){var q,o,r,p;if(this.value>=100){return}p=Math.max(0,Math.min(100,this.value))/100;for(q=o=0,r=n.length;o<r;q=o+=1){n[q]*=p}};return l})(i);g.exports=h}).call(this)},{"../filter":24}],27:[function(f,g,e){(function(){var i,p,n,q,h,j,o,m=function(r,s){return function(){return r.apply(s,arguments)}},l=function(u,s){for(var r in s){if(k.call(s,r)){u[r]=s[r]}}function t(){this.constructor=u}t.prototype=s.prototype;u.prototype=new t();u.__super__=s.prototype;return u},k={}.hasOwnProperty;q=f("./core/events");i=f("./asset");o=f("./filters/volume");n=f("./filters/balance");j=f("./queue");p=f("./device");h=(function(s){l(r,s);function r(t){this.asset=t;this.startPlaying=m(this.startPlaying,this);this.playing=false;this.buffered=0;this.currentTime=0;this.duration=0;this.volume=100;this.pan=0;this.metadata={};this.filters=[new o(this,"volume"),new n(this,"pan")];this.asset.on("buffer",(function(u){return function(v){u.buffered=v;return u.emit("buffer",u.buffered)}})(this));this.asset.on("decodeStart",(function(u){return function(){u.queue=new j(u.asset);return u.queue.once("ready",u.startPlaying)}})(this));this.asset.on("format",(function(u){return function(v){u.format=v;return u.emit("format",u.format)}})(this));this.asset.on("metadata",(function(u){return function(v){u.metadata=v;return u.emit("metadata",u.metadata)}})(this));this.asset.on("duration",(function(u){return function(v){u.duration=v;return u.emit("duration",u.duration)}})(this));this.asset.on("error",(function(u){return function(v){return u.emit("error",v)}})(this))}r.fromURL=function(t,u){return new r(i.fromURL(t,u))};r.fromFile=function(t){return new r(i.fromFile(t))};r.fromBuffer=function(t){return new r(i.fromBuffer(t))};r.prototype.preload=function(){if(!this.asset){return}this.startedPreloading=true;return this.asset.start(false)};r.prototype.play=function(){var t;if(this.playing){return}if(!this.startedPreloading){this.preload()}this.playing=true;return(t=this.device)!=null?t.start():void 0};r.prototype.pause=function(){var t;if(!this.playing){return}this.playing=false;return(t=this.device)!=null?t.stop():void 0};r.prototype.togglePlayback=function(){if(this.playing){return this.pause()}else{return this.play()}};r.prototype.stop=function(){var t;this.pause();this.asset.stop();return(t=this.device)!=null?t.destroy():void 0};r.prototype.seek=function(u){var t;if((t=this.device)!=null){t.stop()}this.queue.once("ready",(function(v){return function(){var x,w;if((x=v.device)!=null){x.seek(v.currentTime)}if(v.playing){return(w=v.device)!=null?w.start():void 0}}})(this));u=(u/1000)*this.format.sampleRate;u=this.asset.decoder.seek(u);this.currentTime=u/this.format.sampleRate*1000|0;this.queue.reset();return this.currentTime};r.prototype.startPlaying=function(){var u,t;u=this.queue.read();t=0;this.device=new p(this.format.sampleRate,this.format.channelsPerFrame);this.device.on("timeUpdate",(function(v){return function(w){v.currentTime=w;return v.emit("progress",v.currentTime)}})(this));this.refill=(function(v){return function(B){var y,w,C,A,z,D,F,x,E;if(!v.playing){return}if(!u){u=v.queue.read();t=0}y=0;while(u&&y<B.length){F=Math.min(u.length-t,B.length-y);for(C=A=0,x=F;A<x;C=A+=1){B[y++]=u[t++]}if(t===u.length){u=v.queue.read();t=0}}E=v.filters;for(z=0,D=E.length;z<D;z++){w=E[z];w.process(B)}if(!u){if(v.queue.ended){v.currentTime=v.duration;v.emit("progress",v.currentTime);v.emit("end")}else{v.device.stop()}}}})(this);this.device.on("refill",this.refill);if(this.playing){this.device.start()}return this.emit("ready")};r.prototype.destroy=function(){var u,t;this.stop();if((u=this.device)!=null){u.off()}if((t=this.asset)!=null){t.destroy()}return this.off()};return r})(q);g.exports=h}).call(this)},{"./asset":1,"./core/events":8,"./device":20,"./filters/balance":25,"./filters/volume":26,"./queue":28}],28:[function(f,g,e){(function(){var j,i,l=function(m,n){return function(){return m.apply(n,arguments)}},k=function(p,n){for(var m in n){if(h.call(n,m)){p[m]=n[m]}}function o(){this.constructor=p}o.prototype=n.prototype;p.prototype=new o();p.__super__=n.prototype;return p},h={}.hasOwnProperty;j=f("./core/events");i=(function(m){k(n,m);function n(o){this.asset=o;this.write=l(this.write,this);this.readyMark=32;this.finished=false;this.buffering=true;this.ended=false;this.buffers=[];this.asset.on("data",this.write);this.asset.on("end",(function(p){return function(){return p.ended=true}})(this));this.asset.decodePacket()}n.prototype.write=function(o){if(o){this.buffers.push(o)}if(this.buffering){if(this.buffers.length>=this.readyMark||this.ended){this.buffering=false;return this.emit("ready")}else{return this.asset.decodePacket()}}};n.prototype.read=function(){if(this.buffers.length===0){return null}this.asset.decodePacket();return this.buffers.shift()};n.prototype.reset=function(){this.buffers.length=0;this.buffering=true;return this.asset.decodePacket()};return n})(j);g.exports=i}).call(this)},{"./core/events":8}],29:[function(g,i,e){var l,k,h,f={}.hasOwnProperty,j=function(p,n){for(var m in n){if(f.call(n,m)){p[m]=n[m]}}function o(){this.constructor=p}o.prototype=n.prototype;p.prototype=new o();p.__super__=n.prototype;return p};k=g("../../core/events");l=g("../../core/buffer");h=(function(n){j(m,n);function m(o){this.file=o;if(typeof FileReader==="undefined"||FileReader===null){return this.emit("error","This browser does not have FileReader support.")}this.offset=0;this.length=this.file.size;this.chunkSize=1<<20;this.file[this.slice="slice"]||this.file[this.slice="webkitSlice"]||this.file[this.slice="mozSlice"]}m.prototype.start=function(){if(this.reader){if(!this.active){return this.loop()}}this.reader=new FileReader;this.active=true;this.reader.onload=(function(o){return function(q){var p;p=new l(new Uint8Array(q.target.result));o.offset+=p.length;o.emit("data",p);o.active=false;if(o.offset<o.length){return o.loop()}}})(this);this.reader.onloadend=(function(o){return function(){if(o.offset===o.length){o.emit("end");return o.reader=null}}})(this);this.reader.onerror=(function(o){return function(p){return o.emit("error",p)}})(this);this.reader.onprogress=(function(o){return function(p){return o.emit("progress",(o.offset+p.loaded)/o.length*100)}})(this);return this.loop()};m.prototype.loop=function(){var o,p;this.active=true;p=Math.min(this.offset+this.chunkSize,this.length);o=this.file[this.slice](this.offset,p);return this.reader.readAsArrayBuffer(o)};m.prototype.pause=function(){var o;this.active=false;try{return(o=this.reader)!=null?o.abort():void 0}catch(p){}};m.prototype.reset=function(){this.pause();return this.offset=0};return m})(k);i.exports=h},{"../../core/buffer":6,"../../core/events":8}],30:[function(g,i,e){var l,k,h,f={}.hasOwnProperty,j=function(p,n){for(var m in n){if(f.call(n,m)){p[m]=n[m]}}function o(){this.constructor=p}o.prototype=n.prototype;p.prototype=new o();p.__super__=n.prototype;return p};k=g("../../core/events");l=g("../../core/buffer");h=(function(n){j(m,n);function m(o,p){this.url=o;this.opts=p!=null?p:{};this.chunkSize=1<<20;this.inflight=false;if(this.opts.length){this.length=this.opts.length}this.reset()}m.prototype.start=function(){if(this.length){if(!this.inflight){return this.loop()}}this.inflight=true;this.xhr=new XMLHttpRequest();this.xhr.onload=(function(o){return function(p){o.length=parseInt(o.xhr.getResponseHeader("Content-Length"));o.inflight=false;return o.loop()}})(this);this.xhr.onerror=(function(o){return function(p){o.pause();return o.emit("error",p)}})(this);this.xhr.onabort=(function(o){return function(p){return o.inflight=false}})(this);this.xhr.open("HEAD",this.url,true);return this.xhr.send(null)};m.prototype.loop=function(){var o;if(this.inflight||!this.length){return this.emit("error","Something is wrong in HTTPSource.loop")}this.inflight=true;this.xhr=new XMLHttpRequest();this.xhr.onload=(function(p){return function(u){var s,r,t,q,w,v;if(p.xhr.response){s=new Uint8Array(p.xhr.response)}else{q=p.xhr.responseText;s=new Uint8Array(q.length);for(t=w=0,v=q.length;0<=v?w<v:w>v;t=0<=v?++w:--w){s[t]=q.charCodeAt(t)&255}}r=new l(s);p.offset+=r.length;p.emit("data",r);if(p.offset>=p.length){p.emit("end")}p.inflight=false;if(!(p.offset>=p.length)){return p.loop()}}})(this);this.xhr.onprogress=(function(p){return function(q){return p.emit("progress",(p.offset+q.loaded)/p.length*100)}})(this);this.xhr.onerror=(function(p){return function(q){p.emit("error",q);return p.pause()}})(this);this.xhr.onabort=(function(p){return function(q){return p.inflight=false}})(this);this.xhr.open("GET",this.url,true);this.xhr.responseType="arraybuffer";o=Math.min(this.offset+this.chunkSize,this.length-1);this.xhr.setRequestHeader("If-None-Match","webkit-no-cache");this.xhr.setRequestHeader("Range","bytes="+this.offset+"-"+o);this.xhr.overrideMimeType("text/plain; charset=x-user-defined");return this.xhr.send(null)};m.prototype.pause=function(){var o;this.inflight=false;return(o=this.xhr)!=null?o.abort():void 0};m.prototype.reset=function(){this.pause();return this.offset=0};return m})(k);i.exports=h},{"../../core/buffer":6,"../../core/events":8}],31:[function(f,g,e){(function(h){(function(){var m,l,k,j,o=function(p,q){return function(){return p.apply(q,arguments)}},n=function(s,q){for(var p in q){if(i.call(q,p)){s[p]=q[p]}}function r(){this.constructor=s}r.prototype=q.prototype;s.prototype=new r();s.__super__=q.prototype;return s},i={}.hasOwnProperty;j=f("../core/events");l=f("../core/bufferlist");m=f("../core/buffer");k=(function(q){var r,p;n(s,q);function s(t){this.loop=o(this.loop,this);if(t instanceof l){this.list=t}else{this.list=new l;this.list.append(new m(t))}this.paused=true}p=h.setImmediate||function(t){return h.setTimeout(t,0)};r=h.clearImmediate||function(t){return h.clearTimeout(t)};s.prototype.start=function(){this.paused=false;return this._timer=p(this.loop)};s.prototype.loop=function(){this.emit("progress",(this.list.numBuffers-this.list.availableBuffers+1)/this.list.numBuffers*100|0);this.emit("data",this.list.first);if(this.list.advance()){return p(this.loop)}else{return this.emit("end")}};s.prototype.pause=function(){r(this._timer);return this.paused=true};s.prototype.reset=function(){this.pause();return this.list.rewind()};s.prototype.append=function(t){this.list.append(new m(t));this.loop()};return s})(j);g.exports=k}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../core/buffer":6,"../core/bufferlist":7,"../core/events":8}],32:[function(f,h,e){var g,j,i;i=f("./src/aurora");for(g in i){j=i[g];e[g]=j}f("./src/devices/webaudio");f("./src/devices/mozilla")},{"./src/aurora":2,"./src/devices/mozilla":21,"./src/devices/webaudio":23}]},{},[32])(32)});