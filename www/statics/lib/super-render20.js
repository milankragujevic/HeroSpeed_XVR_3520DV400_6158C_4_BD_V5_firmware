"use strict";var vertexYUVShader=["#version 300 es","layout(location = 0) in vec4 vertexPos;","layout(location = 1) in vec2 texturePos;","out vec2 textureCoord;","void main()","{","gl_Position = vertexPos;","textureCoord = texturePos;","}"].join("\n");var fragmentYUVShader=["#version 300 es","precision highp float;","in vec2 textureCoord;","out vec4 fragColor;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","const mat4 YUV2RGB = mat4","(","1.1643828125, 0, 1.59602734375, -.87078515625,","1.1643828125, -.39176171875, -.81296875, .52959375,","1.1643828125, 2.017234375, 0, -1.081390625,","0, 0, 0, 1",");","void main(void) {","float y = texture(ySampler,  textureCoord).r;","float u = texture(uSampler,  textureCoord).r;","float v = texture(vSampler,  textureCoord).r;","fragColor = vec4(y, u, v, 1) * YUV2RGB;","}"].join("\n");var vertexLineShader=["#version 300 es","layout(location = 0) in vec4 vertexPosLine;","void main()","{","gl_Position = vertexPosLine;","}"].join("\n");var fragmentLineShader=["#version 300 es","precision highp float;","uniform mediump float fRcom;","uniform mediump float fGcom;","uniform mediump float fBcom;","out vec4 fragColor;","void main()","{","fragColor = vec4(fRcom,fGcom,fBcom,1.0);","}"].join("\n");(function(b,a){b.SuperRender=a()})(this,function(){function a(b){this.canvasElement=document.getElementById(b);this.initContextGL();if(this.contextGL){this.YUVProgram=this.initProgram(vertexYUVShader,fragmentYUVShader);this.LineProgram=this.initProgram(vertexLineShader,fragmentLineShader);this.initBuffers();this.initTextures()}}a.prototype.initContextGL=function(){var c=this.canvasElement;var b=null;try{b=c.getContext("webgl2")}catch(c){b=null}if(!b||typeof b.getParameter!=="function"){b=null}this.contextGL=b;console.log("WebGL2.0")};a.prototype.initProgram=function(g,f){var d=this.contextGL;var b=d.createShader(d.VERTEX_SHADER);d.shaderSource(b,g);d.compileShader(b);if(!d.getShaderParameter(b,d.COMPILE_STATUS)){console.log("Vertex shader failed to compile: "+d.getShaderInfoLog(b))}var c=d.createShader(d.FRAGMENT_SHADER);d.shaderSource(c,f);d.compileShader(c);if(!d.getShaderParameter(c,d.COMPILE_STATUS)){console.log("Fragment shader failed to compile: "+d.getShaderInfoLog(c))}var h=d.createProgram();d.attachShader(h,b);d.attachShader(h,c);d.linkProgram(h);if(!d.getProgramParameter(h,d.LINK_STATUS)){console.log("Program failed to compile: "+d.getProgramInfoLog(h))}d.deleteShader(b);d.deleteShader(c);return h};a.prototype.initBuffers=function(){var f=this.contextGL;var d=f.createBuffer();f.bindBuffer(f.ARRAY_BUFFER,d);f.bufferData(f.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),f.STATIC_DRAW);f.bindBuffer(f.ARRAY_BUFFER,null);var c=f.createBuffer();f.bindBuffer(f.ARRAY_BUFFER,c);f.bufferData(f.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),f.DYNAMIC_DRAW);f.bindBuffer(f.ARRAY_BUFFER,null);var b=f.createBuffer();f.bindBuffer(f.ARRAY_BUFFER,b);f.bufferData(f.ARRAY_BUFFER,16,f.DYNAMIC_DRAW);f.bindBuffer(f.ARRAY_BUFFER,null);this.vertexPosBuffer=d;this.texturePosBuffer=c;this.vertexLineBuffer=b};a.prototype.initTextures=function(){var j=this.contextGL;var g=this.YUVProgram;j.useProgram(g);var d=this.initTexture();var b=j.getUniformLocation(g,"ySampler");j.uniform1i(b,0);this.yTextureRef=d;var c=this.initTexture();var k=j.getUniformLocation(g,"uSampler");j.uniform1i(k,1);this.uTextureRef=c;var l=this.initTexture();var h=j.getUniformLocation(g,"vSampler");j.uniform1i(h,2);this.vTextureRef=l;j.useProgram(null)};a.prototype.initTexture=function(){var c=this.contextGL;var b=c.createTexture();c.bindTexture(c.TEXTURE_2D,b);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);c.bindTexture(c.TEXTURE_2D,null);return b};a.prototype.SR_DisplayFrameData=function(p,b,z,h,q){if(p<=0||b<=0){return}var w=this.contextGL;if(null==z){w.clearColor(0,0,0,0);w.clear(w.COLOR_BUFFER_BIT|w.DEPTH_BUFFER_BIT);return}var k=this.canvasElement;k.width=p;k.height=b;this.nWindowWidth=k.width;this.nWindowHeight=k.height;var c=this.nWindowWidth;var d=this.nWindowHeight;w.clearColor(0.8,0.8,1,1);w.clear(w.COLOR_BUFFER_BIT|w.DEPTH_BUFFER_BIT);w.viewport(0,0,c,d);this.updateFrameData(p,b,z);var m=this.YUVProgram;w.useProgram(m);var y=this.vertexPosBuffer;w.bindBuffer(w.ARRAY_BUFFER,y);var A=w.getAttribLocation(m,"vertexPos");w.enableVertexAttribArray(A);w.vertexAttribPointer(A,2,w.FLOAT,false,0,0);w.bindBuffer(w.ARRAY_BUFFER,null);var x=this.texturePosBuffer;w.bindBuffer(w.ARRAY_BUFFER,x);var g=w.getAttribLocation(m,"texturePos");w.enableVertexAttribArray(g);w.vertexAttribPointer(g,2,w.FLOAT,false,0,0);w.bindBuffer(w.ARRAY_BUFFER,null);w.drawArrays(w.TRIANGLE_STRIP,0,4);w.disableVertexAttribArray(A);w.disableVertexAttribArray(g);w.useProgram(null);if(h&&q==this.captureId){this.capVideoData=k.toDataURL();this.captureId="";this.capVideo=false}};a.prototype.updateFrameData=function(q,b,z){var w=this.contextGL;var k=this.yTextureRef;var c=this.uTextureRef;var d=this.vTextureRef;var p=z;var y=q*b;var A=p.subarray(0,y);w.activeTexture(w.TEXTURE0);w.bindTexture(w.TEXTURE_2D,k);w.texImage2D(w.TEXTURE_2D,0,w.LUMINANCE,q,b,0,w.LUMINANCE,w.UNSIGNED_BYTE,A);var x=q/2*b/2;var h=p.subarray(y,y+x);w.activeTexture(w.TEXTURE1);w.bindTexture(w.TEXTURE_2D,c);w.texImage2D(w.TEXTURE_2D,0,w.LUMINANCE,q/2,b/2,0,w.LUMINANCE,w.UNSIGNED_BYTE,h);var j=x;var g=p.subarray(y+x,y+x+j);w.activeTexture(w.TEXTURE2);w.bindTexture(w.TEXTURE_2D,d);w.texImage2D(w.TEXTURE_2D,0,w.LUMINANCE,q/2,b/2,0,w.LUMINANCE,w.UNSIGNED_BYTE,g)};a.prototype.SR_DrawLine=function(y,b,C,z){var q=this.contextGL;var c=this.nWindowWidth;var d=this.nWindowHeight;var x=this.LineProgram;q.useProgram(x);var B=q.getUniformLocation(x,"fRcom");q.uniform1f(B,C.fR);var F=q.getUniformLocation(x,"fGcom");q.uniform1f(F,C.fG);var A=q.getUniformLocation(x,"fBcom");q.uniform1f(A,C.fB);var j=y.fX/c*2-1;var p=-(y.fY/d)*2+1;var g=b.fX/c*2-1;var w=-(b.fY/d)*2+1;var D=this.vertexLineBuffer;q.bindBuffer(q.ARRAY_BUFFER,D);q.bufferSubData(q.ARRAY_BUFFER,0,new Float32Array([j,p,g,w]));var k=q.getAttribLocation(x,"vertexPosLine");q.enableVertexAttribArray(k);q.vertexAttribPointer(k,2,q.FLOAT,false,0,0);q.bindBuffer(q.ARRAY_BUFFER,null);q.drawArrays(q.LINES,0,2);q.disableVertexAttribArray(k);q.useProgram(null)};a.prototype.SR_SetDisplayRect=function(j){var b=this.contextGL;var m=this.nWindowWidth;var k=this.nWindowHeight;var g=null;if(j&&m>0&&k>0){var c=j.left/m;var d=j.top/k;var h=j.right/m;var l=j.bottom/k;g=new Float32Array([h,d,c,d,h,l,c,l])}else{g=new Float32Array([1,0,0,0,1,1,0,1])}var p=this.texturePosBuffer;b.bindBuffer(b.ARRAY_BUFFER,p);b.bufferSubData(b.ARRAY_BUFFER,0,g);b.bindBuffer(b.ARRAY_BUFFER,null)};a.prototype.SR_Destroy=function(){var j=this.contextGL;var b=this.YUVProgram;j.deleteProgram(b);var m=this.LineProgram;j.deleteProgram(m);var k=this.vertexPosBuffer;var g=this.texturePosBuffer;var c=this.vertexLineBuffer;j.deleteBuffer(k);j.deleteBuffer(g);j.deleteBuffer(c);var d=this.yTextureRef;var h=this.uTextureRef;var l=this.vTextureRef;j.deleteTexture(d);j.deleteTexture(h);j.deleteTexture(l)};return a});