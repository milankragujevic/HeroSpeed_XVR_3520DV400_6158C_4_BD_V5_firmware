$(commonInit(loginInit));function loginInit(){initDot();window.api=new api();setTitle(lang.login);setCookie("updateTips","true");deleteCookie(USER_NAME);removeStorageItem("upgrade");$("#lang").val(getLang()).change(function(){setLang($(this).val(),24*365);reload()});$(".J-login-frame input[type=password]").keyup(function(a){if(a.keyCode==KEY_ENTER){$(".J-login-btn").click()}});$(".J-input").on("click",function(){$(this).val("")});$(".J-login-btn").on("click",function(){login()})}function login(c,b,a){!c&&(c=$("#userName").val());!b&&(b=$("#pwd").val());!a&&(a=$("#lang").val());if(c==""){return alert(lang.alertLoginErr)}api.getCapabilities(REQUEST_GET,{username:c},function(h,i){var d=roundOne();var g=loginRoundTwo(c,i.param.salt,d[0],b);var f=roundThree(g,i.param.challenge);if(i.param.enableIteration){f=roundFour(i.param.iterations,f)}var e={username:c,loginEncryptionType:i.encryptionType[0],password:f,sessionID:i.sessionID,datetime:d[1]};api.login(REQUEST_SET,e,function(j,k){loading(false);if(j!=CODE_SUCCESS){return alert(lang.alertLoginErr)}setAuth();setStorageItem(USER_INFO,setAuthInfo(b));var l=k.cookie.split("=");setCookie(USER_ID,l[1]);setCookie(USER_NAME,c);setLang(a,{hoursToLive:24*7});if(c==="root"){return}if(getStorageItem("isIvms")){return toMainPage()}if(passwordLevel(b)){deleteCookie("adminWeekPwd");toMainPage()}else{alertDialog()}})})}function alertDialog(){$(".J-password-tip").show().children().position({of:$("body"),at:"center",my:"center top"});$(".J-edit-ok").focus().click(function(){if($("#userName").val()==="admin"){setCookie("editPassword",true);getUserName()==="admin"&&setCookie("adminWeekPwd","1");toMainPage()}});$(".J-edit-cancel").click(function(){getUserName()==="admin"&&setCookie("adminWeekPwd","1");toMainPage()})}function toMainPage(){window.location.href=URL_FRAME+(new Date()).getTime()};