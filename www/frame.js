$(commonInit(frameInit));var m_nEncodeSelChannel=0;var m_nDeviceName="";var m_bPlayAll=false;var m_bRecordAll=false;var m_RstpPort="554";var m_TcpPort="5000";var m_nCpuType=0;var m_nADtype=0;var m_bDVR=false;var m_selreslution=0;var port="80";var nSynConfigDatabit=[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false];var nPlaybackDatabit=new Array();var nLiveviewDatabit=new Array();var nPtzctrlDatabit=new Array();var nRecordDatabit=new Array();var nEncodeDatabit=new Array();var nOsdDatabit=new Array();var nVideoDatabit=new Array();var nMotionDatabit=new Array();var nFileBackupDatabit=new Array();var nPrivacyMask=new Array();var nVideoLoss=new Array();var nSmartAlarm=new Array();var nImageDatabit=new Array();var nSmtDected=new Array();var nSmtFaceCmp=new Array();var nSmtAlarm=new Array();var nOsdText=new Array();var nIPEye=new Array();var g_optAudio=[],g_optChMaintain=[];var nFrameliveviewbit=0;var defaultipport=false;var vChannelConfig=new Array();var nDeviceYear=0;var nDeviceMonth=0;var nDeviceDay=0;var m_nDeviceTypeDay=0;var is4K=false;var wifiType="";var xvrChannelConfig={osdAndPrivacy:[]};var globalVariable={username:""};function plugin0(){var a=document.getElementById("plugin");return a?a:{}}var plugin=plugin0;var browserCfg={};var ua=window.navigator.userAgent;if(ua.indexOf("Trident")>=1){browserCfg.ie=true;var ieVersion=navigator.appVersion;ieVersion=ieVersion.split(";");browserCfg.ieVersion=ieVersion[1].replace(/[ ]/g,"")}else{if(ua.indexOf("Firefox")>=1){browserCfg.firefox=true}else{if(ua.indexOf("Chrome")>=1){browserCfg.chrome=true}else{if(ua.indexOf("AppleWebKit")>=1){browserCfg.safari=true}}}}function frameInit(){if(!isLogin()){return reload(URL_LOGIN)}initDot();if(!getStorageItem("isIvms")){$(".J-main-header").removeClass("hide")}isSpecialLang(getLang())&&$("body").addClass("special-lang");initCalendarLang(getLang());window.api=new api();initConfig({});api.heartBeat();setInterval(function(){api.heartBeat()},30000);$(window).on("dragstart",function(){return false});$("#userName").text(getUserName());getDevieInit();var a=true;$(".J-main-list a").on("click",function(){a=false;var b=$(this).attr("data-path");loadPage($(this),b)});$(".J-logout").on("click",function(){logout()});setTimeout(function(){if(a){window.location.href=URL_FRAME+(new Date()).getTime()}},4000);isIE()&&timer();globalVariable.username=getCookie(USER_NAME)}function getDevieInit(){api.getDeviceConf(REQUEST_GET,function(a,b){if(a!=CODE_SUCCESS){return}api.getDefaultParame(REQUEST_GET,function(d,c){if(d!=CODE_SUCCESS){return}var h=$.extend(b,c);initDevConf(h);setDevConf("deviceType",getDeviceType(b.devType));port=getDevConf("httpPort");var g=lang.lvdevicename,f="NVR",e="logo";if(isXVR()){g=f=lang.lvdevicename1;e="logo-xvr"}else{if(getConf("deviceType")=="SDI"&&spDevName[1]=="DVR"){f=lang.lvdevicename2;g=lang.lvdevicename2;e="logo-dvr"}}setTitle(f);$("#deviceType").text(g);$("#deviceLogo").addClass(e)});setConf("nvrShowPTZ",b.supportRs485)});setTimeout(function(){getDevConf("platformType")&&(m_nADtype=getDevConf("platformType"));setDeviceType(getDevConf("platformType"),"");var b=false;if(isNVR()){switch(getDevConf("platformType")){case"9":if(getDevConf("displayResolution")==3){window.top.is4K=true}break;case"10":case"11":if(getDevConf("displayResolution")==4){window.top.is4K=true}break;default:if(getDevConf("displayResolution")){window.top.is4K=false}break}}else{if(isXVR()){if(getDevConf("platformType")<=xvrCpuType.length){setDevConf("platformType",xvrCpuType[getDevConf("platformType")])}}else{if(getConf("deviceType")=="SDI"&&spDevName[1]=="DVR"){m_bDVR=true}}}if(getCookie("editPassword")){return jumpModifPswView()}setConf("hardWare",b);setConf("bUsePdCal",getLang()==="bs");setConf("isVlAlarmOutEn",isCpuEq("CPU_3521A_4AHD","CPU_3531DCAS_16AHD_RT","CPU_3531DCAS_16AHD_8SATA_RT","CPU_3531D_16AHD_NRT_6158C_2","CPU_3531D_16AHD_NRT_6168C_X1","CPU_3531DCAS_16SDI_334S","CPU_3531DCAS_8AHD_4M_RT")||window.top.m_nADtype==4&&isCpuEq("CPU_3521D","CPU_3521D_SMARTKITS")||window.top.m_nADtype==2&&isCpuEq("CPU_3521A","CPU_3521D_16AHD_NRT"));setConf("isVlAlarmOutExEn",isCpuEq("CPU_3531A","CPU_3531D_32AHD_NRT","CPU_3531DCAS_32AHD_1080P_NRT","CPU_3531D_16AHD_NRT_6168C_X1","CPU_3531DCAS_16AHD_8SATA_RT"));setConf("isAlarmOutEn",window.top.m_nADtype==4&&isCpuEq("CPU_3521A_4AHD","CPU_3531A_8AHD")||window.top.m_nADtype==2&&isCpuEq("CPU_3521A","CPU_3521D_16AHD_NRT")||isCpuEq("CPU_3531A_16AHD","CPU_3531D_16AHD_NRT_6158C","CPU_3531A","CPU_3531D_32AHD_NRT","CPU_3531DCAS_32AHD_1080P_NRT","CPU_3531D_16AHD_NRT_6158C_2","CPU_3531D_16AHD_NRT_6168C_X1","CPU_3531DCAS_16AHD_RT","CPU_3531DCAS_16AHD_8SATA_RT","CPU_3531DCAS_16SDI_334S","CPU_3531DCAS_8AHD_4M_RT","CPU_3520DV400_4AHD_NRT_6158C","CPU_3520DV400_8AHD_1080N_NRT_6158C","CPU_3521D_16AHD_1080N_NRT_6158C")||isCpuEq(9)&&getTotalChannelNum()==64||isCpuEq(11)&&isPoeEnable()&&getTotalChannelNum()!=16);setConf("isNvrAlarmOutEn",ParseInt(getDevConf("alarmOutNum")));setConf("isNvrAlarmInEn",ParseInt(getDevConf("alarmInNum")));setConf("isXvrAlarmInEn",ParseInt(getDevConf("alarmInNum")));setConf("isSmartDetectEn",isNVR()||isXVR());setConf("isSmtFaceEn",isNVR()&&isCpuEq(20,21)||isXVR());setConf("isSmtCmpCh",isNVR()&&isCpuEq(20,21));setConf("isAlarmOutExEn",!(isCpuEq("CPU_3531A_16AHD","CPU_3521A","CPU_3531DCAS_16AHD_RT","CPU_3531DCAS_16SDI_334S","CPU_3531D_16AHD_NRT_6158C_2","CPU_3520DV400_8AHD_1080N_NRT_6158C","CPU_3531DCAS_8AHD_4M_RT","CPU_3520DV400_4AHD_NRT_6158C","CPU_3521D_16AHD_1080N_NRT_6158C")||window.top.m_nADtype==4&&isCpuEq("CPU_3521A_4AHD")));setConf("alarmOutNum",isCpuEq(9,11,"CPU_3531A","CPU_3531D_32AHD_NRT","CPU_3531DCAS_32AHD_1080P_NRT","CPU_3531DCAS_16AHD_8SATA_RT","CPU_3531D_16AHD_NRT_6158C")?16:4);setConf("recDayMax",isNVR());setConf("motionLinkageEn",isXVR());setConf("alarmLinkageEn",isXVR()&&isCpuEq("CPU_3531DCAS_32AHD_1080P_NRT","CPU_3531D_16AHD_NRT_6168C_X1","CPU_3531DCAS_16AHD_8SATA_RT","CPU_3531D_16AHD_NRT_6158C"));setConf("IPFilterEn",isXVR());setConf("isIPFilter",isXVR()&&isCpuEq("CPU_3531D_4AHD_4M_RT"));setConf("isXvrLink",isXVR());setConf("isXvrSearchType",isXVR()&&getDevConf("alarmInNum"));setConf("isXvrNoMotionAlarmType",isXVR());setConf("isTimeOut",isCpuEq("CPU_3531D_16AHD_NRT_6168C_X1"));setConf("isNvrCptPic",isNVR()&&isCpuEq(11));setConf("nvrDhcpEnable",isNVR()&&getDevConf("dhcpStatus"));setConf("xvrSmartShowChNum",isCpuEq("CPU_3531DCAS_16AHD_RT","CPU_3531DCAS_8AHD_4M_RT","CPU_3531DCAS_16SDI_334S","CPU_3531DCAS_32AHD_1080P_NRT","CPU_3531DCAS_16AHD_8SATA_RT"));setConf("nvrNew",isNVR()||isXVR());setConf("removeBuzzer",(getDevConf("platformType")=="CPU_3520DV400_4AHD_NRT_6158C_2G"));if(getConf("isSmartDetectEn")||isXVR()){$("#picture").show()}var a=counter(isXVR()?2:1,function(){var c=getCookie("adminWeekPwd")?3600:-1;getCookie("reload2MdyPwd")&&(c=0);if(c>=0){setConf("weekPwdTimer",c);setTimeout(jumpModifPswView,c*1000)}if(getStorageItem("isIvms")){return ivmsFrameEvent()}if(isNaN(c)||c<0||c>1){$(".J-main-list a.default").click()}});isXVR()&&getChannelConfig(getTotalChannelNum(),a);setConf("isCPUMC6630",isCpuEq("CPU_MC6630","CPU_MC6630_4AHD_NRT_2830","CPU_MC6630_4AHD_1080N_RT_2830","CPU_MC6630_8AHD_1080N_NRT_2830"));getUserRights(a)},1000);getChannelProtocolType()}function getChannelConfig(a,b){api.channelConfig(REQUEST_GET,null,function(e,f){if(e!=CODE_SUCCESS){return}for(var d=0;d<f.channelModeList.length;d++){var c=f.channelModeList[d];vChannelConfig[d]=c.mode}setPluginDeviceChannelNum(getTotalChannelNum());b&&b()})}function setPluginDeviceChannelNum(a){checkPluginInstall()&&apiPlugin.setDeviceChannelNum(a)}function getUserRights(d){for(var b=0;b<64;b++){nPlaybackDatabit[b]=true;nLiveviewDatabit[b]=true}var c=getUserName();var a=getAuth();api.newGetCapability(REQUEST_GET,{username:c},function(e,j){var n=roundOne();var m=j.encryptionType[0];var k=roundTwo(c,j.param[m].salt,n[0],a);var i=reverseRoundThree(k);var h=roundFour(j.param[m].iterations,i);var g=roundFive(h);var f={encryptionType:m,loginName:String(getUserName()),datetime:n[1],iv:"afe13ds34cdjk08c"};var l="";api.userManager("getList",f,function(p,q){if(p!=CODE_SUCCESS){return}for(var o=0;o<q.userList.length;o++){if(decrypt(q.userList[o].username,g)==c){l=q.userList[o].userId;break}}var r={userId:l};api.userManager(REQUEST_GET,r,function(v,w){if(v!=CODE_SUCCESS){return}var s=w.remotePermission;var u=w.channelPermission;nSynConfigDatabit=binaryToArray(s);for(var t=0;t<getTotalChannelNum();t++){var x=binaryToArray(u[t].permission);nLiveviewDatabit[t]=0;nPtzctrlDatabit[t]=0;nPlaybackDatabit[t]=0;nRecordDatabit[t]=0;nEncodeDatabit[t]=0;nOsdDatabit[t]=0;nVideoDatabit[t]=0;nMotionDatabit[t]=0;nFileBackupDatabit[t]=0;nPrivacyMask[t]=0;nVideoLoss[t]=0;nSmartAlarm[t]=0;nSmtDected[t]=0;nSmtFaceCmp[t]=0;nSmtAlarm[t]=0;nOsdText[t]=0;nIPEye[t]=0;nLiveviewDatabit[t]=x[1];nRecordDatabit[t]=x[3];nPlaybackDatabit[t]=x[5];nPtzctrlDatabit[t]=x[7];nFileBackupDatabit[t]=x[9];nSmartAlarm[t]=x[1]}d&&d()})})})}function logout(){tipConfirm(lang.exitTips,function(a){if(a){$("#videoBlock").length&&$("#videoBlock").isPlayer("destroy");var b="sessionID="+getCookie("sessionID");api.logout(REQUEST_SET,{cookie:b},function(c,d){if(c!=CODE_SUCCESS){return}logoutEvent()})}})}function logoutEvent(){$("#videoBlock").length&&$("#videoBlock").isPlayer("stopAllVideo");deleteCookie(USER_NAME);deleteCookie(USER_ID);removeStorageItem(USER_INFO);removeStorageItem(USER_AUTH);window.location.href=URL_LOGIN}function doRestartCount(b,c,a){b||(b=0);doPrgCount(lang.optionsLoading,getDeviceRestartTime(b),function(){if(b==2){window.location.href="/frame.html"}else{c||(c=getHost());a||(a=getHttpPort());window.location.href="http://"+c+":"+a}},b==3?10:"")}function getDeviceRestartTime(a){a=ParseInt(a);switch(a){case 0:return isCpuEq("CPU_3531DCAS_16AHD_RT","CPU_3531DCAS_16AHD_8SATA_RT","CPU_3531DCAS_16SDI_334S","CPU_3531DCAS_8AHD_4M_RT","CPU_3531DCAS_32AHD_1080P_NRT")?90000:45000;case 1:if(isCpuEq(10)){return 90000}else{if(isCpuEq("CPU_3531DCAS_16AHD_RT","CPU_3531DCAS_16AHD_8SATA_RT","CPU_3531DCAS_16SDI_334S","CPU_3531DCAS_8AHD_4M_RT")){return 242000}else{return 362000}}case 2:return 190000;case 3:return 10000;default:return 362000}}function loadPage(h,g){if(!g){return}if(typeof window.onUnload==="function"){window.onUnload();window.onUnload=null}if(typeof window.onBeforeunload==="function"){window.onBeforeunload();window.onUnload=null}$(".J-main-list>li>a").removeClass("current");$(h).addClass("current");var d=columnSpecifyAppend(g.split("/")[0]),f=[],c=1,a=2;g="/views/"+g;if(d.length){a=2+parseInt(d.length);c=1+parseInt(d.length);f=d.concat([g])}$(".J-main-container").html("");promLoad=counter(a,function(i){$(".J-main-container").html(i);typeof window.onLoad==="function"&&window.onLoad()}),jst="";$.ajax({url:g+".html?ver="+versionconfig.web_version,dataType:"text",success:function(i){jst=i;promLoad(jst)}});var e=".js?ver="+versionconfig.web_version;for(var b=0;b<c;b++){$LAB.setOptions({AllowDuplicates:true}).script(f.length?f[b]+e:g+e).wait(function(){promLoad(jst)})}$(".J-main-page-css").html("");$.ajax({url:g+".css?ver="+versionconfig.web_version,success:function(i){$(".J-main-page-css").html(i)}})}function columnSpecifyAppend(a){switch(a){case"realtime":return["/views/realtime/ptz","/views/realtime/priview"];case"playback":return["/statics/lib/persianDatepicker/persianDatepicker","/statics/lib/commCal/jplg-commCal","/statics/lib/fileInfo/fileInfo"];case"picture":return["/statics/lib/datatables/datatables.min","/statics/lib/long.min","/statics/lib/jquery-ui/jquery-ui-timepicker-addon"];default:return[]}}function getDateByWeek(i,d,b,j,e,f,h){var c=new Date();c.setFullYear(i);c.setMonth(d);c.setDate(1);c.setSeconds(0);var a=1;var g=c.getDay();var k=[7,1,2,3,4,5,6];c.setDate(k[(7+a-g)%7]+(7+j-a)%7+7*b-6);e||(e=0);f||(f=0);h||(h=0);c.setHours(e);c.setMinutes(f);c.setSeconds(h);return c}function getDeviceName(){if(isXVR()){return isDVR()?lang.lvdevicename2:lang.lvdevicename1}else{return lang.lvdevicename}}function setDeviceType(b,e){var c;switch(b){case"NVR":var d=e.substr(0,6),a=e.substr(0,4);if(d=="HIWIFI"){c="HIWIFI"}if(d=="WIFIHI"){c="WIFIHI"}if(a=="WIFI"){c="WIFI"}versionconfig.type="NVR";c="NVR";break;case"XVR":versionconfig.type="XVR_NEW";break;case"SDI":if(e=="HIWIFI"){c="XVR"}break;case"WIFIHI":case"HIWIFI":versionconfig.type="NVR_WIFI"}setConf("deviceType",c)}function doPrgCount(d,e,g,f){var b=1000;var c=100/e*b;f||(f=0);FrameShowProgess(f,d);var a=setInterval(function(){f+=c;if(f>=100){FrameShowProgess(-1);g&&g();clearInterval(a);a=undefined}else{FrameShowProgess(f,d)}},b)}function FrameappendItm(a){if(window["$allDivF1"]){return}window["$allDivF1"]=$('<div class="all" style="z-index:9999; position:fixed; top:0px; left:0px; right:0px; bottom:0px; background-color:#000;"></div>');$("body").append(window["$allDivF1"]);window["$allDivF1"].css("width","100%").css("height","100%").css("opacity",0.75);if(!a){window["$waitDiv1"]=$('<div style="z-index:10000;">            <div class="loading" style="z-index:10000;"></div>');$("body").append(window["$waitDiv1"])}window["$allDivF1"].focus().keydown(function(){if(window.event){window.event.returnValue=false}})}function FrameRemoveItm(){if(window["$allDivF1"]!=null){window["$allDivF1"].remove();window["$allDivF1"]=null}if(window["$waitDiv1"]!=null){window["$waitDiv1"].remove();window["$waitDiv1"]=null}}function FrameShowProgess(a,b){a=ParseInt(a);if(a<0){FrameRemoveItm();return}a=Math.max(0,Math.min(100,a));if(!window["$allDivF1"]){FrameappendItm(true);$('<div id="divPrg"><div id="divBody"></div></div>').appendTo(window["$allDivF1"]).position({my:"center",at:"center",of:window["$allDivF1"]});b&&$('<label id="tipPrg"></label>').html(b).appendTo(window["$allDivF1"]).position({my:"bottom",at:"top",of:$("#divPrg")})}$("#divBody").css("width",a+"%")}var $allDiv=null;var $allDivMf=null;var $waitDivMF=null;function modeformatAlert(a){$allDivMf=$('<div class="all" style="z-index:9999; position:absolute; top:0px; left:0px; right:0px; bottom:0px; background-color:#000;"></div>');$("body").append($allDivMf);$allDivMf.css("width","100%").css("height","100%").css("opacity",0.75);$waitDivMF=$('<div id="waitBlock" style="z-index:10000;">        <div class="progressOuter" style="z-index:10000;">            <div class="progressInner" style="z-index:10000;"></div>            <div class="progressText" style="top:0px; left:0px; right:0px; bottom:0px; width: 362px; text-align: center; line-height: 20px; position: absolute; z-index:100000;">'+lang.sdformattip+"...</div>        </div></div>");$("body").append($waitDivMF);$allDivMf.focus().keydown(function(){if(window.event){window.event.returnValue=false}});setCenter($waitDivMF);modeformatwaitOne(a)}function modeformatwaitOne(b){var a=$(".progressInner");a.width(362*b/100);if(a.width()<362){}else{$allDivMf.remove();$waitDivMF.remove()}}function setCenter(a){var c=($(window).width()-a.width())/2;var b=($(window).height()-a.height())/2+$(document).scrollTop();a.css("left",c);a.css("top",b)}var num=0;function disp(){var a=$("#videoBlock");if(a.length){isFullScreen=a.isPlayer("isFullScreenDisplay");if(1==isFullScreen){setFullScreen();a.isPlayer("setFullScreenType")}num++}}function timer(){disp();setTimeout("timer()",500)}function setFullScreen(){$("#videoBlock").isPlayer("setFullScreen")}function tipConfirm(a,b){if(isIE()||!isMiddleware()||$("#videoBlock").isPlayer().length==0||$("#videoBlock").isPlayer("isSmallVideo")){if(confirm(a)){return b&&b(true)}}$("#videoBlock").isPlayer("hideWindow",function(){if(confirm(a)){b?b(true):confirmEvent()}else{confirmEvent()}})}function confirmEvent(){$("#videoBlock").isPlayer("showWindow")}function getLocalServerWebsocketStatus(){if(isIE()){return false}if(isSafari()||isFirefox()){return true}return localServerWebsocket.websocket.readyState==3||localServerWebsocket.websocket.readyState==2}function isPure(){if(isIE()){return false}if(isSafari()||isFirefox()){return true}return localServerWebsocket.websocket.readyState==3||localServerWebsocket.websocket.readyState==2}function isMiddleware(){if(isIE()){return false}return localServerWebsocket.websocket?localServerWebsocket.websocket.readyState==1:false}function newHandle(a){listenerEvent(a)}function listenerEvent(){var b=$("#videoBlock"),a=false;if(isMiddleware()){a=document.webkitVisibilityState=="visible"?true:false;if(a&&localServerWebsocket.windowWidth==$(window).width()){$(document).attr("title",localServerWebsocket.uuid);b.isPlayer("updateWindow");localServerWebsocket.windowWidth=$(window).width()}b.isPlayer(a?"showWindow":"hideWindow")}};