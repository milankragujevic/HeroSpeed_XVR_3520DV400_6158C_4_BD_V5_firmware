var smartAlarmVariables={};function onLoad(){initDot()}function SmartalarmScheduleVal(){this.enable1=new Array;this.starthour1=new Array;this.startmin1=new Array;this.stophour1=new Array;this.stopmin1=new Array;this.enable2=new Array;this.starthour2=new Array;this.startmin2=new Array;this.stophour2=new Array;this.stopmin2=new Array}var smartalarmscheduleval=new SmartalarmScheduleVal();var loginpsw=window.top.loginpsw;var channelnum=getTotalChannelNum();$(smartAlarmInit);function smartAlarmInit(){if(!isXVR()){$("#getsmartalarmdetchan").attr("matchval","getalarmkitschannel");$("#getsmartalarmdeten").attr("matchval","getalarmkitsmainenable");$("#getsmartalarmeventdisplay").attr("matchval","getalarmkitsdisplayenable");$("#getsmartalarmdetbeepen").attr("matchval","getalarmkitsbeepenable");$("#getsmartalarmdetsmtpen").attr("matchval","getalarmkitssmtpenable");$("#getsmartalarmdetrecorden").attr("matchval","getalarmkitsrecordenable");$("#getsmartalarmdetrecordtime").attr("matchval","getalarmkitsrecordtime");$("#getsmartalarmscheddate").attr("matchval","getalarmkitsscheddate");$("#getsmartalarmschedtype1").attr("matchval","getalarmkitsschedtype1");$("#getsmartalarmschedisstarthour1").attr("matchval","getalarmkitsschedstarthour1");$("#getsmartalarmschedisstartmin1").attr("matchval","getalarmkitsschedstartmin1");$("#getsmartalarmschedisstophour1").attr("matchval","getalarmkitsschedstophour1");$("#getsmartalarmschedisstoptmin1").attr("matchval","getalarmkitsschedstopmin1");$("#getsmartalarmschedtype2").attr("matchval","getalarmkitsschedtype2");$("#getsmartalarmschedisstarthour2").attr("matchval","getalarmkitsschedstarthour2");$("#getsmartalarmschedisstartmin2").attr("matchval","getalarmkitsschedstartmin2");$("#getsmartalarmschedisstophour2").attr("matchval","getalarmkitsschedstophour2");$("#getsmartalarmschedisstoptmin2").attr("matchval","getalarmkitsschedstopmin2")}setTitle(lang.smartalarm);var a=getMinChannel(channelnum);if(a===-1){rightPopup(lang.nolimit);return}var c={range:true,min:0,max:1440,change:onSlideTime,slide:onSlideTime};$("#timeRange1").slider(c);$("#timeRange2").slider(c);var e=$(".timeRangeTxt input[type='text']");for(var b=0;b<e.length;++b){e.eq(b).attr({min:0,max:b%2===0?24:59,def:0,tabindex:20+b})}var d=function(f){var h=ParseInt(f[0].attr("id").substr(-1));var g=[f[0].val()*60+ParseInt(f[1].val()),f[2].val()*60+ParseInt(f[3].val())];$("#timeRange"+h).slider("values",g)};setTimeRangeEdit("#getsmartalarmschedisstarthour1","#getsmartalarmschedisstartmin1","#getsmartalarmschedisstophour1","#getsmartalarmschedisstoptmin1",d);setTimeRangeEdit("#getsmartalarmschedisstarthour2","#getsmartalarmschedisstartmin2","#getsmartalarmschedisstophour2","#getsmartalarmschedisstoptmin2",d);$(".chkSchedule").on("change",onScheduleChkChg);setEditNumberStyle("#getsmartalarmdetrecordtime");$("#getsmartalarmscheddate").change(function(){var f=parseInt($(this).val());$("#timeRange1").slider("values",[smartalarmscheduleval.starthour1[f]*60+parseInt(smartalarmscheduleval.startmin1[f]),smartalarmscheduleval.stophour1[f]*60+parseInt(smartalarmscheduleval.stopmin1[f])]);$("#getsmartalarmschedtype1").prop("checked",smartalarmscheduleval.enable1[f]=="1");$("#timeRange2").slider("values",[smartalarmscheduleval.starthour2[f]*60+parseInt(smartalarmscheduleval.startmin2[f]),smartalarmscheduleval.stophour2[f]*60+parseInt(smartalarmscheduleval.stopmin2[f])]);$("#getsmartalarmschedtype2").prop("checked",smartalarmscheduleval.enable2[f]=="1")}).val(new Date().getDay());$("#getsmartalarmdetchan").change(function(){var f=parseInt($(this).val());loadSetting(f);loadSchedule(f)});initChannelSelect($("#getsmartalarmdetchan"),channelnum,function(f){return window.top.nSmartAlarm[f]==1&&(!isXVR()||window.top.vChannelConfig[f]==1)});$("#getsmartalarmdetchan").change()}function loadChPt(a,e){a=ParseInt(a);var d=new Array(a);var b=counter(a,e);for(var c=0;c<a;++c){d[c]=false;xvr.getVal(["getchannelnum="+c,"getchanmanprotocoltype"],function(h,i){if(h!=HTTP_OK){return}var g=splitOkVal(i);var f=ParseInt(g.getchannelnum);d[f]=g.getchanmanprotocoltype==2;b(d)})}}function onScheduleChkChg(){var c=$(this);var a=c.attr("id").substr(-1),b=parseInt($("#getsmartalarmscheddate").val());smartalarmscheduleval["enable"+a][b]=c.prop("checked")?"1":"0"}function onSlideTime(b,d){var c=d.values[0],a=d.values[1];setTimeRange([Math.floor(c/60),c%60,Math.floor(a/60),a%60],$(d.handle).parent().attr("id").substr(-1),$("#getsmartalarmscheddate").val())}function setTimeRange(f,e,b,d){var c=["starthour"+e,"startmin"+e,"stophour"+e,"stopmin"+e];--e;var g=$(".timeRangeTxt").eq(e).find("input[type='text']");for(var a=0;a<g.length;++a){if(f[a]==-1){continue}d||g.eq(a).val(("0"+f[a]).substr(-2));smartalarmscheduleval[c[a]][b]=f[a]}}function saveAllWeek(a){xvr.setSmartAlarmSchedHead(a,1,function(b,c){loading(false);if(b!=HTTP_OK){return}xvr.setSmartAlarmSchedule($("#getsmartalarmscheddate").val(),smartalarmscheduleval.enable1[7],smartalarmscheduleval.starthour1[7],smartalarmscheduleval.startmin1[7],smartalarmscheduleval.stophour1[7],smartalarmscheduleval.stopmin1[7],smartalarmscheduleval.enable2[7],smartalarmscheduleval.starthour2[7],smartalarmscheduleval.startmin2[7],smartalarmscheduleval.stophour2[7],smartalarmscheduleval.stopmin2[7],function(e,f){if(e!=HTTP_OK){return}for(var d=0;d<7;++d){smartalarmscheduleval.enable1[d]=smartalarmscheduleval.enable1[7];smartalarmscheduleval.starthour1[d]=smartalarmscheduleval.starthour1[7];smartalarmscheduleval.startmin1[d]=smartalarmscheduleval.startmin1[7];smartalarmscheduleval.stophour1[d]=smartalarmscheduleval.stophour1[7];smartalarmscheduleval.stopmin1[d]=smartalarmscheduleval.stopmin1[7];smartalarmscheduleval.enable2[d]=smartalarmscheduleval.enable2[7];smartalarmscheduleval.starthour2[d]=smartalarmscheduleval.starthour2[7];smartalarmscheduleval.startmin2[d]=smartalarmscheduleval.startmin2[7];smartalarmscheduleval.stophour2[d]=smartalarmscheduleval.stophour2[7];smartalarmscheduleval.stopmin2[d]=smartalarmscheduleval.stopmin2[7]}rightPopup(lang.saved)})})}function saveWeekTimeHead(a){xvr.setSmartAlarmSchedHead(a,0,function(b,c){if(b!=HTTP_OK){return loading(false)}saveWeekTimeBody(0)})}function saveWeekTimeBody(a){xvr.setSmartAlarmSchedule(a,smartalarmscheduleval.enable1[a],smartalarmscheduleval.starthour1[a],smartalarmscheduleval.startmin1[a],smartalarmscheduleval.stophour1[a],smartalarmscheduleval.stopmin1[a],smartalarmscheduleval.enable2[a],smartalarmscheduleval.starthour2[a],smartalarmscheduleval.startmin2[a],smartalarmscheduleval.stophour2[a],smartalarmscheduleval.stopmin2[a],function(b,c){if(b!=HTTP_OK){return loading(false)}++a;if(a<8){saveWeekTimeBody(a)}else{loading(false);rightPopup(lang.saved)}})}function saveAll(){if($("#getsmartalarmdetchan").val()==null){rightPopup(lang.savedTip);return}if(!window.top.nSmartAlarm[parseInt($("#getsmartalarmdetchan").val())]){rightPopup(lang.nolimit);return}if($("#getsmartalarmdetrecordtime").val()<30||$("#getsmartalarmdetrecordtime").val()>255){rightPopup(lang.rectime+lang.fanwei+"30-255");return}var a=parseInt($("#getsmartalarmscheddate").val());var m=0,e=7;if(a==7){m=7;e=8}for(var f=m;f<e;++f){var n=[smartalarmscheduleval.starthour1[f]*60+parseInt(smartalarmscheduleval.startmin1[f]),smartalarmscheduleval.stophour1[f]*60+parseInt(smartalarmscheduleval.stopmin1[f])],l=[smartalarmscheduleval.starthour2[f]*60+parseInt(smartalarmscheduleval.startmin2[f]),smartalarmscheduleval.stophour2[f]*60+parseInt(smartalarmscheduleval.stopmin2[f])];var g=-1;if(n[0]==n[1]&&n[0]!=0){g=0}else{if(l[0]==l[1]&&l[0]!=0){g=1}}if(g>=0){rightPopup(lang.setTimeTips2);$("#getsmartalarmscheddate").val(f).change();lightTipDom($(".timeRangeTxt").eq(g).find(".time-input"));f!=a&&lightTipDom($("#getsmartalarmscheddate"));return}}loading(true);var h,d;h=d=undefined;xvr.setsmartalarmconfig($("#getsmartalarmdetchan").val(),($("#getsmartalarmdeten").prop("checked")?"1":"0"),($("#getsmartalarmeventdisplay").prop("checked")?"1":"0"),($("#getsmartalarmdetbeepen").prop("checked")?"1":"0"),($("#getsmartalarmdetsmtpen").prop("checked")?"1":"0"),($("#getsmartalarmdetrecorden").prop("checked")?"1":"0"),intLimit($("#getsmartalarmdetrecordtime").val(),30,255),h,d,null);for(var f=0;f<smartalarmscheduleval.enable1.length;++f){if(smartalarmscheduleval.enable1[f]=="1"&&smartalarmscheduleval.enable2[f]=="1"){var n=[smartalarmscheduleval.starthour1[f]*60+parseInt(smartalarmscheduleval.startmin1[f]),smartalarmscheduleval.stophour1[f]*60+parseInt(smartalarmscheduleval.stopmin1[f])],l=[smartalarmscheduleval.starthour2[f]*60+parseInt(smartalarmscheduleval.startmin2[f]),smartalarmscheduleval.stophour2[f]*60+parseInt(smartalarmscheduleval.stopmin2[f])];if((n[0]>=l[0]&&n[0]<=l[1])||(l[0]>=n[0]&&l[0]<=n[1])){var k=Math.min(n[0],l[0]),c=Math.max(n[1],l[1]),b=f,j=f!=a;setTimeRange([Math.floor(k/60),k%60,Math.floor(c/60),c%60],1,b,j);setTimeRange([0,0,0,0],2,f,j);if(!j){$("#timeRange1").slider("values",[k,c]);$("#timeRange2").slider("values",[0,0]);$("#getsmartalarmschedtype1").prop("checked",true);$("#getsmartalarmschedtype2").prop("checked",false)}smartalarmscheduleval.enable1[b]="1";smartalarmscheduleval.enable2[b]="0"}}}if(a!="7"){saveWeekTimeHead($("#getsmartalarmdetchan").val())}else{saveAllWeek($("#getsmartalarmdetchan").val())}}function loadSetting(a){if(a==-1){return}xvr.getsmartalarmconfig(a,function(c,e){if(c!=HTTP_OK){return}split_span_val_type2(e);$("#getsmartalarmdetchan").val(a);var d=splitOkVal(e);var b=$("#getsmartalarmdetrecordtime").val();$("#getsmartalarmdetrecordtime").val(intLimit(b,30,255));if(!isXVR()){switch(parseInt(d.getalarmkitsdevicetype)){case 156:$("#getsmartalarmdeten").prop("disabled",false);$("#getsmartalarmeventdisplay").prop("disabled","disabled");$("#getsmartalarmdetbeepen").prop("disabled","disabled");$("#getsmartalarmdetsmtpen").prop("disabled","disabled");$("#getsmartalarmdetrecorden").prop("disabled","disabled");$("#getsmartalarmdetrecordtime").prop("disabled","disabled");$("#getsmartalarmschedtype1").prop("disabled",false);$("#getsmartalarmschedtype2").prop("disabled",false);$("#timeRange1").slider("enable");$("#timeRange2").slider("enable");$(".timeRangeTxt input[type='text']").prop("disabled",false);break;case 161:case 162:$("#getsmartalarmdeten").prop("disabled",false);$("#getsmartalarmeventdisplay").prop("disabled",false);$("#getsmartalarmdetbeepen").prop("disabled",false);$("#getsmartalarmdetsmtpen").prop("disabled",false);$("#getsmartalarmdetrecorden").prop("disabled",false);$("#getsmartalarmdetrecordtime").prop("disabled",false);$("#getsmartalarmschedtype1").prop("disabled",false);$("#getsmartalarmschedtype2").prop("disabled",false);$("#timeRange1").slider("enable");$("#timeRange2").slider("enable");$(".timeRangeTxt input[type='text']").prop("disabled",false);break;case 0:default:$("#getsmartalarmdeten").prop("disabled","disabled");$("#getsmartalarmeventdisplay").prop("disabled","disabled");$("#getsmartalarmdetbeepen").prop("disabled","disabled");$("#getsmartalarmdetsmtpen").prop("disabled","disabled");$("#getsmartalarmdetrecorden").prop("disabled","disabled");$("#getsmartalarmdetrecordtime").prop("disabled","disabled");$("#getsmartalarmschedtype1").prop("disabled","disabled");$("#getsmartalarmschedtype2").prop("disabled","disabled");$("#timeRange1").slider("disable");$("#timeRange2").slider("disable");$(".timeRangeTxt input[type='text']").prop("disabled","disabled");break}}else{if(d.getsmartalarmdetchantype==2){$("#getsmartalarmeventdisplay").prop("disabled","disabled");$("#getsmartalarmdetbeepen").prop("disabled","disabled");$("#getsmartalarmdetsmtpen").prop("disabled","disabled");$("#getsmartalarmdetrecorden").prop("disabled","disabled");$("#getsmartalarmdetrecordtime").prop("disabled","disabled")}else{$("#getsmartalarmeventdisplay").prop("disabled",false);$("#getsmartalarmdetbeepen").prop("disabled",false);$("#getsmartalarmdetsmtpen").prop("disabled",false);$("#getsmartalarmdetrecorden").prop("disabled",false);$("#getsmartalarmdetrecordtime").prop("disabled",false)}}})}function loadScheduleRecr(a){xvr.getSmartAlarmSchedule(a,function(c,e){if(c!=HTTP_OK){return}var d=splitOkVal(e);if(!isXVR()){smartalarmscheduleval.enable1[a]=d.getalarmkitsschedtype1;smartalarmscheduleval.starthour1[a]=d.getalarmkitsschedstarthour1;smartalarmscheduleval.startmin1[a]=d.getalarmkitsschedstartmin1;smartalarmscheduleval.stophour1[a]=d.getalarmkitsschedstophour1;smartalarmscheduleval.stopmin1[a]=d.getalarmkitsschedstopmin1;smartalarmscheduleval.enable2[a]=d.getalarmkitsschedtype2;smartalarmscheduleval.starthour2[a]=d.getalarmkitsschedstarthour2;smartalarmscheduleval.startmin2[a]=d.getalarmkitsschedstartmin2;smartalarmscheduleval.stophour2[a]=d.getalarmkitsschedstophour2;smartalarmscheduleval.stopmin2[a]=d.getalarmkitsschedstopmin2}else{smartalarmscheduleval.enable1[a]=d.getsmartalarmschedtype1;smartalarmscheduleval.starthour1[a]=d.getsmartalarmschedisstarthour1;smartalarmscheduleval.startmin1[a]=d.getsmartalarmschedisstartmin1;smartalarmscheduleval.stophour1[a]=d.getsmartalarmschedisstophour1;smartalarmscheduleval.stopmin1[a]=d.getsmartalarmschedisstoptmin1;smartalarmscheduleval.enable2[a]=d.getsmartalarmschedtype2;smartalarmscheduleval.starthour2[a]=d.getsmartalarmschedisstarthour2;smartalarmscheduleval.startmin2[a]=d.getsmartalarmschedisstartmin2;smartalarmscheduleval.stophour2[a]=d.getsmartalarmschedisstophour2;smartalarmscheduleval.stopmin2[a]=d.getsmartalarmschedisstoptmin2}++a;if(a>=8){var b=parseInt($("#getsmartalarmscheddate").val());$("#timeRange1").slider("values",[smartalarmscheduleval.starthour1[b]*60+parseInt(smartalarmscheduleval.startmin1[b]),smartalarmscheduleval.stophour1[b]*60+parseInt(smartalarmscheduleval.stopmin1[b])]);$("#timeRange2").slider("values",[smartalarmscheduleval.starthour2[b]*60+parseInt(smartalarmscheduleval.startmin2[b]),smartalarmscheduleval.stophour2[b]*60+parseInt(smartalarmscheduleval.stopmin2[b])]);$("#getsmartalarmschedtype1").prop("checked",smartalarmscheduleval.enable1[b]*1==1);$("#getsmartalarmschedtype2").prop("checked",smartalarmscheduleval.enable2[b]*1==1);loading(false)}else{loadScheduleRecr(a)}})}function loadSchedule(a){if(a==-1){return}xvr.getSmartAlarmSchedChn(a,function(b,c){if(b!=HTTP_OK){return}loading(true);loadScheduleRecr(0)})}function getMinChannel(a){if(!isXVR()){for(var b=0;b<a;b++){if(window.top.nSmartAlarm[b]==1){return b}}}else{for(var b=0;b<a;b++){if(parseInt(window.top.vChannelConfig[b])==1&&window.top.nSmartAlarm[b]==1){return b}}}return -1};