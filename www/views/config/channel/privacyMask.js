var privacyVariables={loginPsw:getAuth(),channelNum:getTotalChannelNum(),privateDataBit:new Array(),installed:false,selreslution:getDevConf("displayResolution"),coverEnable0:0,coverX0:0,coverY0:0,coverW0:0,coverH0:0,coverEnable1:0,coverX1:0,coverY1:0,coverW1:0,coverH1:0,coverEnable2:0,coverX2:0,coverY2:0,coverW2:0,coverH2:0,txtEnable0:0,txtX0:0,txtY0:0,txtW0:0,txtH0:0,timeEnable0:0,timeX:0,timeY:0,timeW:0,timeH:0,width:0,height:0};function onLoad(){initDot();$(".J-mask-save").on("click",function(){priMaskSave()});$("#videoBlock").isPlayer({isConfigVideo:true});initChSel();initPrivacyMask();$(".J-mask-save").attr("disabled",true)}function onUnload(){$("#channelList").data("lastPlayCh")&&$("#videoBlock").isPlayer("stopPreview",$(".J-pri-mask-channel").data("lastPlayCh"));$("#videoBlock").isPlayer("destroy")}function initPrivacyMask(){setTitle(lang.privacymask);var b=$("#videoBlock");if(checkPluginInstall()){b.isPlayer("setPlayWindowNum",2);var c=detectZoom();b.isPlayer("stopAllVideo");b.isPlayer("setWindowType",5);b.isPlayer("setPluginPosition",String(ParseInt(b.width()*c)),String(ParseInt(b.height()*c)));privacyVariables.installed=true}else{privacyVariables.installed=false}var a=0;$(".J-pri-mask-channel").change(function(){var d=$(this).data("lastPlayCh");var e=parseInt($(this).val());d!==undefined&&$("#videoBlock").isPlayer("stopPreview",d);$(this).data("lastPlayCh",e);if(window.top.nLiveviewDatabit[e]&&isIE()){b.isPlayer("setHttpPort").isPlayer("startPreview",1,e)}else{$("#videoBlock>.J-plugin-block").html("");var f=function(){configPurePlay(e,null,d,a);a++};getPlayEncodeInfo(e,f,true)}getCurrentResolution(loadPrivacyMask)});b.isPlayer("setDrawBlockNum",3,null,null,false,true);$('input[name="zoom"]').each(function(d){var e=$(this);e.click(function(){var g=$('input[name="zoom"]').eq(d).is(":checked");if(privacyVariables.installed){b.isPlayer("setOverlayEnable",$(".J-pri-mask-channel").val(),d,g?1:0);return}if(!g){b.isPlayer("delBlockData",d);b.find("canvas.draw-box").off("mousemove").off("mousedown").off("mouseup").off("mouseout")}else{var f=$('input[name="zoom"]:checked').length;b.isPlayer("setDrawBlockNum",f,null,null,false,false,d)}})})}function initChSel(){for(var a=0;a<privacyVariables.channelNum;++a){privacyVariables.privateDataBit[a]=0}var b=$(".J-pri-mask-channel");getChannelProtocolType(function(){initChannelSelect(b,getTotalChannelNum(),function(c){return xvrChannelConfig.osdAndPrivacy[c]==c});b.val()?$(".J-pri-mask-channel").change():rightPopup(lang.nolimit)})}function priMaskSave(){var a=$(".J-pri-mask-channel").val();api.privacyMask(REQUEST_SET,{channel:Number(a),area:getAreaData()},function(b){if(b!=CODE_SUCCESS){return}rightPopup(lang.saved)})}function loadPrivacyMask(){var b=$("#videoBlock");$(".J-mask-save").attr("disabled",true);var a=parseInt($(".J-pri-mask-channel").val());api.privacyMask(REQUEST_GET,{channel:a},function(d,f){if(d!=CODE_SUCCESS){$(".J-mask-save").attr("disabled",false);return}var e=f.area;autoFillValue("priMask.area1",e[0]);autoFillValue("priMask.area2",e[1]);autoFillValue("priMask.area3",e[2]);areaDataAssignment(e);var c=setTimeout(function(){if(privacyVariables.installed){for(var h=0;h<e.length;h++){b.isPlayer("setOverlayEnable",f.channel,h,e[h].enable?1:0)}b.isPlayer("setOverlayCoverConfig",a,privacyVariables);b.isPlayer("setOverlayCoverConfig1",a,privacyVariables);b.isPlayer("setOverlayCoverConfig2",a,privacyVariables)}else{b.isPlayer("setDrawBlockNum",3,null,null,false,true);for(var h=0;h<3;h++){b.isPlayer("addBlockData",Number(e[h].x/privacyVariables.width),Number((e[h].x+e[h].w)/privacyVariables.width),Number(e[h].y/privacyVariables.height),Number((e[h].y+e[h].h)/privacyVariables.height),true)}b.isPlayer("doBlockDraw")}clearInterval(c);var g=setTimeout(function(){$(".J-mask-save").attr("disabled",false);clearInterval(g)},100)},1000)})}function getCurrentResolution(b,a){api.systemDisplay(REQUEST_GET,{},function(d,e){if(d!==CODE_SUCCESS){return}var c=e.resolution.split("x");privacyVariables.width=Number(c[0]);privacyVariables.height=Number(c[1]);b&&b(a?a:"")})}function areaDataAssignment(a){privacyVariables.coverEnable0=a[0].enable?a[0].enable:0;privacyVariables.coverX0=a[0].x?a[0].x:0;privacyVariables.coverY0=a[0].y?a[0].y:0;privacyVariables.coverW0=a[0].w?a[0].w:0;privacyVariables.coverH0=a[0].h?a[0].h:0;privacyVariables.coverEnable1=a[1].enable?a[1].enable:0;privacyVariables.coverX1=a[1].x?a[1].x:0;privacyVariables.coverY1=a[1].y?a[1].y:0;privacyVariables.coverW1=a[1].w?a[1].w:0;privacyVariables.coverH1=a[1].h?a[1].h:0;privacyVariables.coverEnable2=a[2].enable?a[2].enable:0;privacyVariables.coverX2=a[2].x?a[2].x:0;privacyVariables.coverY2=a[2].y?a[2].y:0;privacyVariables.coverW2=a[2].w?a[2].w:0;privacyVariables.coverH2=a[2].h?a[2].h:0;privacyVariables.txtEnable0=0;privacyVariables.txtX0=0;privacyVariables.txtY0=0;privacyVariables.txtW0=0;privacyVariables.txtH0=0;privacyVariables.timeEnable0=0;privacyVariables.timeX0=0;privacyVariables.timeY0=0;privacyVariables.timeW0=0;privacyVariables.timeH0=0}function getAreaData(){var player=$("#videoBlock"),data=getMatchValue("priMask"),channel=data.channel,width=privacyVariables.width,height=privacyVariables.height;if(privacyVariables.installed){var lanJson0=eval("({"+player.isPlayer("getOverlayCoverConfig",channel,width,height)+"})"),lanJson1=eval("({"+player.isPlayer("getOverlayCoverConfig1",data.channel,privacyVariables.width,privacyVariables.height)+"})"),lanJson2=eval("({"+player.isPlayer("getOverlayCoverConfig2",data.channel,privacyVariables.width,privacyVariables.height)+"})"),x0=lanJson0.getoverlaycoverx0,y0=lanJson0.getoverlaycovery0,w0=lanJson0.getoverlaycoverw0,h0=lanJson0.getoverlaycoverh0,x1=lanJson1.getoverlaycoverx1,y1=lanJson1.getoverlaycovery1,w1=lanJson1.getoverlaycoverw1,h1=lanJson1.getoverlaycoverh1,x2=lanJson2.getoverlaycoverx2,y2=lanJson2.getoverlaycovery2,w2=lanJson2.getoverlaycoverw2,h2=lanJson2.getoverlaycoverh2}else{var blockData=player.isPlayer("getBlockData");for(var i=0;i<blockData.length;i++){privacyVariables["coverX"+i]=((blockData[i].x1*width));privacyVariables["coverW"+i]=(((blockData[i].x2-blockData[i].x1)*width));privacyVariables["coverH"+i]=(((blockData[i].y2-blockData[i].y1)*height));privacyVariables["coverY"+i]=((blockData[i].y1*height))}var x0=privacyVariables.coverX0,y0=privacyVariables.coverY0,w0=privacyVariables.coverW0,h0=privacyVariables.coverH0,x1=privacyVariables.coverX1,y1=privacyVariables.coverY1,w1=privacyVariables.coverW1,h1=privacyVariables.coverH1,x2=privacyVariables.coverX2,y2=privacyVariables.coverY2,w2=privacyVariables.coverW2,h2=privacyVariables.coverH2}var areaData=[{enable:data.area1.enable,x:parseInt(x0),y:parseInt(y0),w:parseInt(w0),h:parseInt(h0)},{enable:data.area2.enable,x:parseInt(x1),y:parseInt(y1),w:parseInt(w1),h:parseInt(h1)},{enable:data.area3.enable,x:parseInt(x2),y:parseInt(y2),w:parseInt(w2),h:parseInt(h2)}];return areaData};