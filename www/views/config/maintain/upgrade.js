var upgradeVariables={};function onLoad(){initDot();setTitle(lang.optionupgrade);$("#deviceReboot").on("click",function(){deviceReboot()});$("#ll").on("click",function(){$("#iptUpgradFile").click()});$("#iptUpgradFile").change(function(a){$("#updateFile").val($(this).val())});$("#upgrade").on("click",function(){deviceUpgrade()})}function deviceUpgrade(){var b=$("#updateFile").val();if(b==""){return rightPopup(lang.upgradeError1)}if(confirm(lang.upgradeTips)==false){return}loading(true);var c=new FormData($("#fmUpgrade")[0]);try{api.upgrade(c,function(f,d){loading(false);if(d!=HTTP_OK){return}var f=$.parseJSON(f);if(f.code!=CODE_SUCCESS){var e=getDeviceCode(parseInt(f.code));return rightPopup(f.code+":"+e)}setProgress()})}catch(a){return rightPopup(lang.optionexception+":/api/upgrade/upgrade-file")}}function setProgress(){try{api.upgradeProcess(REQUEST_GET,function(b,c){var d=c.process;if(d>=0&&d<100){loading(false);$("#progressText").text(d+"%");d=parseInt(d)*3.6;$("#progressInner").width(d);setTimeout(setProgress,1000)}else{$("#progressOuter").text("100%");$("#progressInner").width(362);setStorageItem("upgrade",true);doRestartCount(1)}})}catch(a){return rightPopup(lang.optionexception+":/api/upgrade/upgrade-process")}}function deviceReboot(){var a;if(isXVR()){a=nSynConfigDatabit[10]}else{a=nSynConfigDatabit[14]}if(!a){return rightPopup(lang.nolimit)}if(confirm(lang.confirmRestart)){setStorageItem("upgrade",true);api.restart(REQUEST_SET,function(b){if(b!=CODE_SUCCESS){return}});doRestartCount(0)}};