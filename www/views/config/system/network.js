var networkVariables={channelNum:getTotalChannelNum(),privatePortEn:isBitDog()};function onLoad(){setTitle(lang.localNet);setConf("rtspEncEn",isXVR());initDot();bindTagHead();initNetwork()}function isShowWifi(){return isNVR()&&wifiType==="WIFIV5"||wifiType==="WIFIV5"}function isShowWan(){return isWifiNvr()&&isHardware()}function isShowUpnp(){return isXVR()||isNVR()||wifiType==="WIFIV5"}function isShowNetfilter(){return isXVR()||isNVR()}function initNetwork(){initTcpEvent();initDdnsEvent();initEmailEvent();initP2PEvent();initFtpEvent();initUptpEvent();initPppoeEvent();initNetfilterEvent();initIpeyeEvent();initWanEvent();initDdns();initWifi()}var tcpVariables={oldNetMode:0,tcpDhcpEnable:false,httpPort:0,ipSetEnabled:isNVR()&&getDevConf("platformType")==9&&getTotalChannelNum()==64};function onTcpLoad(){initTcp()}function onDdnsLoad(){var a=parseInt($(".J-ddns-type").val());a=="11"?$("#getDdnsDomainName").prop("disabled",true):$("#getDdnsDomainName").prop("disabled",false);getDDNS(a)}function onEmailLoad(){initEmail()}function onP2pLoad(){initP2P()}function onFtpLoad(){initFtp()}function onWifiLoad(){wifiLoad(true)}function onUpnpLoad(){initUpnp()}function onPppoeLoad(){initPppoe()}function onNetfilterLoad(){initNetfilter()}function onIpeyeLoad(){initIpeye()}function onWanLoad(){initWan()}function initTcpEvent(){$(".J-tcp-save").on("click",function(){setTcpParam()})}function initDdnsEvent(){$(".J-ddns-save").on("click",function(){setDDNSParam()})}function initEmailEvent(){$("#checkSmtp1").on("click",function(){setCheckSmtp()});$(".J-smtp-save").on("click",function(){setSMTP()})}function initP2PEvent(){$(".J-p2p-save").on("click",function(){saveP2P()});$("#selEncType").change(function(){var a=$(".J-p2p-enable").data("p2pData");if(a.enable||$(".J-p2p-enable").prop("checked")){rightPopup(lang.tipChgEncType);$(this).val($(this).val()==0?1:0)}})}function initFtpEvent(){$("#checkFtp").on("click",function(){setCheckFtp()});$("#ftpSave").on("click",function(){setFTP()});$("#getFtpSchedChn").change(function(){if(parseInt($(this).val())!=250){var a=parseInt($(this).val())-1;loadFtp(a)}})}function initUptpEvent(){$("#upnpAllCheck").on("click",function(){enableUpnpAllValue()});$("#upnpAdd").on("click",function(){upnpAdd()});$("#upnpDel").on("click",function(){upnpDel()});$("#upnpSave").on("click",function(){upnpSave()})}function initPppoeEvent(){$("#pppoeSave").on("click",function(){pppoeSave()})}function initNetfilterEvent(){$("#addto").on("click",function(){addList()});$("#clrAll").on("click",function(){deleteList()});$("#bwlistSave").on("click",function(){setbwlistData()})}function initIpeyeEvent(){$(".J-clk-save").on("click",function(){onBtnSaveClk()})}function initWanEvent(){}function initTcp(){if(isNVR()){$("#broadcastInput1").parents(".form-item").hide()}if(networkVariables.privatePortEn){$("#blkPrivatePort").show()}if(tcpVariables.ipSetEnabled){$("#ipSetting").show()}if(getConf("rtspEncEn")){$(".func-rtsp-enc").show()}setIpEditStyle("ipaddr_input");setIpEditStyle("mask_input");setIpEditStyle("gate_input");setIpEditStyle("broadcast_input");setIpEditStyle("dns1_input");setIpEditStyle("dns2_input");setIpEditStyle("edtInternalIP");isPoeEnable()&&$(".func-poe").show();$("#dhcpAble").change(function(){if($("#dhcpAble").is(":checked")){$("#ipaddrInput").attr("disabled","disabled");$(".J-tcp-mask").attr("disabled","disabled");$("#gateInput").attr("disabled","disabled");$("#dns1Input").attr("disabled","disabled");$("#dns2Input").attr("disabled","disabled");$("#broadcastInput").attr("disabled","disabled")}else{$("#ipaddrInput").removeAttr("disabled");$(".J-tcp-mask").removeAttr("disabled");$("#gateInput").removeAttr("disabled");$("#dns1Input").removeAttr("disabled");$("#dns2Input").removeAttr("disabled");$("#broadcastInput").removeAttr("disabled")}});$("#dhcpAble1").change(function(){if($("#dhcpAble1").is(":checked")){$("#ipaddrInput1").attr("disabled","disabled");$("#maskInput1").attr("disabled","disabled");$("#gateInput1").attr("disabled","disabled")}else{$("#ipaddrInput1").removeAttr("disabled");$("#maskInput1").removeAttr("disabled");$("#gateInput1").removeAttr("disabled")}});if(isNVR()){getPpoeData()}loadNetSetting();$("[matchVal='mac']").attr("disabled","disabled");$("[matchVal='mac2']").attr("disabled","disabled");$("#netmode").change(function(){if($(this).val()==0){$("#lanType").val(0).attr("disabled","disabled");$("#lan2").show();$("#lan1").hide()}else{$("#lanType").show().removeAttr("disabled")}});$("#lanType").change(function(){if($(this).val()==0){$("#lan2").show();$("#lan1").hide();$("#dns1Input").removeAttr("disabled");$("#dns2Input").removeAttr("disabled");$("#broadcastInput1").removeAttr("disabled")}else{$("#lan1").show();$("#lan2").hide();$("#dns1Input").attr("disabled","disabled");$("#dns2Input").attr("disabled","disabled");$("#broadcastInput1").attr("disabled","disabled")}});setEditNumberStyle("#tcpInput",false,null);setEditNumberStyle("#dataInput",false,null);setEditNumberStyle("#httpInput",false,null);setEditNumberStyle("#privateInput",false,null);setEditNumberStyle("#tcpInput1",false,null);setEditNumberStyle("#dataInput1",false,null);setEditNumberStyle("#httpInput1",false,null)}function setTcpParam(){if(isPoeEnable()&&isPoeChange()&&isHttpChange()){rightPopup(lang.poeNote4);return}if(tcpVariables.ipSetEnabled){if($("#lanType").val()==1){setNet2Param();return}}var n=/^(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])$/;if((!n.test($("#ipaddrInput").val()))||($("#ipaddrInput").val()=="0.0.0.0")||($("#ipaddrInput").val()=="255.255.255.255")){rightPopup(lang.stDeIPV4+lang.formatErr);return}if((!n.test($(".J-tcp-mask").val()))||($(".J-tcp-mask").val()=="0.0.0.0")){rightPopup(lang.st4Mask+lang.formatErr);return}if((!n.test($("#gateInput").val()))||($("#gateInput").val()=="0.0.0.0")){rightPopup(lang.st4Gateway+lang.formatErr);return}if((!n.test($("#dns1Input").val()))||($("#dns1Input").val()=="0.0.0.0")){rightPopup(lang.defaultDNS+lang.formatErr);return}if($.trim($("#dns2Input").val())==""){$("#dns2Input").val("0.0.0.0")}if((!n.test($("#dns2Input").val()))){rightPopup(lang.defaultDNS2+lang.formatErr);return}if(checkPortUnique($("#lan2"))){rightPopup(lang.portrepeat);return}if($("[matchVal='tcp.tcpPort.']").val()<1025||$("[matchVal='tcp.tcpPort.']").val()>65535){rightPopup(lang.TCPport1+lang.fanwei+"1025-65535");return}if($("[matchVal='tcp.rtspPort.']").val()==554||(($("[matchVal='tcp.rtspPort.']").val()>1024&&$("[matchVal='tcp.rtspPort.']").val()<=65535))){}else{rightPopup(lang.RTSPport1+lang.fanwei+"554,1025-65535");return}if($("[matchVal='tcp.httpPort.']").val()==80||(($("[matchVal='tcp.httpPort.']").val()>1024&&$("[matchVal='tcp.httpPort.']").val()<=65535))){}else{rightPopup(lang.HTTPport1+lang.fanwei+"80,1025-65535");return}var m=false;var e=$("[name=port]");for(var g=0;g<e.length;g++){for(var f=g+1;f<e.length;f++){if(e[g].value!=""&&e[g].value==e[f].value){m=true;break}}}if(m){return rightPopup(lang.upnptip1)}if(isPoeEnable()){var h=ip2Int($(".J-tcp-mask").val());var p=h&ip2Int($("#ipaddrInput").val()),o=h&ip2Int($("#edtInternalIP").val());if(p===o){rightPopup(lang.poeNote5);return}}var l=false;if(tcpVariables.ipSetEnabled){var d=$("#ipaddrInput").val().split(".")[2];var b=$("#ipaddrInput1").val().split(".")[2];if(d==b){rightPopup(lang.lan);return}if($("#netmode").val()!=tcpVariables.oldNetMode){if(confirm(lang.netmode)==false){return}l=true}}if(isPoeEnable()&&!l){if(isPoeChange()){if(!confirm(lang.poeReboot)){return}l=true}}var k=$("[matchval='netno']").val();var c={networkWorkMode:parseInt($("#netmode").val()),networkCardName:k==0?"eth0":k==1?"eth1":"wlan0",enableDhcp:$("[matchVal='dhcpenable']").is(":checked")?true:false,ip:k==0?$("[matchval='netip']").val():$("#ipaddrInput1").val(),netMask:k==0?$("[matchval='netmask']").val():$("#maskInput1").val(),gateway:$("[matchval='tcp.gateway.']").val(),dns1:$("[matchval='tcp.dns1.']").val(),dns2:$("[matchval='tcp.dns2.']").val(),macAddr:k==0?$("[matchval='mac']").val():$("#macInput1").val(),rtspPort:k==0?parseInt($("[matchval='tcp.rtspPort.']").val()):parseInt($("#dataInput1").val()),httpPort:k==0?parseInt($("[matchval='tcp.httpPort.']").val()):Number($("#httpInput1").val()),tcpPort:k==0?parseInt($("[matchval='tcp.tcpPort.']").val()):Number($("#tcpInput1").val()),privatePort:parseInt($("[matchval='tcp.privatePort.']").val())};isXVR()&&api.rtspEnable(REQUEST_SET,getMatchValue("rtsp"),function(i){});var a=function(i){api.tcp(REQUEST_SET,c,function(j){if(isPoeEnable()){c.networkCardName="eth1";c.ip=$("#edtInternalIP").val();api.tcp(REQUEST_SET,c,function(q){})}if(j==0){i&&i()}})};saveNetport(l,a);m_TcpPort=$("[matchVal='tcp.tcpPort.']").val()}function checkPortUnique(c){var d=["rtspserverport","tcpport","httpport"],e=[];networkVariables.privatePortEn&&d.push("getuploadport");for(var b=0;b<d.length;++b){var a=c.find("[matchVal='"+d[b]+"']").val();if(e.indexOf(a)!=-1){return false}e.push(a)}return true}function setNet2Param(){var c=/^(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])$/;if((!c.test($("#ipaddrInput1").val()))||($("#ipaddrInput1").val()=="0.0.0.0")||($("#ipaddrInput1").val()=="255.255.255.255")){rightPopup(lang.stDeIPV4+lang.formatErr);return}if((!c.test($("#maskInput1").val()))||($("#maskInput1").val()=="0.0.0.0")){rightPopup(lang.st4Mask+lang.formatErr);return}if((!c.test($("#gateInput1").val()))||($("#gateInput1").val()=="0.0.0.0")){rightPopup(lang.st4Gateway+lang.formatErr);return}var f=$("#ipaddrInput").val().split(".")[2];var e=$("#ipaddrInput1").val().split(".")[2];if(f==e){rightPopup(lang.lan);return}var a=false;if($("#netmode").val()!=tcpVariables.oldNetMode){if(confirm(lang.netmode)==false){return}a=true}$(".J-tcp-save").prop("disabled",true);m_TcpPort=$("[matchVal='tcpport']").val();var b=$("#lanType").val();var g={networkWorkMode:parseInt($("#netmode").val()),networkCardName:b==0?"eth0":b==1?"eth1":"wlan0",enableDhcp:$("[matchVal='dhcpenable']").is(":checked")?true:false,ip:b==0?$("[matchval='netip']").val():$("#ipaddrInput1").val(),netMask:b==0?$("[matchval='netmask']").val():$("#maskInput1").val(),gateway:$("[matchval='tcp.gateway.']").val(),dns1:$("[matchval='tcp.dns1.']").val(),dns2:$("[matchval='tcp.dns2.']").val(),macAddr:b==0?$("[matchval='mac']").val():$("#macInput1").val(),rtspPort:b==0?parseInt($("[matchval='tcp.rtspPort.']").val()):parseInt($("#dataInput1").val()),httpPort:b==0?parseInt($("[matchval='tcp.httpPort.']").val()):Number($("#httpInput1").val()),tcpPort:b==0?parseInt($("[matchval='tcp.tcpPort.']").val()):Number($("#tcpInput1").val()),privatePort:parseInt($("[matchval='tcp.privatePort.']").val())};var d=function(h){api.tcp(REQUEST_SET,g,function(i){if(isPoeEnable()){g.networkCardName="eth1";g.ip=$("#edtInternalIP").val();api.tcp(REQUEST_SET,g,function(j){})}if(i==0){h&&h()}})};saveNetport(a,d);m_TcpPort=$("[matchVal='tcp.tcpPort.']").val()}function loadNetSetting(){api.tcp(REQUEST_GET,null,function(c,d){if(c!=CODE_SUCCESS){return}$("[matchval='networkWorkMode']").val(d.networkWorkMode);if(d.networkCardList[0]){$("[matchval='netip']").val(d.networkCardList[0].ip);$("[matchval='mac']").val(d.networkCardList[0].mac);$("[matchVal='dhcpenable']").prop("checked",d.networkCardList[0].enableDhcp);$(".J-tcp-mask").val(d.networkCardList[0].netMask);$("#ipaddrInput").attr("ls-ori",d.networkCardList[0].ip)}$("#lanType").empty();for(var b=0;b<d.networkCardList.length;++b){$("#lanType").append($("<option></option>").val(b).html(d.networkCardList[b].networkCardName))}if(d.networkCardList[1]){$("#edtInternalIP").val(d.networkCardList[1].ip);autoFillValue("lan1",d.networkCardList[1])}autoFillValue("tcp",d);window.g_bChgDhcp=$("#dhcpAble").prop("checked");tcpVariables.httpPort=1*$("[matchVal='tcp.httpPort.']").val();$("[matchVal='tcp.httpPort.']").attr("ls-ori",tcpVariables.httpPort);tcpVariables.tcpDhcpEnable=$("[matchVal='dhcpenable']").is(":checked");if(tcpVariables.tcpDhcpEnable){$("#ipaddrInput, .J-tcp-mask, #gateInput, #dns1Input, #dns2Input, #broadcastInput").attr("disabled","disabled")}else{$("#ipaddrInput").removeAttr("disabled");$(".J-tcp-mask").removeAttr("disabled");ParseInt(d.getpppoeenable)==0&&$("#dns1Input").removeAttr("disabled");ParseInt(d.getpppoeenable)==0&&$("#dns2Input").removeAttr("disabled");ParseInt(d.getpppoeenable)==0&&$("#gateInput").removeAttr("disabled");$("#broadcastInput").removeAttr("disabled")}if(tcpVariables.ipSetEnabled){var a=$("[matchVal='dhcpenable2']").is(":checked");if(a){$("#ipaddrInput1").attr("disabled","disabled");$("#maskInput1").attr("disabled","disabled");$("#gateInput1").attr("disabled","disabled")}else{$("#ipaddrInput1").removeAttr("disabled");$("#maskInput1").removeAttr("disabled");$("#gateInput1").removeAttr("disabled")}tcpVariables.oldNetMode=$("#netmode").val();if($("#netmode").val()==1){$("#lanType").removeAttr("disabled")}}if(isHardware()){$(".medium-input").attr("disabled","disabled");$("#dhcpAble").prop("disabled","disabled")}$("#edtInternalIP").attr("ls-ori",$("#edtInternalIP").val());isXVR()&&api.rtspEnable(REQUEST_GET,null,function(e,f){if(e!=CODE_SUCCESS){return}autoFillValue("rtsp",f)})})}function saveNetport(b,f){if(b||getHost()!=$("#ipaddrInput").val()||getHttpPort()!=$("#httpInput").val()){var e=$("#ipaddrInput").val();var c=$("#httpInput").val();doRestartCount(3,e,c)}var d=false;var a=function(){if(d){return}d=true;f&&f(function(){if(window.g_bChgDhcp!==$("[matchVal='dhcpenable']").is(":checked")&&!window.g_bChgDhcp){alert(lang.newiplogin)}else{if(b){api.restart(REQUEST_SET,function(g){if(g!=CODE_SUCCESS){return}})}else{rightPopup(lang.saved)}}});$(".J-tcp-save").prop("disabled",false)};a()}function isHttpChange(){return $("#ipaddrInput").val()!==$("#ipaddrInput").attr("ls-ori")||$("#httpInput").val()!==$("#httpInput").attr("ls-ori")}function isPoeChange(){var a=$("#edtInternalIP").attr("ls-ori");a=a.substr(0,a.lastIndexOf("."));var b=$("#edtInternalIP").val();b=b.substr(0,b.lastIndexOf("."));return a!=b}function getPpoeData(){var b=getUserName();var a=getAuth();api.newGetCapability(REQUEST_GET,{username:b},function(c,h){var k=roundOne();var j=h.encryptionType[0];var i=roundTwo(b,h.param[j].salt,k[0],a);var g=reverseRoundThree(i);var f=roundFour(h.param[j].iterations,g);var e=roundFive(f);var d={encryptionType:j,loginName:String(getUserName()),datetime:k[1],iv:"afe13ds34cdjk08c"};api.pppoe(REQUEST_GET,d,function(l,m){if(l!=CODE_SUCCESS){return}if(m.enable){if($("#dhcpAble").prop("checked")){$("#dhcpAble").prop("checked",false);setTcpParam()}$("#dhcpAble").prop("disabled",true);$("#dns1Input").attr("disabled",true);$("#dns2Input").attr("disabled",true);$("#gateInput").attr("disabled",true)}else{$("#dhcpAble").prop("disabled",false);$("#dns1Input").attr("disabled",false);$("#dns2Input").attr("disabled",false);$("#gateInput").attr("disabled",false)}})})}function ip2Int(b){var a=0;b=b.split(".");a=(Number(b[0])<<24)+(Number(b[1])<<16)+(Number(b[2])<<8)+Number(b[3]);return a}var ddnsVariables={};function initDdns(a){if(!isXVR()&&!isNVR()){$(".J-ddns-type option.ls-spec-zebeye").remove();$(".J-ddns-type option.ls-spec-hdpro").val(8)}if(!isXVR()&&!isNVR()){$(".J-ddns-type option.ls-spec-hdpro").remove()}$(".J-ddns-save").val(lang.save);loading(true);$(".J-ddns-type").change(function(){var b=parseInt($(".J-ddns-type").val());b=="11"?$("#getDdnsDomainName").prop("disabled",true):$("#getDdnsDomainName").prop("disabled",false);getDDNS(b)});setEditNumberStyle("#getDdnsIntertime",false,null);$(".J-ddns-username").bind("keydown keyup blur",function(){if(!isXVR()){checkStringValid($(this).val(),this,1)}else{checkStringValid($(this).val(),this,0)}})}function getDDNS(b){var c=getUserName();var a=getAuth();api.newGetCapability(REQUEST_GET,{username:c},function(d,i){b||(b=0);var l=roundOne();var k=i.encryptionType[0];var j=roundTwo(c,i.param[k].salt,l[0],a);var h=reverseRoundThree(j);var g=roundFour(i.param[k].iterations,h);var f=roundFive(g);var e={encryptionType:k,loginName:String(getUserName()),datetime:l[1],iv:"afe13ds34cdjk08c",serverType:b};api.DDNS(REQUEST_GET,e,function(m,n){if(m!=CODE_SUCCESS){return}$(".J-ddns-type").prop("checked",n.type);n.username=n.username?decrypt(n.username,f):n.username;$("#getDdnsUserPwd").val("");autoFillValue("DDNS",n)})})}function setDDNSParam(){if($("[matchVal='getDdnsintertime']").val()<60){rightPopup(lang.fanwei+"60--600");return}if(!checkUserPwdValid($("#getDdnsUserPwd").val())){rightPopup(lang.nosupport);return}if(!checkDomain($("#getDdnsDomainName").val())&&$("#getDdnsDomainName").val()){rightPopup(lang.domain+lang.formatErr);return}if($(".J-ddns-username").val().length>64){rightPopup(lang.nosupport9)}if(isXVR()){if(findSpace($("#getDdnsUserPwd").val())){rightPopup(lang.nosupport);return}}var a=getUserName();api.newGetCapability(REQUEST_GET,{username:a},function(b,h,j){var m=getAuth();var k=h.encryptionType[0];var l=roundOne();var i=roundTwo(a,h.param[k].salt,l[0],m);var g=reverseRoundThree(i);var f=roundFour(h.param[k].iterations,g);var d=roundFive(f);var e=getMatchValue("DDNS");e.encryptionType=k;e.loginName=String(a);e.datetime=l[1];e.iv="afe13ds34cdjk08c";e.serverType=parseInt($(".J-ddns-type").val());e.password=e.password?encrypt(e.password,d):e.password;e.username=e.username?encrypt(e.username,d):e.username;api.DDNS(REQUEST_SET,e,function(c,n){showSaveMsg(c)})})}var emailVariables={weekSchedule:new Array(8),timeSchedule:[]};function initEmail(){$("#checkSmtp1").attr("title",lang.emailTest);setConf("isAutoSendEn",isXVR()||isNVR());setConf("isEmailScheduleEn",isXVR()||isNVR());loading(true);if(getConf("isAutoSendEn")){$("#smtpEableAutoSend").show();$("#smtpAutoSendInterval").show()}$("#smtpReceiver1").show();$("#smtpReceiver2").show();setEditNumberStyle("#getSmtpPort");setEditNumberStyle("#getSmtpInterval");if(getConf("isEmailScheduleEn")){var a=function(d){var b=parseInt($("#getSmtpSchedDate").val());for(var c=0;c<d.length;++c){emailVariables.timeSchedule[b][d[c].attr("matchVal")]=d[c].val()}};setTimeRangeEdit("#getsmtpschedstarthour1","#getsmtpschedstartmin1","#getsmtpschedstophour1","#getsmtpschedstopmin1",a);setTimeRangeEdit("#getsmtpschedstarthour2","#getsmtpschedstartmin2","#getsmtpschedstophour2","#getsmtpschedstopmin2",a);$("#getSmtpSchedDate").change(function(){var b=parseInt($(this).val());for(var c in emailVariables.weekSchedule[b]){$("[matchVal='"+c+"']").val(emailVariables.weekSchedule[b][c]).blur()}}).val((new Date()).getDay()).parents(".form-item").show();$(".form-title[lang='recschedule']").show();$("#recSchedule1").show();$("#recSchedule2").show()}setEditNumberStyle("#getSmtpAutoSendInterval");$("#getSmtpServer").change(function(){$("#getSmtpServer").val()=="custom"?$("#customServer").prop("disabled",false):$("#customServer").prop("disabled",true)}).change();loadEmailSetting();$("#getSmtpSchedDate").change(function(){var b=$(this).val();getEmailTime(b)})}function setCheckSmtp(){$("#checkSmtp1").attr("disabled","disabled").val(lang.testing);loading(true);api.email(REQUEST_TEST,null,function(a,b){loading(false);if(a!=CODE_SUCCESS){return}$("#checkSmtp1").removeAttr("disabled").val(lang.emailTest);if(b&&b.testEmailStatus===1){rightPopup(lang.smtptestsuccess)}else{rightPopup(lang.smtptestfail)}})}function setSMTP(){var b=$(".J-password").val();if($(".J-password").val()!=$("#getSmtpPasswd2").val()){rightPopup(lang.usertip7);return}if(!checkUserPwdValid(b)||/.*[\u4e00-\u9fa5]+.*$/.test($("#getSmtpTheme").val())){rightPopup(lang.nosupport);return}$("[matchVal='email.username.']").val($.trim($("[matchVal='email.username.']").val()));$("[matchVal='email.sender.']").val($.trim($("[matchVal='email.sender.']").val()));$("[matchVal='email.receiver1.']").val($.trim($("[matchVal='email.receiver1.']").val()));$("[matchVal='email.receiver2.']").val($.trim($("[matchVal='email.receiver2.']").val()));$("[matchVal='email.receiver3.']").val($.trim($("[matchVal='email.receiver3.']").val()));if((!checkEmail($("[matchVal='email.username.']").val())&&$("[matchVal='email.username.']").val())||(!checkEmail($("[matchVal='email.sender.']").val())&&$("[matchVal='email.sender.']").val())||(!checkEmail($("[matchVal='email.receiver1.']").val())&&$("[matchVal='email.receiver1.']").val())||(!checkEmail($("[matchVal='email.receiver2.']").val())&&$("[matchVal='email.receiver2.']").val())||(!checkEmail($("[matchVal='email.receiver3.']").val())&&$("[matchVal='email.receiver3.']").val())){rightPopup(lang.email+lang.formatErr);return}if($("[matchVal='email.theme.']").val().match(/[!%&#=]+/)!=null){rightPopup(lang.nosupport1);return}if(!$("#customServer").prop("disabled")&&!checkDomain($("#customServer").val())){rightPopup(lang.domain+lang.formatErr);return}if($("#getSmtpTheme").val().match(/[\（\）\《\》\——\；\，\。\“\”\<\>\！\、\…\￥]+/)!=null){rightPopup(lang.nosupport);return}if(getConf("isEmailScheduleEn")){var a=parseInt($("#getSmtpSchedDate").val());var j=0,c=7;if(a==7){c=8}var g=[];for(var e=j;e<c;++e){g.push({weekDay:e,segNum:2,oneDay:[{startTime:emailVariables.timeSchedule[e].startHour1*3600+emailVariables.timeSchedule[e].startMin1*60,endTime:emailVariables.timeSchedule[e].endHour1*3600+emailVariables.timeSchedule[e].endMin1*60},{startTime:emailVariables.timeSchedule[e].startHour2*3600+emailVariables.timeSchedule[e].startMin2*60,endTime:emailVariables.timeSchedule[e].endHour2*3600+emailVariables.timeSchedule[e].endMin2*60}]});var k=[g[e].oneDay[0].startTime,g[e].oneDay[0].endTime],h=[g[e].oneDay[1].startTime,g[e].oneDay[1].endTime];var f=-1;if(k[0]==k[1]&&k[0]!=0){f=1}else{if(h[0]==h[1]&&h[0]!=0){f=2}}if(f>0){rightPopup(lang.setTimeTips2);$("#getSmtpSchedDate").val(e).change();lightTipDom($("#recschedule"+f).find(".time-input"));e!=a&&lightTipDom($("#getSmtpSchedDate"));return}}}var d=getUserName();api.newGetCapability(REQUEST_GET,{username:d},function(l,q,t){var w=getAuth();var u=q.encryptionType[0];var v=roundOne();var r=roundTwo(d,q.param[u].salt,v[0],w);var p=reverseRoundThree(r);var o=roundFour(q.param[u].iterations,p);var m=roundFive(o);var s=$("#getSmtpServer").val()=="custom"?$("#customServer").val():$("[matchVal='getsmtpserver']").val();var i=getMatchValue("email");i.enableHealth=0;i.healthInterval=0;i.anonymity=0;i.server=s;i.username=encrypt(i.username,m);i.password=encrypt(i.password,m);var n={encryptionType:u,loginName:String(d),datetime:v[1],iv:"afe13ds34cdjk08c",base:i,schedTime:g};api.email(REQUEST_SET,n,function(x,y){if(x!=CODE_SUCCESS){return}rightPopup(lang.saved)})})}function loadEmailSetting(b){var c=getUserName();var a=getAuth();api.newGetCapability(REQUEST_GET,{username:c},function(d,i){var l=roundOne();var k=i.encryptionType[0];var j=roundTwo(c,i.param[k].salt,l[0],a);var h=reverseRoundThree(j);var g=roundFour(i.param[k].iterations,h);var e=roundFive(g);var f={encryptionType:k,loginName:String(getUserName()),datetime:l[1],iv:"afe13ds34cdjk08c"};api.email(REQUEST_GET,f,function(n,o){if(n!=CODE_SUCCESS){return}if($("#getSmtpServer").val()!=o.base.server){$("#getSmtpServer").val("custom");$("#customServer").val(o.base.server);$("#customServer").prop("disabled",false)}else{$("#customServer").prop("disabled",true)}try{o.base.username=decrypt(o.base.username,e)}catch(m){}var p=o.schedTime;transformTimeDate(p,false);autoFillValue("email",o.base)})})}function getEmailTime(a,c){c&&(emailVariables.timeSchedule=c);if(a<8){!emailVariables.timeSchedule[7]&&emailVariables.timeSchedule.push({startHour1:"00",startMin1:"00",endHour1:"00",endMin1:"00",startHour2:"00",startMin2:"00",endHour2:"00",endMin2:"00"});var b=emailVariables.timeSchedule;$("[matchVal='startHour1']").val(b[a].startHour1);$("[matchVal='startMin1']").val(b[a].startMin1);$("[matchVal='endHour1']").val(b[a].endHour1);$("[matchVal='endMin1']").val(b[a].endMin1);$("[matchVal='getftpschedtype1']").val(b[a].segNumEnable1);$("[matchVal='getftpschedtype2']").val(b[a].segNumEnable2);$("[matchVal='startHour2']").val(b[a].startHour2);$("[matchVal='startMin2']").val(b[a].startMin2);$("[matchVal='endHour2']").val(b[a].endHour2);$("[matchVal='endMin2']").val(b[a].endMin2)}}function transformTimeDate(d,c){var a=[];for(var b=0;b<d.length;b++){a.push({startHour1:secondsToHour(d[b].oneDay[0].startTime)[0],startMin1:secondsToHour(d[b].oneDay[0].startTime)[1],endHour1:secondsToHour(d[b].oneDay[0].endTime)[0],endMin1:secondsToHour(d[b].oneDay[0].endTime)[1],startHour2:secondsToHour(d[b].oneDay[1].startTime)[0],startMin2:secondsToHour(d[b].oneDay[1].startTime)[1],endHour2:secondsToHour(d[b].oneDay[1].endTime)[0],endMin2:secondsToHour(d[b].oneDay[1].endTime)[1]});if(c){a[b].segNumEnable1=d[b].oneDay[0].enableSegNum;a[b].segNumEnable2=d[b].oneDay[1].enableSegNum}}getEmailTime($("#getSmtpSchedDate").val(),a);getFtpTime($("#getFtpSchedDate").val(),a)}function secondsToHour(d){var e=parseInt(d);var b=0;var c=0;if(e>60){b=parseInt(e/60);e=parseInt(e%60);if(b>=60){c=parseInt(b/60);b=parseInt(b%60)}}var a=["00","00"];if(b>0){a[1]=parseInt(b)<10?"0"+b:b}if(c>0){a[0]=parseInt(c)<10?"0"+c:c}return a}var p2pVariables={qrcodeIOS:"",qrcodeAndroid:"",serverUrl:""};function initP2P(){setConf("isSSL",isNVR()||isXVR());setConf("isInterval",isNVR()||isXVR());isAlDevice()?$(".al").show():$(".bit-dog").show();(getConf("isSSL")||getConf("isInterval"))&&$("#selEncType").parents(".form-item").show();getConf("isMtPushImg")&&$("#chkPushImg").parents(".form-item").show();getConf("isInterval")&&$("#selInterval").parents(".form-item").show();$("#code1,#code2").html("");p2pVariables.qrcodeIOS=new QRCode(document.getElementById("code1"),{width:116,height:116});p2pVariables.qrcodeAndroid=new QRCode(document.getElementById("code2"),{width:116,height:116});if(isAlDevice()){$("#code1").parent().hide();$("#snLabel").parent().hide();$(".al-sn").show();$(".p2p-table").addClass("alP2pTable")}loadP2P()}function saveP2P(){loading(true);var a={enable:$(".enable-p2p").prop("checked"),sslEnable:parseInt($("#selEncType").val())?true:false,imagePushInterval:parseInt($("#selInterval").val())};api.p2p(REQUEST_SET,a,function(b,c){if(b!=CODE_SUCCESS){return}loadP2P();rightPopup(lang.saved)})}function loadP2P(){loading(true);api.p2p(REQUEST_GET,null,function(a,b){if(a!=CODE_SUCCESS){return}p2pVariables.qrcodeAndroid.makeCode(b.androidAppUrl);b.connectStatus=b.connectStatus?lang.p2pSuccess:lang.p2pFailure;b.sslEnable=b.sslEnable?1:0;$("#p2pState").val(b.connectStatus);$("#selEncType").val(b.sslEnable);$(".J-p2p-enable").prop("checked",b.enable).data("p2pData",b);$("#selInterval").val(b.imagePushInterval);if(isNVR()){p2pVariables.serverUrl=b.iosAppUrl}$("#snLabel").text(b.serialNum);p2pVariables.qrcodeIOS.makeCode(b.serialNum)})}var ftpVariables={ftpTimeSchedule:[]};var ftpTimeSchedule=[];function initFtp(){var b=0;$("#checkFtp").attr("title",lang.sttest);setIpEditStyle("getftpservierip");var a=new Date();b=a.getDay();$("#getFtpSchedChn").html("");$("#getFtpSchedDate").val(b);getselectoption(getTotalChannelNum());$("#getFtpSchedChn").val(1);loadFtp(0);setTimeRangeEdit("#getFtpSchedIsStartHour1","#getFtpSchedIsStartMin1","#getFtpSchedIsStopHour1","#getFtpSchedIsStoptMin1",null);setTimeRangeEdit("#getFtpSchedIsStartHour2","#getFtpSchedIsStartMin2","#getFtpSchedIsStopHour2","#getFtpSchedIsStoptMin2",null);var c=$("#getFtpSchedDate").val();$("#getFtpSchedDate").change(function(){c=$(this).val();getFtpTime(c)});$("#getFtpSchedType1, #getFtpSchedType2").change(function(){ftpTimeSchedule[c].segNumEnable1=$("#getFtpSchedType1").is(":checked");ftpTimeSchedule[c].segNumEnable2=$("#getFtpSchedType2").is(":checked")});setEditNumberStyle("#getFtpPort",false,null);$("#getFtpSchedIsStartHour1").bind({keyup:function(d){if(keyboardFilter(d)){this.value=numberRangeLimt(this,0,23);ftpTimeSchedule[c].startHour1=this.value}},blur:function(){if(this.value==""){this.value="00"}ftpTimeSchedule[c].startHour1=this.value}});$("#getFtpSchedIsStartMin1").bind({keyup:function(d){if(keyboardFilter(d)){this.value=numberRangeLimt(this,0,59);ftpTimeSchedule[c].startMin1=this.value}},blur:function(){if(this.value==""){this.value="00"}ftpTimeSchedule[c].startMin1=this.value}});$("#getFtpSchedIsStopHour1").bind({keyup:function(d){if(keyboardFilter(d)){this.value=numberRangeLimt(this,0,24);ftpTimeSchedule[c].endHour1=this.value}},blur:function(){if(this.value==""){this.value="00"}if($("#getFtpSchedIsStoptMin1").val()>0){this.value=numberRangeLimt(this,0,23)}ftpTimeSchedule[c].endHour1=this.value}});$("#getFtpSchedIsStoptMin1").bind({keyup:function(d){if(keyboardFilter(d)){this.value=numberRangeLimt(this,0,59);ftpTimeSchedule[c].endMin1=this.value}},blur:function(){if(this.value==""||$("#getFtpSchedIsStopHour1").val()==24){this.value="00"}ftpTimeSchedule[c].endMin1=this.value}});$("#getFtpSchedIsStartHour2").bind({keyup:function(d){if(keyboardFilter(d)){this.value=numberRangeLimt(this,0,23);ftpTimeSchedule[c].startHour2=this.value}},blur:function(){if(this.value==""){this.value="00"}ftpTimeSchedule[c].startHour2=this.value}});$("#getFtpSchedIsStartMin2").bind({keyup:function(d){if(keyboardFilter(d)){this.value=numberRangeLimt(this,0,59);ftpTimeSchedule[c].startMin2=this.value}},blur:function(){if(this.value==""){this.value="00"}ftpTimeSchedule[c].startMin2=this.value}});$("#getFtpSchedIsStopHour2").bind({keyup:function(d){if(keyboardFilter(d)){this.value=numberRangeLimt(this,0,24);ftpTimeSchedule[c].endHour2=this.value}},blur:function(){if(this.value==""){this.value="00"}if($("#getFtpSchedIsStoptMin2").val()>0){this.value=numberRangeLimt(this,0,23);ftpTimeSchedule[c].endHour2=this.value}}});$("#getFtpSchedIsStoptMin2").bind({keyup:function(d){if(keyboardFilter(d)){this.value=numberRangeLimt(this,0,59);ftpTimeSchedule[c].endMin2=this.value}},blur:function(){if(this.value==""||$("#getFtpSchedIsStopHour2").val()==24){this.value="00"}ftpTimeSchedule[c].endMin2=this.value}});$("#getFtpUserName").bind("keydown keyup blur",function(){if(!isXVR()){checkStringValid($(this).val(),this,1)}else{checkStringValid($(this).val(),this,0)}})}function setCheckFtp(){$("#checkFtp").attr("disabled","disabled").val(lang.testing);api.ftp(REQUEST_TEST,null,function(a,b){if(a!=CODE_SUCCESS){return}$("#checkFtp").removeAttr("disabled").val(lang.sttest);if(b.testFtpStatus==1){rightPopup(lang.ftptestok)}else{rightPopup(lang.ftptestfail)}})}function getFtpTime(a,c){c&&(ftpTimeSchedule=c);if(a<8){!ftpTimeSchedule[7]&&ftpTimeSchedule.push({startHour1:"00",startMin1:"00",endHour1:"00",endMin1:"00",startHour2:"00",startMin2:"00",endHour2:"00",endMin2:"00",segNumEnable1:false,segNumEnable2:false});var b=ftpTimeSchedule;$("[matchVal='getftpschedisstarthour1']").val(b[a].startHour1);$("[matchVal='getftpschedisstartmin1']").val(b[a].startMin1);$("[matchVal='getftpschedisstophour1']").val(b[a].endHour1);$("[matchVal='getftpschedisstoptmin1']").val(b[a].endMin1);$("[matchVal='getftpschedtype1']").prop("checked",b[a].segNumEnable1);$("[matchVal='getftpschedtype2']").prop("checked",b[a].segNumEnable2);$("[matchVal='getftpschedisstarthour2']").val(b[a].startHour2);$("[matchVal='getftpschedisstartmin2']").val(b[a].startMin2);$("[matchVal='getftpschedisstophour2']").val(b[a].endHour2);$("[matchVal='getftpschedisstoptmin2']").val(b[a].endMin2)}}function getselectoption(a){$("<option value='"+250+"' >"+lang.allchannel+"</option>").appendTo($("#getFtpSchedChn"));for(var b=1;b<=a;b++){var c=b>9?b:"0"+b;$("<option value='"+b+"' >CH"+c+"</option>").appendTo($("#getFtpSchedChn"))}}function setFTP(){if($("#getFtpFolderName").val().length>32){rightPopup(lang.nosupport13);return}if(!userInput($("#getFtpFolderName").val())||!checkUserPwdValid($("[matchVal='ftp.password.']").val())){rightPopup(lang.nosupport);return}if($("[matchVal='ftp.password.']").val().match(/[ ]+/)!=null){rightPopup(lang.nosupport);return}if(isXVR()){if(findSpace($("#getFtpPassword").val())||findSpace($("#getFtpPassword2").val())){rightPopup(lang.nosupport);return}}if($("#getFtpPassword2").val()!=$("#getFtpPassword").val()){rightPopup(lang.usertip7);return}var l=/^(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])$/;if((!l.test($("#getFtpServieRip").val()))||($("#getFtpServieRip").val()=="0.0.0.0")){rightPopup(lang.IPAddr+lang.formatErr);return}var a=parseInt($("#getFtpSchedDate").val());var j=0,b=7;if(a==7){b=8}var h=$("#getFtpSchedDate").val();var f=[];for(var d=j;d<b;++d){f.push({weekDay:d,segNum:2,oneDay:$("#getFtpSchedChn").val()!=250?[{enableSegNum:ftpTimeSchedule[d].segNumEnable1,startTime:ftpTimeSchedule[d].startHour1*3600+ftpTimeSchedule[d].startMin1*60,endTime:ftpTimeSchedule[d].endHour1*3600+ftpTimeSchedule[d].endMin1*60},{enableSegNum:ftpTimeSchedule[d].segNumEnable2,startTime:ftpTimeSchedule[d].startHour2*3600+ftpTimeSchedule[d].startMin2*60,endTime:ftpTimeSchedule[d].endHour2*3600+ftpTimeSchedule[d].endMin2*60}]:[{enableSegNum:ftpTimeSchedule[h].segNumEnable1,startTime:ftpTimeSchedule[h].startHour1*3600+ftpTimeSchedule[h].startMin1*60,endTime:ftpTimeSchedule[h].endHour1*3600+ftpTimeSchedule[h].endMin1*60},{enableSegNum:ftpTimeSchedule[h].segNumEnable2,startTime:ftpTimeSchedule[h].startHour2*3600+ftpTimeSchedule[h].startMin2*60,endTime:ftpTimeSchedule[h].endHour2*3600+ftpTimeSchedule[h].endMin2*60}]});var k=[f[d].oneDay[0].startTime,f[d].oneDay[0].endTime],g=[f[d].oneDay[1].startTime,f[d].oneDay[1].endTime];var e=-1;if(k[0]==k[1]&&k[0]!=0){e=1}else{if(g[0]==g[1]&&g[0]!=0){e=2}}if(e>0){rightPopup(lang.setTimeTips2);$("#getFtpSchedDate").val(d).change();lightTipDom($("#ftpSchedule"+e).find(".time-check"));d!=a&&lightTipDom($("#getFtpSchedDate"));return}}var c=getUserName();api.newGetCapability(REQUEST_GET,{username:c},function(m,r,u){var x=getAuth();var v=r.encryptionType[0];var w=roundOne();var s=roundTwo(c,r.param[v].salt,w[0],x);var q=reverseRoundThree(s);var p=roundFour(r.param[v].iterations,q);var n=roundFive(p);var i=getMatchValue("ftp");i.username=encrypt($("[matchVal='ftp.username.']").val(),n);i.password=encrypt($("[matchVal='ftp.password.']").val(),n);var t=parseInt($("#getFtpSchedChn").val());var o={encryptionType:v,loginName:String(c),datetime:w[1],iv:"afe13ds34cdjk08c",base:i,schedTime:f,channel:t===250?t:t-1};api.ftp(REQUEST_SET,o,function(y,z){if(y!=CODE_SUCCESS){return}showSaveMsg(y)})})}function load_ftp_schedule(b){var a=0;if(b*1!=250){a=b}}var ftpList=[];function loadFtp(b){var c=getUserName();var a=getAuth();api.newGetCapability(REQUEST_GET,{username:c},function(d,i){var l=roundOne();var k=i.encryptionType[0];var j=roundTwo(c,i.param[k].salt,l[0],a);var h=reverseRoundThree(j);var g=roundFour(i.param[k].iterations,h);var f=roundFive(g);var e={encryptionType:k,loginName:String(getUserName()),datetime:l[1],iv:"afe13ds34cdjk08c",channel:b};api.ftp(REQUEST_GET,e,function(o,p){try{p.base.username=p.base.username?decrypt(p.base.username,f):p.base.username}catch(m){console.log("解密错误:密文->"+p.base.username,";key->",f)}autoFillValue("ftp",p.base);ftpList=p.schedTime;transformTimeDate(ftpList,true);var n=$("#getFtpSchedDate").val()})})}var upnpVariables={};function UpnpListVal(){this.serverName=new Array;this.upnptype=new Array;this.inport=new Array;this.outport=new Array;this.sel=new Array}var nUpnpListVal=new UpnpListVal();var upnpmapnum=0;var $addallDiv=null;var $addeditDiv=null;var m_Timer=0;var timenum=0;var bSaved=false;function initUpnp(){loadUpnpSetting()}function upnpSave(){if(bSaved){return}bSaved=true;var b=[];for(var a=0;a<$("#upnpTab .tabler").length;a++){var e=0;var d={serverName:"",protocol:"",interiorPort:"",externalPort:""};for(pro in d){d[pro]=e>1?parseInt($($("#upnpTab .tabler")[a]).find("span").eq(e+2).text()):$($("#upnpTab .tabler")[a]).find("span").eq(e+2).text();e++}$($("#upnpTab .tabler")[a]).find("span").eq(1).text(a+1);a%2==0?$($("#upnpTab .tabler")[a]).css("background","#fff"):$($("#upnpTab .tabler")[a]).css("background","#f0f0f0");b.push(d)}api.UPNP(REQUEST_SET,{enable:$("#getupnpen").is(":checked")?true:false,upnpList:b},function(c,f){if(c!=CODE_SUCCESS){return}rightPopup(lang.saved)})}function upnpDel(){var c=false;for(var b=0;b<upnpmapnum;b++){if(parseInt(nUpnpListVal.sel[b])==1){c=true}}if(c==false){return}for(var a=nUpnpListVal.sel.length-1;a>=0;a--){if(nUpnpListVal.sel[a]==1){$("#upnpTab .tabler").eq(a).remove()}}if($("#upnpAllCheck").is(":checked")){$("#upnpAllCheck").click()}bSaved=false;upnpSave()}function upnpAdd(){$addallDiv=$('<div id="all"></div>').css("opacity",1);$addeditDiv=$('<div class="upnp-edit">            <div class="upnpeditHeader">'+lang.upnpportinfo+'</div>            <div class="upnpeditContent">                <table width="100%">                    <tr>                        <td width="200px" height="15px"><label>'+lang.upnpservername+'</label></td>                        <td width="200px;"><input maxlength="31" id="servername" name="servername" type="text"  value=""  /></td>                    </tr>                    <tr>                        <td width="200px" height="15px"><label>'+lang.pc1+'</label></td>                        <td width="200px;"><select id="upnpprotocol" class="select" matchVal="upnpprotocol" >                                    <option value="0">TCP</option>                        </select>                    </tr>                    <tr>                        <td width="200px" height="15px"><label>'+lang.upnpinput+'</label></td>                        <td width="200px;"><input onkeyup="if(keyboardFilter(event)) {value=numberRangeLimt(this,1,65535)}" onblur="if(this.value == (\'\')) {this.value=(\'0\')} if(this.value > 65535) {this.value = 65535}" maxlength="31" id="upnpinput" name="upnpinput" type="text"  value="0"  /></td>                    </tr>                    <tr>                        <td width="200px" height="15px"><label>'+lang.upnpoutput+'</label></td>                        <td width="200px;"><input onkeyup="if(keyboardFilter(event)) {value=numberRangeLimt(this,1,65535)}" onblur="if(this.value == (\'\')) {this.value=(\'0\')} if(this.value > 65535) {this.value = 65535}"  maxlength="31" id="upnpoutput" name="upnpoutput" type="text"  value="0"  /></td>                    </tr>                    <tr>                        <td colspan="2">                            <div style="padding-top: 5px; text-align: center;">                                <input type="button" class="btn browser-btn" value="'+lang.confirm+'" onclick="addUpnpPortMapping(this);" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                <input id="upnpeditCancel" type="button" class="btn browser-btn" value="'+lang.cancel+'" />                            </div>                        </td>                    </tr>                </table>            </div>        </div>');$("body").prepend($addallDiv).prepend($addeditDiv);$("#edit").draggable({handle:".upnpeditHeader"});$("#upnpeditCancel").click(function(){$addallDiv.remove();$addeditDiv.remove()});$("#servername").bind("keydown keyup blur",function(){if(!isXVR()){checkStringValid($(this).val(),this,1)}else{checkStringValid($(this).val(),this,0)}})}function addUpnpPortMapping(g){$(g).prop("disabled","disabled");if($("#servername").val()==""){rightPopup(lang.upnptip2);$(g).prop("disabled",false);return}if(parseInt($("#upnpinput").val())==0||parseInt($("#upnpoutput").val())==0){rightPopup(lang.upnptip3);$(g).prop("disabled",false);return}if($("#upnpinput").val()==""||$("#upnpoutput").val()==""){rightPopup(lang.upnptip4);$(g).prop("disabled",false);return}for(var a=0;a<upnpmapnum;a++){if(parseInt($("#upnpinput").val())==nUpnpListVal.inport[a]||parseInt($("#upnpinput").val())==nUpnpListVal.outport[a]){rightPopup(lang.upnptip1);$(g).prop("disabled",false);return}if(parseInt($("#upnpoutput").val())==nUpnpListVal.outport[a]||parseInt($("#upnpoutput").val())==nUpnpListVal.inport[a]){rightPopup(lang.upnptip1);$(g).prop("disabled",false);return}}if(upnpmapnum>15){$addallDiv.remove();$addeditDiv.remove();rightPopup(lang.upnpfull);$(g).prop("disabled",false);return}var d=[];for(var b=0;b<$("#upnpTab .tabler").length;b++){var f=0;var e={serverName:"",protocol:"",interiorPort:"",externalPort:""};for(pro in e){e[pro]=f>1?parseInt($($("#upnpTab .tabler")[b]).find("span").eq(f+2).text()):$($("#upnpTab .tabler")[b]).find("span").eq(f+2).text();f++}d.push(e)}$("#upnpTab").html("");d.push({serverName:$("#servername").val(),protocol:$("#upnpprotocol option:selected").text(),interiorPort:intLimit($("#upnpinput").val(),1,65535),externalPort:intLimit($("#upnpoutput").val(),1,65535)});api.UPNP(REQUEST_SET,{enable:$("#getupnpen").is(":checked")?true:false,upnpList:d},function(c,h){if(c!=CODE_SUCCESS){$(g).prop("disabled",false);return}$addallDiv.remove();$addeditDiv.remove();loadUpnpSetting()})}function loadUpnpSetting(){$("#upnpAllCheck").prop("checked",false);nUpnpListVal.sel=[];timenum++;api.UPNP(REQUEST_GET,{},function(c,d){if(c!=CODE_SUCCESS){return}autoFillValue("UPNP",d);var a=d.enable;if(a){var b=d.status;if(parseInt(b)==0){$("#upnptip").text(lang.upnpconnectting)}else{if(parseInt(b)==1){$("#upnptip").text(lang.upnpconnected);if(m_Timer){clearInterval(m_Timer);m_Timer=0;timenum=0;bSaved=false}}}}else{$("#upnptip").text("");$("#getupnpdevinip").val("");$("#getupnpdevextip").val("");if(m_Timer){clearInterval(m_Timer);m_Timer=0;timenum=0;bSaved=false}}if(m_Timer==0){loadUpnpList(d.upnpList)}if(timenum==200){if(m_Timer){clearInterval(m_Timer);m_Timer=0}timenum=0;bSaved=false}})}function loadUpnpList(c){$("#upnpTab").html("");var d=0;upnpmapnum=c.length;for(var b=0;b<c.length;b++){if(isNVR()){nUpnpListVal.upnptype[b]=c[b].protocol;nUpnpListVal.inport[b]=c[b].interiorPort;nUpnpListVal.outport[b]=c[b].externalPort;nUpnpListVal.serverName[b]=c[b].serverName}else{if(isXVR()){nUpnpListVal.serverName[b]=c[b].serverName;nUpnpListVal.upnptype[b]=c[b].protocol;nUpnpListVal.inport[b]=c[b].interiorPort;nUpnpListVal.outport[b]=c[b].externalPort}}d=b%2==0?"tableeven":"tableodd";$("#upnpTab").append('<div class="tabler '+d+'"><span class="tablece" style="width:20px;"><input type="checkbox" class="checkbox" id="upnpadded'+b+'" onclick="enablupnpvalue('+b+')" value="'+b+'"></span><span class="tablece" style="width: 90px;" ondblclick="javascript:editupnpvalue(\''+b+"');\" onclick=\"javascript:editupnp('"+b+"');\">"+(parseInt(b)+1)+'</span><span class="tablece" style="width: 195px;" ondblclick="javascript:editupnpvalue(\''+b+"');\" onclick=\"javascript:editupnp('"+b+"');\" >"+nUpnpListVal.serverName[b]+'</span><span class="tablece" style="width: 120px;"  ondblclick="javascript:editupnpvalue(\''+b+"');\" onclick=\"javascript:editupnp('"+b+'\');">TCP</span><span class="tablece" style="width: 120px;" ondblclick="javascript:editupnpvalue(\''+b+"');\" onclick=\"javascript:editupnp('"+b+"');\">"+nUpnpListVal.inport[b]+'</span><span class="tablece" style="width: 120px;" ondblclick="javascript:editupnpvalue(\''+b+"');\" onclick=\"javascript:editupnp('"+b+"');\">"+nUpnpListVal.outport[b]+"</span></div>")}var a=(309-(str_sub.length-1)*26)+"px";if(parseInt(a)>0){$("#upnpTab").append('<div class="tablebottom tableeven"><span class="tablece" style="width: 20px; height: '+a+';">&nbsp;</span><span class="tablece" style="width: 90px; height: '+a+';">&nbsp;</span><span class="tablece" style="width: 195px; height: '+a+';">&nbsp;</span><span class="tablece" style="width: 120px; height: '+a+';">&nbsp;</span><span class="tablece" style="width: 120px; height: '+a+';">&nbsp;</span><span class="tablece" style="width: 120px; height: '+a+';">&nbsp;</span></div>')}}function editupnpvalue(a){$upnpeditallDiv=$('<div id="all"></div>').css("opacity",1);$upnpediteditDiv=$('<div class="upnp-edit">            <div class="upnpeditHeader">'+lang.upnpportinfo+'</div>            <div class="upnpeditContent">                <table width="100%">                    <tr>                        <td width="200px" height="15px"><label>'+lang.upnpservername+'</label></td>                        <td width="200px;"><input maxlength="16" id="servername" name="servername" type="text"  value="'+nUpnpListVal.serverName[a]+'"  /></td>                    </tr>                    <tr>                        <td width="200px" height="15px"><label>'+lang.upnpprotocol+'</label></td>                        <td width="200px;"><select id="upnpprotocol" class="select" matchVal="upnpprotocol" >                                    <option value="0">TCP</option>                        </select>                    </tr>                    <tr>                        <td width="200px" height="15px"><label>'+lang.upnpinput+'</label></td>                        <td width="200px;"><input onkeyup="if(keyboardFilter(event)) {value=numberRangeLimt(this,1,65535)}" onblur="if(this.value == (\'\')) this.value=(\'0\')" maxlength="31" id="upnpinput" name="upnpinput" type="text"  value="'+nUpnpListVal.inport[a]+'"  /></td>                    </tr>                    <tr>                        <td width="200px" height="15px"><label>'+lang.upnpoutput+'</label></td>                        <td width="200px;"><input onkeyup="if(keyboardFilter(event)) {value=numberRangeLimt(this,1,65535)}" onblur="if(this.value == (\'\')) this.value=(\'0\')" maxlength="31" id="upnpoutput" name="upnpoutput" type="text"  value="'+nUpnpListVal.outport[a]+'"  /></td>                    </tr>                    <tr>                        <td colspan="2">                            <div style="padding-top: 5px; text-align: center;">                                <input type="button"  value="'+lang.confirm+'" onclick="upnpportinfosave(\''+a+'\');" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                <input id="upnpeditCancel" type="button" value="'+lang.cancel+'" />                            </div>                        </td>                    </tr>                </table>            </div>        </div>');$("body").prepend($upnpeditallDiv).prepend($upnpediteditDiv);$(".upnp-edit").draggable({handle:".upnpeditHeader"});$("#upnpeditCancel").click(function(){$upnpeditallDiv.remove();$upnpediteditDiv.remove()})}function upnpportinfosave(b){if($("#servername").val()==""){rightPopup(lang.upnptip2);return}if($("#upnpinput").val()=="0"||$("#upnpoutput").val()=="0"){rightPopup(lang.upnptip3);return}if($("#upnpinput").val()==""||$("#upnpoutput").val()==""){rightPopup(lang.upnptip4);return}for(var a=0;a<upnpmapnum;a++){if(b!=a){if($("#upnpinput").val()==nUpnpListVal.inport[a]||$("#upnpinput").val()==nUpnpListVal.outport[a]){rightPopup(lang.upnptip1);return}if($("#upnpoutput").val()==nUpnpListVal.outport[a]||$("#upnpoutput").val()==nUpnpListVal.inport[a]){rightPopup(lang.upnptip1);return}}}$("#upnpTab").html("");xvr.setUPNP(($("#getupnpen").is(":checked")?"1":"0"),b,(parseInt(upnpmapnum)),$("#servername").val(),$("#upnpinput").val(),$("#upnpoutput").val(),function(c,d){if(c!=HTTP_OK){return}$upnpeditallDiv.remove();$upnpediteditDiv.remove();loadUpnpSetting()})}function editupnp(b){for(var c=0;c<upnpmapnum-1;c++){var a="#upnpindex"+c;$(a).attr("class","even")}var a="#upnpindex"+b;$(a).attr("class","blueodd")}function enableUpnpAllValue(){for(var b=0;b<upnpmapnum;b++){if($("#upnpAllCheck").is(":checked")){var a="#upnpadded"+b;if(!$(a).is(":checked")){$(a).click()}nUpnpListVal.sel[b]=1}else{var a="#upnpadded"+b;if($(a).is(":checked")){$(a).click()}nUpnpListVal.sel[b]=0}}}function enablupnpvalue(b){var a="#upnpadded"+b;if($(a).is(":checked")){nUpnpListVal.sel[b]=1}else{nUpnpListVal.sel[b]=0}}var pppoeVariables={};var initenable="";var inituser="";var initpwd="";function initPppoe(){$("#pppoeSave").val(lang.save);load_pppoe_setting();isNVR()&&$(".J-xvr-network").hide()}function pppoeSave(){var a=$("#getPppoeEnable").prop("checked")?1:0;if((a!=initenable)||($("#getPppoeUser").val()!=inituser)||($("#getPppoePass").val()!=initpwd)){if(!confirm(lang.pppoeTip)){return}doPrgCount(lang.Devicereboot,20000)}else{return}if(/.*[\u4e00-\u9fa5]+.*$/.test($("[matchVal='getpppoeuser']").val())||!checkUserPwdValid($("[matchVal='getpppoepass']").val())){rightPopup(lang.nosupport);return}if($("[matchVal='getpppoeuser']").val().match(/[!%&#=]+/)!=null){rightPopup(lang.nosupport1);return}if(getConf("nvrDhcpEnable")&&$("[matchVal='getpppoeenable']").is(":checked")){setTcpParam()}var b=getUserName();api.newGetCapability(REQUEST_GET,{username:b},function(d,i,k){var n=getAuth();var l=i.encryptionType[0];var m=roundOne();var j=roundTwo(b,i.param[l].salt,m[0],n);var h=reverseRoundThree(j);var g=roundFour(i.param[l].iterations,h);var e=roundFive(g);var f={encryptionType:l,loginName:String(b),datetime:m[1],iv:"afe13ds34cdjk08c",username:encrypt($("[matchVal='getpppoeuser']").val(),e),password:encrypt($("[matchVal='getpppoepass']").val(),e),enable:($("[matchVal='getpppoeenable']").is(":checked"))};api.pppoe(REQUEST_SET,f,function(c,o){showSaveMsg(c)})})}function load_pppoe_setting(){var b=getUserName();var a=getAuth();api.newGetCapability(REQUEST_GET,{username:b},function(c,h){var k=roundOne();var j=h.encryptionType[0];var i=roundTwo(b,h.param[j].salt,k[0],a);var g=reverseRoundThree(i);var f=roundFour(h.param[j].iterations,g);var e=roundFive(f);var d={encryptionType:j,loginName:String(getUserName()),datetime:k[1],iv:"afe13ds34cdjk08c"};api.pppoe(REQUEST_GET,d,function(l,m){if(l!=CODE_SUCCESS){return}$("#getPppoeEnable").prop("checked",m.enable);$("#getPppoeUser").val(decrypt(m.username,e))})})}var bwListVariables={};var $dlg="";var $edit="";var g_list=[];var $tab="";function initNetfilter(){loading(true);initSimpleTable($("#tabList"),{destroy:true,retrieve:true,columnDefs:[{targets:0,orderable:false,render:function(c,b,a,d){return c=="1"?'<input type="checkbox" id="listEnable'+d.row+'" checked="checked"/>':'<input type="checkbox" id="listEnable'+d.row+'"/>'},width:100},{targets:1,orderable:false,render:function(c,b,a,d){return c}},{targets:2,orderable:false,render:function(c,b,a,d){if(b==="display"){return'<a class="web-color pointer" lang="eidt" onclick="editBwList('+d.row+')"/>'+c+"</a>"}return c}},{targets:3,orderable:false,render:function(c,b,a,d){if(b==="display"){return'<a class="web-color pointer" lang="del" onclick="delBwList('+d.row+')"/>'+c+"</a>"}return c}}]});$("#getIpFilterEnable").change(function(){if($(this).prop("checked")){$(".web-color").attr("disabled",false);$(".web-color").css("cursor","pointer")}else{$(".web-color").attr("disabled",true);$(".web-color").css("cursor","not-allowed")}}).change();$("#bwEnable").change(function(){if($(this).prop("checked")){$("#ipAddr,#macAddr").attr("disabled",false)}else{$("#ipAddr,#macAddr").attr("disabled",true)}}).change();$('input[name="listMode"]').change(function(){var a=$(this).val();isIPOrMacshow(a)});onLoadList()}function isIPOrMacshow(a){if(a=="0"){$("#ipAddr").show();$("#macAddr").hide()}else{$("#ipAddr").hide();$("#macAddr").show()}}function onLoadList(){$tab=$("#tabList").DataTable();$tab.clear().draw();api.ipFilter(REQUEST_GET,null,function(c,f){if(c!=CODE_SUCCESS){rightPopup(lang.optionexception);return}autoFillValue("ipFilter",f);var e=[];if(f.list.length>0){var d=[];for(var b=0;b<f.list.length;b++){d.push([f.list[b].enable?"1":"0",f.list[b].type?"2":"0",f.list[b].addr])}g_list=d;var a=[];for(var b=0;b<d.length;++b){e.push([d[b][0],d[b][2],lang.eidt,lang.del])}}$tab.rows.add(e).draw()})}function editBwList(a){var d=$("#tabList").DataTable().row(a).data();initDialog();$(".J-dlog-modal").removeClass("hide").attr("title",lang.eidt).data("index",a);var c="#listEnable"+a;var b=$(c).prop("checked");$("#bwEnable").prop("checked",b);if($("#bwEnable").prop("checked")){$("#ipAddr,#macAddr").attr("disabled",false)}else{$("#ipAddr,#macAdd").attr("disabled",true)}$('input[name="listMode"][value="'+g_list[a][1]+'"]').prop("checked",true);isIPOrMacshow(g_list[a][1]);g_list[a][1]=="0"?$("#ipAddr").val(d[1]):$("#macAddr").val(d[1])}function confirmBwList(a,g){if($('input[name="listMode"]:checked').val()=="0"){if(!chkIP(g.find("#ipAddr").val())){rightPopup(lang.stDeIPV4+lang.formatErr);return}}if($('input[name="listMode"]:checked').val()=="2"){if(!chkMac(g.find("#macAddr").val())){rightPopup(lang.stMac+lang.formatErr);return}}if(a!=undefined){var b=$('input[name="listMode"]:checked').val();var d=b=="0"?g.find("#ipAddr").val():g.find("#macAddr").val();for(var c=0;c<g_list.length;c++){if(g_list[c][2]==d){rightPopup(lang.addressExists);return}}g_list[a][0]=$("#bwEnable").prop("checked")?"1":"0";g_list[a][1]=$('input[name="listMode"]:checked').val();b=="0"?g_list[a][2]=g.find("#ipAddr").val():g_list[a][2]=g.find("#macAddr").val()}else{var f=[];f[0]=$("#bwEnable").prop("checked")?"1":"0";f[1]=$('input[name="listMode"]:checked').val();$('input[name="listMode"]:checked').val()=="0"?f[2]=g.find("#ipAddr").val():f[2]=g.find("#macAddr").val();for(var c=0;c<g_list.length;c++){if(g_list[c][2]==f[2]){rightPopup(lang.addressExists);return}}g_list.push(f)}var e=setRowsData(g_list);$tab.clear().draw();$tab.rows.add(e).draw()}function setRowsData(a){var c=[];for(var b=0;b<a.length;++b){c.push([a[b][0],a[b][2],lang.eidt,lang.del])}return c}function getRowData(){for(var a=0;a<g_list.length;a++){var b=$("#tabList").DataTable().row(a).data();g_list[a][0]=b[0];g_list[a][2]=b[1]}}function delBwList(a){g_list.splice(a,1);var b=setRowsData(g_list);$tab.clear().draw();$tab.rows.add(b).draw()}function addList(){$("#ipAddr").val("");$("#macAddr").val("");initDialog(true);$('input[name="listMode"][value="0"]').click()}function getTable(c){var b=[];for(var a=0;a<c.length;a++){b.push(c[a].join(","))}return b}function setbwlistData(){getRowData();var c=[];if(g_list.length>0){for(var a=0;a<g_list.length;a++){c.push({enable:$("#listEnable"+a).is(":checked"),type:Number(g_list[a][1]),addr:g_list[a][2]})}}var b={enable:$("#getIpFilterEnable").is(":checked"),listType:parseInt($("#getIpFilterType option:selected").val()),list:c};loading(true);api.ipFilter(REQUEST_SET,b,function(d,e){showSaveMsg(d)});$("#ipAddr").val("");$("#macAddr").val("")}function deleteList(){g_list.splice(0,g_list.length);var a=setRowsData(g_list);var a=[];$tab.clear().draw();$tab.rows.add(a).draw()}function chkIP(b){var a=/^(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])$/;if((!a.test(b))||(b=="0.0.0.0")||(b=="255.255.255.255")){return false}else{return true}}function chkMac(b){var a=/[A-Fa-f0-9]{2}:[A-Fa-f0-9]{2}:[A-Fa-f0-9]{2}:[A-Fa-f0-9]{2}:[A-Fa-f0-9]{2}:[A-Fa-f0-9]{2}/;if(!a.test(b)){return false}else{return true}}var ipeyeVariables={};var ipeycfgurl=null;function initIpeye(){var a=new Array(getTotalChannelNum());var b=$("#selChList");initChannelSelect(b,a.length,function(c){return getTotalChannelNum()});$("#selChList").change(onChSelChg).change()}function onChSelChg(){if(!$("#selChList").val()){rightPopup(lang.nolimit);return}var a=$("#selChList").val();xvr.getVal(["getipeycfgchan="+a,"getipeycfgsupport","getipeycfgenable","getipeycfgurl"],function(e,d){var b=splitOkVal(d);ipeycfgurl=b.getipeycfgurl;if(b.getipeycfgenable=="1"){$("#iptCust").val(b.getipeycfgurl);$("#chkEnb").prop("checked",true)}else{$("#iptCust").val("");$("#chkEnb").prop("checked",false)}})}$("#chkEnb").click(function(){if($("#chkEnb").prop("checked")){$("#iptCust").val(ipeycfgurl)}else{$("#iptCust").val("")}});function onBtnSaveClk(){var a=$("#selChList").val();if(!a){return}loading(true);xvr.setVal({setipeycfgchan:a,setipeycfgenable:$("#chkEnb").prop("checked")?"1":"0"},function(d,b){loading(false);if(d!=HTTP_OK){return rightPopup(lang.savedfail)}rightPopup(lang.saved)})}var wanVariables={};var src_httpport=0;var src_ip="";var src_rtspport=0;var src_dhcp=false;var src_submask="";var src_gateway="";var src_dns1="";var src_dns2="";function initWan(){$("#dhcpAbleInput").change(function(){if($("#dhcpAbleInput").is(":checked")){$("#ipAddrInput").attr("disabled","disabled");$("#maskInput").attr("disabled","disabled");$("#getRouteWanGateWay").attr("disabled","disabled");$("#getRouteWanDns1").attr("disabled","disabled");$("#getRouteWanDns2").attr("disabled","disabled")}else{$("#ipAddrInput").removeAttr("disabled");$("#maskInput").removeAttr("disabled");$("#getRouteWanGateWay").removeAttr("disabled");$("#getRouteWanDns1").removeAttr("disabled");$("#getRouteWanDns2").removeAttr("disabled")}});$("#tcpPort").bind({keyup:function(a){if(keyboardFilter(a)){this.value=numberRangeLimt(this,1,65535)}},blur:function(){if(this.value==""){this.value="5000"}}});$("#rtspServerPort").bind({keyup:function(a){if(keyboardFilter(a)){this.value=numberRangeLimt(this,1,65535)}},blur:function(){if(this.value==""){this.value="554"}}});$("#httpPort").bind({keyup:function(a){if(keyboardFilter(a)){this.value=numberRangeLimt(this,1,65535)}},blur:function(){if(this.value==""){this.value="80"}}});networkVariables.privatePortEn&&$("#blkPrivatePort").show();load_net_setting()}function setNetWanParam(){var a=/^(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])$/;if((!a.test($("#ipAddrInput").val()))||($("#ipAddrInput").val()=="0.0.0.0")||($("#ipAddrInput").val()=="255.255.255.255")){rightPopup(lang.stDeIPV4+lang.formatErr);return}if((!a.test($("#maskInput").val()))||($("#maskInput").val()=="0.0.0.0")){rightPopup(lang.st4Mask+lang.formatErr);return}if((!a.test($("#getRouteWanGateWay").val()))||($("#getRouteWanGateWay").val()=="0.0.0.0")){rightPopup(lang.st4Gateway+lang.formatErr);return}if((!a.test($("#getRouteWanDns1").val()))||($("#getRouteWanDns1").val()=="0.0.0.0")){rightPopup(lang.defaultDNS+lang.formatErr);return}if((!a.test($("#getRouteWanDns2").val()))){rightPopup(lang.defaultDNS2+lang.formatErr);return}if($("[matchVal='tcp.rtspPort.']").val()==$("[matchVal='tcp.tcpPort.']").val()||$("[matchVal='tcp.tcpPort.']").val()==$("[matchVal='tcp.httpPort.']").val()||$("[matchVal='tcp.httpPort.']").val()==$("[matchVal='tcp.rtspPort.']").val()){rightPopup(lang.portrepeat);return}if($("[matchVal='tcp.tcpPort.']").val()<1025||$("[matchVal='tcp.tcpPort.']").val()>65535){rightPopup(lang.TCPport1+lang.fanwei+"1025-65535");return}if($("[matchVal='tcp.rtspPort.']").val()==554||($("[matchVal='tcp.rtspPort.']").val()>=1024&&$("[matchVal='tcp.rtspPort.']").val()<=65535)){}else{rightPopup(lang.RTSPport1+lang.fanwei+"554,1025-65535");return}if($("[matchVal='tcp.httpPort.']").val()==80||($("[matchVal='tcp.httpPort.']").val()>=1024&&$("[matchVal='tcp.httpPort.']").val()<=65535)){}else{rightPopup(lang.HTTPport1+lang.fanwei+"80,1025-65535");return}if(src_ip!=$("[matchVal='getroutewanip']").val()||src_dhcp!=$("[matchVal='getroutewanmodel']").is(":checked")||src_submask!=$("[matchVal='getroutewanmask']").val()||src_gateway!=$("[matchVal='getroutewangateway']").val()||src_dns1!=$("[matchVal='getroutewandns1']").val()||src_dns2!=$("[matchVal='getroutewandns2']").val()){xvr.setWAN(($("[matchVal='getroutewanmodel']").is(":checked")?"1":"0"),$("[matchVal='getroutewanip']").val(),$("[matchVal='getroutewanmask']").val(),$("[matchVal='getroutewangateway']").val(),$("[matchVal='getroutewandns1']").val(),$("[matchVal='getroutewandns2']").val(),($("[matchVal='tcp.tcpPort.']").val()+":"+$("[matchVal='tcp.httpPort.']").val()+":"+$("[matchVal='tcp.rtspPort.']").val()),function(c,d){if(networkVariables.privatePortEn){xvr.setNetPort($("[matchVal='tcp.rtspPort.']").val(),$("[matchVal='tcp.tcpPort.']").val(),$("[matchVal='tcp.httpPort.']").val(),$("[matchVal='getuploadport']").val(),$("[matchVal='multicast']").val(),getDevConf("deviceType"),getConf("rtspEncEn")?$("[matchVal='getrtspencrypt']").prop("checked"):undefined,function(e,f){if(e==0){rightPopup(lang.settimeout)}else{if(e==HTTP_OK){rightPopup(lang.saved)}}},{timeout:90000});return}if(c==0){rightPopup(lang.settimeout)}else{if(c==HTTP_OK){rightPopup(lang.saved)}}},{timeout:90000})}else{m_TcpPort=$("[matchVal='tcp.tcpPort.']").val();m_RstpPort=$("[matchVal='tcp.rtspPort.']").val();var b=counter(networkVariables.privatePortEn?2:1,function(){rightPopup(lang.saved)});xvr.setWAN(($("[matchVal='getroutewanmodel']").is(":checked")?"1":"0"),$("[matchVal='getroutewanip']").val(),$("[matchVal='getroutewanmask']").val(),$("[matchVal='getroutewangateway']").val(),$("[matchVal='getroutewandns1']").val(),$("[matchVal='getroutewandns2']").val(),($("[matchVal='tcp.tcpPort.']").val()+":"+$("[matchVal='tcp.httpPort.']").val()+":"+$("[matchVal='tcp.rtspPort.']").val()),b);if(networkVariables.privatePortEn){xvr.setNetPort($("[matchVal='tcp.rtspPort.']").val(),$("[matchVal='tcp.tcpPort.']").val(),$("[matchVal='tcp.httpPort.']").val(),$("[matchVal='getuploadport']").val(),$("[matchVal='multicast']").val(),getDevConf("deviceType"),getConf("rtspEncEn")?$("[matchVal='getrtspencrypt']").prop("checked"):undefined,b,{timeout:90000})}if(src_httpport!=1*$("[matchVal='tcp.httpPort.']").val()){setTimeout(function(){window.top.location.href="http://"+getHost()+":"+$("[matchVal='tcp.httpPort.']").val()+URL_LOGIN},10000)}}}function load_PORT_setting(){xvr.init(function(a,b){if(a!=HTTP_OK){return}split_span_val(b);src_httpport=1*$("[matchVal='tcp.httpPort.']").val()})}function load_net_setting(){xvr.getWAN(function(a,b){if(a!=HTTP_OK){return}split_span_val_type2(b);src_ip=$("[matchVal='getroutewanip']").val();src_dhcp=$("[matchVal='getroutewanmodel']").is(":checked");src_submask=$("[matchVal='getroutewanmask']").val();src_gateway=$("[matchVal='getroutewangateway']").val();src_dns1=$("[matchVal='getroutewandns1']").val();src_dns2=$("[matchVal='getroutewandns2']").val();load_PORT_setting();if(src_dhcp){$("#ipAddrInput").attr("disabled","disabled");$("#maskInput").attr("disabled","disabled");$("#getRouteWanGateWay").attr("disabled","disabled");$("#getRouteWanDns1").attr("disabled","disabled");$("#getRouteWanDns2").attr("disabled","disabled")}else{$("#ipAddrInput").removeAttr("disabled");$("#maskInput").removeAttr("disabled");$("#getRouteWanGateWay").removeAttr("disabled");$("#getRouteWanDns1").removeAttr("disabled");$("#getRouteWanDns2").removeAttr("disabled")}})}var wifichannel=0;var $allDiv=null;var $editDiv=null;var editAdvanceWifienable=0;function initWifi(){$("#").val(lang.Advancewifi);var a=$("#dlgCfmSycn").attr("title",lang.tips).dialog({buttons:[{text:lang.tipYes,click:function(){doIPCStaChk();a.dialog("close")}},{text:lang.tipNo,click:function(){postwifiEdit(false);a.dialog("close")}}],autoOpen:false});var b=$("#dlgExpCfm").attr("title",lang.tips).dialog({buttons:[{text:lang.tipYes,click:function(){postwifiEdit(true);b.dialog("close")}},{text:lang.tipNo,click:function(){b.dialog("close")}}],autoOpen:false});$("#getwifiwlanip").attr("disabled","disabled");$("#getwifiwlanmask").attr("disabled","disabled");setLimitEditStyle($("#getwifissid,#getwifipwd"),function(d){var c=d.charCodeAt(0);return(c>=48&&c<=57)||(c>=65&&c<=90)||(c>=97&&c<=122)})}function doIPCStaChk(){loading(true)}function checkSsid(a){var b=a.getAttribute("keyval");if(a.value.indexOf(b)==-1){if(b.indexOf(a.value)>=0){a.value=b}else{a.value=b+a.value}}}function changeType(a,b){var c=document.getElementById(a);c.type=b}function editrebootWifi(){loading(true);api.networkConfig("reboot",null,function(a,b){a!=CODE_SUCCESS?rightPopup(lang.settimeout):rightPopup(lang.saved);loading(false)})}var channelObj={};function editAdvanceWifi(c){wifiLoad(false);if(editAdvanceWifienable==1){$allDiv.show();$editDiv.show();return}$allDiv=$('<div id="all"></div>').css("opacity",1);$editDiv=$('<div id="edit">            <div class="editHeader">'+lang.Advancewifi+'</div>            <div class="clear" > </div>            <div class="editContent form-item">            <div><span class="width200"><label>'+lang.moduleinfo+'</label></span><span ><label>ModuleInfo</label></span></div>            <div class="clear" > </div>            <div ><span ><input id="getwifibroadcast" matchVal="network.ssidBroadcast." type="checkbox" str="1"/></span><span ><label>'+lang.ssidborcase+'</label></span></div>            <div class="clear" > </div>            <div><span class="width200"><label>'+lang.checkmode+'</label></span><span ><label matchVal="network.wpaKey."></label></span></div>                <div class="clear"> </div>                <div><span class="width200"><label>'+lang.wifimode+'</label></span><span ><label matchVal="network.hwMode."></label></span></div>                <div class="clear"> </div>            <div class="clear"> </div>            <div ><span class="width200"><label>'+lang.wifichannel+'</label></span><span ><select class="small-select" id="getwifichannel" matchVal="getwifichannel"></select></span></div>            <div class="clear"> </div>            <div id="wifiarea"><span class="width200"><label>'+lang.wifiarea+'</label></span><span ><select class="small-select" id="getwifiarea" matchVal="getwifiarea" ></select></span></div>            <div class="clear" > </div>            <div  class="hide cust2"><span class="width200"><label>'+lang.bandwidth+'</label></span><span ><select class="small-select" matchVal="getwifibw40hmzen"><option value="0">20Mhz</option><option value="1">40Mhz</option></select></span></div>            <div class="clear" > </div>            <div class="hide cust2"><span class="width200"><label>'+lang.wifiSGI+'</label></span><span ><select class="small-select" matchVal="getwifishortgien"><option value="0">800ns</option><option value="1">400ns</option></select></span></div>            <div class="clear"> </div>            <div ><span><label>'+lang.wifinote+'</label></span></div>            <div class="clear"> </div>            <div id="wifiipset" style="display: none">            <div ><span><label>'+lang.dhcpmodeset+'</label></span></div>            <div class="clear"> </div>            <div><span class="width200"><label>'+lang.IPAddr+'</label></span><span ><input maxlength="31" class="small-input" id="getwifidhcpip" name="getwifidhcpip" type="text" matchVal="network.wlanIp." /></span></div>            <div class="clear"> </div>            <div style="display: none"><span class="width200"><label>'+lang.st4Gateway+'</label></span><span ><input maxlength="31" class="small-input" id="getwifigateway" name="getwifigateway" type="text" matchVal="getwifigateway" /></span></div>            <div class="clear"> </div>            <div><span class="width200"><label>'+lang.st4Mask+'</label></span><span ><input maxlength="31" class="small-input" id="getwifiwlanmask" name="getwifiwlanmask" type="text" matchVal="network.wlanMask." /></span></div>            <div class="clear"> </div>            <div style="display: none"><span class="width200"><label>'+lang.numberassign+'</label></span><span ><input maxlength="31" class="small-input" id="getwifidhcpnum" name="getwifidhcpnum" type="text" matchVal="getwifidhcpnum" /></span></div>            <div class="clear"> </div>            </div>            <div class="form-item">        <span class="left-float"><input type="button" class="btn browser-btn" id="usereditOK" value ="'+lang.confirm+'" style="display: block;"/></span>    <span class="left-float"><input type="button" class="btn browser-btn" id="editCancel" value ="'+lang.cancel+'" /></span>    </div>            </div>        </div>');$editDiv.css("width","600px").css("height","400px");$("#getwifichannel").html("");$("body").prepend($allDiv).prepend($editDiv);$("#getwifiarea").append('<option value="0">FCC</option>');$("#getwifiarea").append('<option value="1">EU</option>');$("#getwifiarea").append('<option value="2">MKK</option>');var b="";switch(channelObj.area){case"FCC":b=channelObj.fccListChannel;break;case"EU":b=channelObj.euListChannel;break;case"MKK":b=channelObj.mkkListChannel;break}for(var a=1;a<=b.length;a++){$("#getwifichannel").append("<option value="+a+">"+a+"</option>")}b.length==14&&($("#getwifichannel option").eq(13)[0].innerHTML=lang.other);$("#getwifichannel")[0].value=channelObj.channel;$("#getwifidhcpnum").attr("disabled","disabled");$("#getwifiwlanmask").attr("disabled","disabled");$("#getwifigateway").attr("disabled","disabled");$("#getwifidhcpip").attr("disabled","disabled");$("#editCancel").click(function(){$allDiv.hide();$editDiv.hide()});$("#usereditOK").click(function(){$allDiv.hide();$editDiv.hide()});$("#getwifiarea").change(function(){if($("#getwifiarea").val()==0){if($("#getwifichannel option").length==13){for(var d=0;d<3;d++){$("#getwifichannel option").eq(11).remove()}}if($("#getwifichannel option").length==14){for(var d=0;d<3;d++){$("#getwifichannel option").eq(11).remove()}}}else{if($("#getwifiarea").val()==1){if($("#getwifichannel option").length==11){$("#getwifichannel").append('<option value="12">12</option>');$("#getwifichannel").append('<option value="13">13</option>')}if($("#getwifichannel option").length==14){$("#getwifichannel option").eq(13).remove()}}else{if($("#getwifiarea").val()==2){if($("#getwifichannel option").length==11){$("#getwifichannel").append('<option value="12">12</option>');$("#getwifichannel").append('<option value="13">13</option>');$("#getwifichannel").append('<option value="14">'+lang.other+"</option>")}if($("#getwifichannel option").length==13){$("#getwifichannel").append('<option value="14">'+lang.other+"</option>")}}}}});editAdvanceWifienable=1;getConf("wifiCust2")&&$(".cust2").removeClass("hide");if(c){$("#editCancel").click()}}function postwifiEdit(b){if(/.*[\u4e00-\u9fa5]+.*$/.test($("[matchVal='network.essid.']").val())){rightPopup(lang.nosupport);return}if($("[matchVal='network.essid.']").val().slice(0,5)!="HSNVR"){rightPopup(lang.wifissidtip);return}if($("[matchVal='network.password.']").val().length<8||$("[matchVal='network.password.']").val().length>32){rightPopup(lang.passwordsetting);return}var a=$("#getwifissid"),d=$("#getwifipwd");if((a.val()!==a.data("init-val")||d.val()!==d.data("init-val"))&&b===undefined){$("#dlgCfmSycn").dialog("open");return}var c=getUserName();api.newGetCapability(REQUEST_GET,{username:c},function(e,j,l){var o=getAuth();var m=j.encryptionType[0];var n=roundOne();var k=roundTwo(c,j.param[m].salt,n[0],o);var i=reverseRoundThree(k);var h=roundFour(j.param[m].iterations,i);var f=roundFive(h);var g={encryptionType:m,loginName:String(c),datetime:n[1],iv:"afe13ds34cdjk08c",configUpdataIpc:b,essid:encrypt($("[matchVal='network.essid.']").val(),f),password:encrypt($("[matchVal='network.password.']").val(),f),ssidBroadcast:$("[matchVal='network.ssidBroadcast.']").is(":checked")?true:false,area:$("[matchVal='getwifiarea']").val()==0?"FCC":$("[matchVal='getwifiarea']").val()==1?"EU":"MKK",channel:parseInt($("[matchVal='getwifichannel']").val())};api.networkConfig(REQUEST_SET,g,function(p,q){showSaveMsg(p);$("#getwifissid").data("init-val",$("#getwifissid").val());$("#getwifipwd").data("init-val",$("#getwifipwd").val())})});$("#getwifiwlanmask").attr("disabled","disabled")}function checkpsw(){if($("#getwifipwddisplay").is(":checked")){changeType("getwifipwd","text")}else{changeType("getwifipwd","password")}}function wifiLoad(b){var c=getUserName();var a=getAuth();api.newGetCapability(REQUEST_GET,{username:c},function(d,i){var l=roundOne();var k=i.encryptionType[0];var j=roundTwo(c,i.param[k].salt,l[0],a);var h=reverseRoundThree(j);var g=roundFour(i.param[k].iterations,h);var f=roundFive(g);var e={encryptionType:k,loginName:String(getUserName()),datetime:l[1],iv:"afe13ds34cdjk08c"};api.networkConfig(REQUEST_GET,e,function(n,p){if(n!=CODE_SUCCESS){return}p.essid=decrypt(p.essid,f);autoFillValue("network",p);$("#getwifiarea option:contains("+p.area+")").attr("selected","selected");$("[matchVal='network.ssidBroadcast.']").prop("checked",p.ssidBroadcast);if(!$("#getwifipwddisplay").is(":checked")){changeType("getwifipwd","password")}else{changeType("getwifipwd","text")}channelObj={fccListChannel:p.fccListChannel,euListChannel:p.euListChannel,mkkListChannel:p.mkkListChannel,channel:p.channel,area:p.area};var o=p.area;if(b){if(o==="FCC"){for(var m=0;m<3;m++){$("#getwifichannel option").eq(11).remove()}}if(o==="EU"){$("#getwifichannel option").eq(13).remove()}}$("#getwifissid").data("init-val",$("#getwifissid").val());$("#getwifipwd").data("init-val",$("#getwifipwd").val())})})}function initDialog(a){$(".J-dlog-modal").removeClass("hide").attr("title",lang.addto);var b={resizable:false,height:"auto",width:"400px",draggable:false,modal:true,buttons:{},position:{of:$("#stc"),at:"center",my:"center"}};b.buttons[lang.save]=function(){var c=$(this).data("index");confirmBwList(a?undefined:c,$(this));$(this).dialog("destroy")};b.buttons[lang.cancel]=function(){$(this).dialog("destroy")};$(".J-dlog-modal").dialog(b);return b};