var userManageVariables={channelNum:getTotalChannelNum(),hasPassword:false,adminPsw:"",checkCode:""};var $usereditallDiv=null;var $userediteditDiv=null;var sListUserInfo=0;var arrayUser=null;var loginpsw=window.top.loginpsw;var m_sOldPWD="";var m_nlocalremotenum=0;var addulocalconfigdatabit="";var adduremoteconfigdatabit="";var adducameraconfigdatabit="";var m_setOK=1;var m_setApply=0;var username=getUserName();var userPwd=getAuth();setConf("nonXVRLocalEn",isNVR()&&(isCpuEq(11)||isCpuEq(21)||isCpuEq(30)||isCpuEq(40))&&parseInt(getDevConf("alarmInNum")));setConf("smtPower",isNVR());function onLoad(){initDot();setTitle(lang.userlog);if(isXVR()){m_nlocalremotenum=17}else{m_nlocalremotenum=getConf("nonXVRLocalEn")?16:15}$("#addUser").val(lang.adduser);getUserData();$(".J-userName").val(getCookie("userName"));setLimitEditStyle("input[id^='iptAns']",function(a){var b=a.charCodeAt();return between(b," ".charCodeAt(),"~".charCodeAt())});$("#oldPwd").on("keydown",function(){$(this).next().hide()});$("#btnExportKey").prop("disabled",true);if(getConf("weekPwdTimer")>=0||getCookie("editPassword")){$("#resetIssue").prop("checked",true).parent().hide();$("#modifyPwd").prop("checked",true).parent().hide();$("#btnExportKey").prop("disabled",false);getAuth()=="12345"&&$("#oldPwd").val("12345").parent().hide();deleteCookie("editPassword")}else{$("#modifyPwd").prop("checked",false);$("#btnExportKey").attr("exported",1)}$("#modifyPwd").click(onModifyPwdClk);$("#resetIssue").click(onResetIssueClk);$("#btnExportKey").click(onBtnExportClk);$("#btnOk").click(onBtnOkClk);onResetIssueClk();onModifyPwdClk();$("#oldPwd").change(function(){if(chkOldPwd()){$("#btnExportKey").prop("disabled",false)}else{$("#btnExportKey").prop("disabled",true)}})}function onModifyPwdClk(){var a=$("#modifyPwd").prop("checked");$("#newPwd,#confirmPwd").val("").prop("disabled",!a);$("#btnOk").prop("disabled",!a&&!$("#resetIssue").prop("checked"))}function onResetIssueClk(){var a=$("#resetIssue").prop("checked");$("select[id^=selQ]").prop("disabled",!a).val(0);$("input[id^=iptAns]").prop("disabled",!a).val("");$("#tipErr").hide();$("#btnOk").prop("disabled",!a&&!$("#modifyPwd").prop("checked"))}function onBtnOkClk(){$("#btnOk").prop("disabled",true);setTimeout(function(){$("#btnOk").prop("disabled",false)},1000);if(window.timerReload){reLogin();return}var c=false,d=false;if($("#resetIssue").prop("checked")){if(0<checkEmpty($("#tipErr"),$(".J-security-answer"))){return}c=true}if(!chkOldPwd()){rightPopup(lang.pwdTips1);return}if($("#modifyPwd").prop("checked")){if(!chkOldPwd()){return}var e=$("#newPwd").val();var b=$("#confirmPwd").val();if(e!==b){rightPopup(lang.pwdTips1);return}if(!checkUserPwdValid(e)){rightPopup(lang.nosupport);return}if(!passwordLevel(e)){rightPopup(lang.pwdTips8);return}d=true}var a=$("#btnExportKey");if(!a.attr("exported")){alert(lang.tipExpKey);return}d&&a.prop("disabled",true);if(c&&d){setQuestion(e,setAdminPsw)}else{if(c){setQuestion(e)}else{setAdminPsw(e)}}}function setAdminPsw(a,c){var b=getUserName();api.newGetCapability(REQUEST_GET,{username:b},function(d,h,j){var n=getAuth();var k=h.encryptionType[0];var l=roundOne();var i=roundTwo(b,h.param[k].salt,l[0],n);var g=reverseRoundThree(i);var f=roundFour(h.param[k].iterations,g);var e=roundFive(f);var m={encryptionType:k,loginName:String(getUserName()),datetime:l[1],iv:"afe13ds34cdjk08c",adminPassword:encrypt($("#oldPwd").val(),e),userId:arrayUser[0].user_id,username:encrypt(arrayUser[0].user_name,e),password:encrypt(a,e),passwordStrength:parseInt(passwordLevel(a)),userLevel:arrayUser[0].user_level,localPermission:arrayUser[0].local_config_data_bit,remotePermission:arrayUser[0].remote_config_data_bit,channelPermission:arrayUser[0].camera_config_data_bit};api.userManager("modify",m,function(o,p){if(o!=CODE_SUCCESS){return}$.cookies.del("userName");$.cookies.del("pwd");var q=10;$("#btnOk").val(lang.resetLogin+"("+q+")");window.timerReload=setInterval(function(){--q;if(q>0){$("#btnOk").val(lang.resetLogin+"("+q+")")}else{reLogin()}},1000)})})}function setQuestion(a,c){var b=getUserName();api.newGetCapability(REQUEST_GET,{username:b},function(d,i,k){var n=getAuth();var l=i.encryptionType[0];var m=roundOne();var j=roundTwo(b,i.param[l].salt,m[0],n);var h=reverseRoundThree(j);var g=roundFour(i.param[l].iterations,h);var e=roundFive(g);var f={encryptionType:l,loginName:String(getUserName()),datetime:m[1],iv:"afe13ds34cdjk08c",adminPassword:encrypt($("#oldPwd").val(),e),question1:parseInt($("#selQ1t").val()),answer1:$("#iptAns1").val()?encrypt($("#iptAns1").val(),e):$("#iptAns1").val(),question2:parseInt($("#selQ2t").val()),answer2:$("#iptAns2").val()?encrypt($("#iptAns2").val(),e):$("#iptAns2").val(),question3:parseInt($("#selQ2t").val()),answer3:$("#iptAns3").val()?encrypt($("#iptAns3").val(),e):$("#iptAns3").val()};api.questionSet(REQUEST_SET,f,function(o){o!=CODE_SUCCESS?rightPopup(lang.setFaile):rightPopup(lang.setsuccessfully);c&&c(a)})})}function reLogin(){if(window.timerReload){clearInterval(window.timerReload);window.timerReload=null}window.top.location.href="/login.html?ver="+(new Date()).getTime()}function chkOldPwd(){if($("#oldPwd").val()==getAuth()){return true}$("#oldPwd").next().show();return false}function onBtnExportClk(){var b=getUserName();var a=getAuth();api.newGetCapability(REQUEST_GET,{username:b},function(c,h){var k=roundOne();var j=h.encryptionType[0];var i=roundTwo(b,h.param[j].salt,k[0],a);var g=reverseRoundThree(i);var f=roundFour(h.param[j].iterations,g);var e=roundFive(f);var d={encryptionType:j,loginName:String(getUserName()),datetime:k[1],iv:"afe13ds34cdjk08c",adminPassword:encrypt($("#oldPwd").val(),e)};api.secretKeyExport(REQUEST_GET,d,function(l,n){if(l==0){if(!isSafari()&&createAndDownloadFile(n.exportFilename,n.secretKey)){$("#btnExportKey").attr("exported","1")}else{var m=window.top.plugin().exportFile(n.exportFilename,n.secretKey,0);if(m){rightPopup(lang.expSuccess);$("#btnExportKey").attr("exported","1");$("#iptExpPath").val(m).show()}}}else{rightPopup(lang.dl5)}})})}function getUserData(){$("#userList").empty();arrayUser=new Array();var b=getUserName();var a=getAuth();api.newGetCapability(REQUEST_GET,{username:b},function(c,h){var k=roundOne();var j=h.encryptionType[0];var i=roundTwo(b,h.param[j].salt,k[0],a);var g=reverseRoundThree(i);var f=roundFour(h.param[j].iterations,g);var e=roundFive(f);var d={encryptionType:j,loginName:String(getUserName()),datetime:k[1],iv:"afe13ds34cdjk08c"};api.userManager("getList",d,function(n,p){if(n!=CODE_SUCCESS){return}for(var q=0;q<p.userList.length;q++){var v=p.userList[q];var m=v.userId;var r=decrypt(v.username,e);var t="";var w=v.passwordStrength;var o=v.userLevel;sListUserInfo=new Object();sListUserInfo.user_id=m;sListUserInfo.user_name=r;sListUserInfo.password=t;sListUserInfo.password_strength=w;sListUserInfo.user_level=o;arrayUser[q]=sListUserInfo;switch(w){case 0:w=lang.Weakpsw;break;case 1:w=lang.midpsw;break;case 2:w=lang.strogepsw;break}switch(o){case 0:o=lang.Manager;break;case 1:o=lang.operator;break;case 2:o=lang.cunsumer;break}var s="";s=q%2==0?"tableeven":"tableodd";var l=q+1;if(r=="root"){$("#userList").append('<div class="tabler '+s+'"><span class="tablece" style="width:70px;">'+l+'</span><span class="tablece" style="width:155px;">'+encodeEntity(r)+'</span><span class="tablece" style="width:155px;">'+w+'</span><span class="tablece" style="width:110px;">'+o+'</span><span class="tablece" style="width:110px;"></span><span class="tablece" style="width:110px;"></span><span class="tablece" style="width:90px;"><a style="color: #c60f26;" href="javascript:deleteUser('+q+')" value="'+q+'">'+lang.del+"</a></span></div>")}else{if(r=="admin"){$("#userList").append('<div class="tabler '+s+'"><span class="tablece" style="width:70px;">'+l+'</span><span class="tablece" style="width:155px;">'+encodeEntity(r)+'</span><span class="tablece" style="width:155px;">'+w+'</span><span class="tablece" style="width:110px;">'+o+'</span><span class="tablece" style="width:110px;">-</span><span class="tablece" style="width:110px;"><a style="color: #c60f26;" href="javascript:modifyUser('+q+')" value="'+q+'">'+lang.modify+'</a></span><span class="tablece" style="width:90px;">-</span></div>')}else{$("#userList").append('<div class="tabler '+s+'"><span class="tablece" style="width:70px;">'+l+'</span><span class="tablece" style="width:155px;">'+encodeEntity(r)+'</span><span class="tablece" style="width:155px;">'+w+'</span><span class="tablece" style="width:110px;">'+o+'</span><span class="tablece" style="width:110px;"><a style="color: #c60f26;" href="javascript:authorityset('+q+')" value="'+q+'">'+lang.eidt+'</a></span><span class="tablece" style="width:110px;"><a style="color: #c60f26;" href="javascript:modifyUser('+q+')" value="'+q+'">'+lang.modify+'</a></span><span class="tablece" style="width:90px;"><a style="color: #c60f26;" href="javascript:deleteUser('+q+')" value="'+q+'">'+lang.del+"</a></span></div>")}}}var u=(340-(p.userList.length-1)*26)+"px";if(parseInt(u)>0){$("#userList").append('<div class="tablebottom tableeven"><span class="tablece" style="width: 70px; height: '+u+';">&nbsp;</span><span class="tablece" style="width: 155px; height: '+u+';">&nbsp;</span><span class="tablece" style="width: 155px; height: '+u+';">&nbsp;</span><span class="tablece" style="width: 110px; height: '+u+';">&nbsp;</span><span class="tablece" style="width: 110px; height: '+u+';">&nbsp;</span><span class="tablece" style="width: 110px; height: '+u+';">&nbsp;</span><span class="tablece" style="width: 90px; height: '+u+';">&nbsp;</span></div>')}if(getConf("weekPwdLimit")){modifyUser(0)}})})}function deleteUser(a){if("admin"!=getUserName()&&"root"!=getUserName()){rightPopup(lang.usertip3);return}getManagerPsw(deleteOK,a)}function deleteOK(a){var b=getUserName();api.newGetCapability(REQUEST_GET,{username:b},function(d,i,k){var n=getAuth();var l=i.encryptionType[0];var m=roundOne();var j=roundTwo(b,i.param[l].salt,m[0],n);var h=reverseRoundThree(j);var g=roundFour(i.param[l].iterations,h);var e=roundFive(g);var e=roundFive(g);var f={encryptionType:l,loginName:String(getUserName()),datetime:m[1],iv:"afe13ds34cdjk08c",adminPassword:encrypt(userManageVariables.adminPsw,e),userId:arrayUser[a].user_id};api.userManager(REQUEST_DELETE,f,function(c,o){if(c!=CODE_SUCCESS){return}getUserData()})})}function modifyUser(a){if("admin"!=getUserName()&&"root"!=getUserName()){if(arrayUser[a].user_name=="admin"){rightPopup(lang.usertip3);return}}if(arrayUser[a].user_name==="admin"){setConf("isAdminMdy",true);$(".options-block").show();$(".user-message").hide();authorityset(a);return}$usereditallDiv=$('<div id="all"></div>').css("opacity",0.7);$userediteditDiv=$('<div id="useredit">                <div class="usereditHeader">'+lang.Modifyuser1+'</div>                <div class="clear" > </div>                <div class="usereditConten form-item">                    <div><span class="width200"><label>'+lang.adminPsw+'</label></span><span ><input maxlength="31" class="small-input" id="managerPsw" name="managerPsw" type="password"  value=""  /></span></div>                    <div class="clear"> </div>                    <div><span class="width200"><label>'+lang.userName+'</label></span><span ><input maxlength="31" class="small-input" id="userName" name="userName" type="text"  value=""   /></span></div>                    <div class="clear"> </div>                    <div class="hide"><span ><input id="modifypswcheck" name="modifypswcheck" type="checkbox"  value=""  /></span><span><label>'+lang.Modifyuser+'</label></span>  </div>                    <div class="clear"> </div>                    <div ><span class="width200"><label>'+lang.oldpwd+'</label></span><span><input maxlength="31" class="small-input" id="oldpwd" name="oldpwd" type="password"  value=""  /></span></div>                    <div class="clear"> </div>                    <div ><span class="width200"><label>'+lang.newpwd+'</label></span><span><input maxlength="31" class="small-input" id="pwd" name="pwd" type="password"  value=""  /></span></div>                    <div class="clear"> </div>                    <div><span class="width200"><label>'+lang.confirmPwd+'</label></span><span ><input maxlength="31" class="small-input" id="confirmPwd" name="confirmPwd" type="password"   value=""  /></span></div>                    <div class="clear"> </div>                    <div><span class="width200"><label>'+lang.userlevel+'</label></span><span ><select class="small-select" id="userright" name="usergroup"></select></span></div>                    <div class="clear"> </div>                    <div class="form-item btn-block">            <span><input type="button" class="btn browser-btn" id="usereditOK" onclick="userModifyOK('+a+')" value ="'+lang.confirm+'" /></span>        <span><input type="button" class="btn browser-btn" id="usereditCancel" value ="'+lang.cancel+'" /></span>        </div>                </div>            </div>');$userediteditDiv.css("width","425px").css("min-height","290px");$("body").prepend($usereditallDiv).prepend($userediteditDiv);$("#useredit").draggable({handle:".usereditHeader"});if("admin"==getUserName()||"root"==getUserName()){if(arrayUser[a].user_name!="admin"){$("#oldpwd").parent().parent().hide()}}$("#usereditCancel").click(function(){$usereditallDiv.remove();$userediteditDiv.remove()});$("#userName").bind("keydown keyup blur",function(){if(!isXVR()){checkStringValid($(this).val(),this,1)}else{checkStringValid($(this).val(),this,2)}});if(arrayUser[a].user_name=="admin"){$('<option value="0"> '+lang.Manager+"</option>").appendTo($("#userright"));$("#userright").prop("disabled","disabled");$("#userName").prop("disabled","disabled")}else{$("#userright").prop("disabled",false);$('<option value="1"> '+lang.operator+"</option>").appendTo($("#userright"));$('<option value="2"> '+lang.cunsumer+"</option>").appendTo($("#userright"))}if("admin"!=getUserName()&&"root"!=getUserName()){$("#userright").prop("disabled","disabled")}$("#userright").val(arrayUser[a].user_level);m_sOldPWD=arrayUser[a].password;$("#modifypswcheck").prop("checked",true);$("#userName").val(arrayUser[a].user_name)}function userModifyOK(b){if(isXVR()){if(!userInput($("#userName").val())){rightPopup(lang.nosupport);return}}if(!checkUserPwdValid($("#pwd").val())){rightPopup(lang.nosupport);return}if(passwordLevel($("#userName").val())==3){rightPopup(lang.nosupport3);return}if($("#managerPsw").val()==""){rightPopup(lang.inputAdminPsw);return}if($("#managerPsw").val()!=getAuth()){rightPopup(lang.usertip13);return}var e=0;if($("#modifypswcheck").is(":checked")){if(!(("admin"==getUserName()||"root"==getUserName())&&arrayUser[b].user_name!="admin")){if($("#oldpwd").val()!=m_sOldPWD){rightPopup(lang.usertip13);return}}if($("#pwd").val()==""){rightPopup(lang.usertip6);return}if($("#pwd").val()!=$("#confirmPwd").val()){rightPopup(lang.usertip7);return}if(!passwordLevel($("#pwd").val())||passwordLevel($("#pwd").val())==3){rightPopup(lang.pwdTips8);return}e=$("#pwd").val()}else{e=arrayUser[b].password}var k=$("#userName").val();if(k=="root"||k=="admin"&&b!=0){rightPopup(lang.usertip4);return}if(k==""){rightPopup(lang.usertip2);return}for(var h=0;h<arrayUser.length;h++){if(k==arrayUser[h].user_name&&h!=b){rightPopup(lang.usertip5);return}}var a=arrayUser[b].user_id;var f=parseInt(arrayUser[b].user_level);var c=parseInt($("#userright").val());var j="";var m="";var d="";var l=$("#userright").val();if(f==c){j=arrayUser[b].local_config_data_bit;m=arrayUser[b].remote_config_data_bit;d=arrayUser[b].camera_config_data_bit}else{setConfigDatabit(parseInt($("#userright").val()));j=addulocalconfigdatabit;m=adduremoteconfigdatabit;d=adducameraconfigdatabit}$("#usereditOK").prop("disabled","disabled");var g=getUserName();api.newGetCapability(REQUEST_GET,{username:g},function(i,r,t){var w=getAuth();var u=r.encryptionType[0];var v=roundOne();var s=roundTwo(g,r.param[u].salt,v[0],w);var q=reverseRoundThree(s);var p=roundFour(r.param[u].iterations,q);var n=roundFive(p);var n=roundFive(p);var o={encryptionType:u,loginName:String(getUserName()),datetime:v[1],iv:"afe13ds34cdjk08c",adminPassword:encrypt($("#managerPsw").val(),n),userId:a,username:encrypt(k,n),password:encrypt(e,n),passwordStrength:parseInt(passwordLevel(e)),userLevel:parseInt(l),localPermission:j,remotePermission:m,channelPermission:d};api.userManager("modify",o,function(y,z){if(y!=CODE_SUCCESS){return}var x=e;rightPopup(lang.saved);$usereditallDiv.remove();$userediteditDiv.remove();if(k=="admin"||k==getUserName()){if(x!=loginpsw){window.top.location.href=URL_LOGIN}}else{getUserData()}})})}function getNum(b){var a=1;for(var c=1;c<=b;c++){a*=2}return a}function GetLocalConfigDatabit(){var a=0;for(var b=0;b<64;++b){if($('input[name="localconfigcheck"]').eq(b).is(":checked")){a+=getNum(b)}}return a+""}function GetRemoteConfigDatabit(){var a=0;for(var b=0;b<64;++b){if($('input[name="remoteconfigcheck"]').eq(b).is(":checked")){a+=getNum(b)}}return a+""}var lliveview_data_bit=new Array(64);var lptzcontrol_data_bit=new Array(64);var lplayback_data_bit=new Array(64);var lrecord_data_bit=new Array(64);var lencode_data_bit=new Array(64);var losdset_data_bit=new Array(64);var lvideoset_data_bit=new Array(64);var lmotion_data_bit=new Array(64);var llocalfilebackup=new Array(64);var lprivacymask=new Array(64);var lvideoloss=new Array(64);var lsmartalam=new Array(64);var lupgrade_ipc=new Array(64);var lOptAudio=new Array(64);var lOptChMt=new Array(64);var lSmtDected=new Array(64);var lSmtFaceCmp=new Array(64);var lSmtAlarm=new Array(64);var lOsdTxt=new Array(64);var lIPEye=new Array(64);var rliveview_data_bit=new Array(64);var rptzcontrol_data_bit=new Array(64);var rplayback_data_bit=new Array(64);var rrecord_data_bit=new Array(64);var rencode_data_bit=new Array(64);var rosdset_data_bit=new Array(64);var rvideoset_data_bit=new Array(64);var rmotion_data_bit=new Array(64);var rlocalfilebackup=new Array(64);var rprivacymask=new Array(64);var rvideoloss=new Array(64);var rsmartalam=new Array(64);var rOptAudio=new Array(64);var rOptChMt=new Array(64);var rSmtDected=new Array(64);var rSmtFaceCmp=new Array(64);var rSmtAlarm=new Array(64);var rOsdTxt=new Array(64);var rIPEye=new Array(64);function GetCameraConfigDatabit(){var b=[],f=[];f={0:lliveview_data_bit,1:rliveview_data_bit,2:lrecord_data_bit,3:rrecord_data_bit,4:lplayback_data_bit,5:rplayback_data_bit,6:lptzcontrol_data_bit,7:rptzcontrol_data_bit,8:llocalfilebackup,9:rlocalfilebackup};var e=ParseInt($("#channelauthor").val());for(var d=0;d<userManageVariables.channelNum;d++){f[e][d]=$('input[name="chDetails"]').eq(d).is(":checked")?1:0}for(var d=0;d<userManageVariables.channelNum;d++){var a="0";for(var c in f){if(f[c][d]){a=sumStrings(a,GetStringFromNum(c))}}b.push({channel:d,permission:a})}return b}function GetStringFromNum(f){var l="1";for(var e=1;e<=f;e++){var d=0;var h="";var g=new Array(20);var a=l.length;for(var c=l.length-1;c>=0;c--){g[l.length-1-c]=parseInt(parseInt(l[c])*2%10)+d;d=parseInt(parseInt(l[c])*2/10);if(c==0&&parseInt(d)!=0){g[l.length]=d;a++}}for(var b=a-1;b>=0;b--){h=h+String(g[b])}l=h}return l}function sumStrings(e,d){if(e=="0"){return d}if(d=="0"){return e}var f="",g=0;e=e.split("");d=d.split("");while(e.length||d.length||g){g+=~~e.pop()+~~d.pop();f=g%10+f;g=g>9}return f.replace(/^0+/,"")}function authoritysetButton(c,a){var e=arrayUser[c].password;var h=arrayUser[c].user_name;var b=arrayUser[c].user_id;if("admin"!=getUserName()&&"root"!=getUserName()){if(h==getUserName()){rightPopup(lang.usertip3);return}}var g=GetLocalConfigDatabit();var d=GetRemoteConfigDatabit();var i=GetCameraConfigDatabit();var f=getUserName();api.newGetCapability(REQUEST_GET,{username:f},function(j,o,q){var t=getAuth();var r=o.encryptionType[0];var s=roundOne();var p=roundTwo(f,o.param[r].salt,s[0],t);var n=reverseRoundThree(p);var m=roundFour(o.param[r].iterations,n);var k=roundFive(m);var l={encryptionType:r,loginName:String(getUserName()),datetime:s[1],iv:"afe13ds34cdjk08c",adminPassword:encrypt(userManageVariables.adminPsw,k),userId:b,username:encrypt(h,k),password:encrypt(e,k),passwordStrength:parseInt(arrayUser[c].password_strength),userLevel:parseInt(arrayUser[c].user_level),localPermission:g,remotePermission:d,channelPermission:i};api.userManager("modify",l,function(u,v){if(u!=CODE_SUCCESS){return}rightPopup(lang.saved);if(a){$usereditallDiv.remove();$userediteditDiv.remove()}getUserData()})})}function authorityset(a){var b={userId:arrayUser[a].user_id};api.userManager(REQUEST_GET,b,function(d,e){if(d!=CODE_SUCCESS){return}var f=e.localPermission;var c=e.remotePermission;var g=e.channelPermission;arrayUser[a].local_config_data_bit=f;arrayUser[a].remote_config_data_bit=c;arrayUser[a].camera_config_data_bit=g;a==0?"":userEdit(a)})}function userEdit(b){var a=function(n){$usereditallDiv=$('<div id="all"></div>').css("opacity",0.7);$userediteditDiv=$('<div id="useredit">        <div class="usereditHeader">'+lang.right+'</div>        <div class="clear" > </div>        <div class="options-block">    <ul class="tag-head" id="authorityHead">        <li style="min-width:150px;" id="localconfig"><a class="current" >'+lang.localAuth+'</a></li>        <li style="min-width:150px;" id="remoteconfig"><a  >'+lang.remoteAuth+'</a></li>        <li style="min-width:150px;" id="channelconfig"><a  >'+lang.channelAuth+'</a></li>    </ul>    </div>        <div class="usereditConten form-item">        <div id="localconfig" class="userconfig" style="display:block">            <div style="margin-top: 10px"><span ><input  id="localconfigselectall"  type="checkbox"  value=""  /></span><span><label>'+lang.allchannel+'</label></span>  </div>            <div class="clear"> </div>            <div ><span ><input  name="localconfigcheck" type="checkbox"  value=""  /></span><span><label>'+lang.authParamconfigLocal+'</label></span>  </div>            <div class="clear"> </div>            <div ><span ><input  name="localconfigcheck" type="checkbox"  value=""  /></span><span><label>'+lang.authUserChannelsetLocal+'</label></span>  </div>            <div class="clear"> </div>            <div ><span ><input  name="localconfigcheck" type="checkbox"  value=""  /></span><span><label>'+lang.authUserControlLocal+'</label></span>  </div>            <div class="clear"> </div>            <div ><span ><input  name="localconfigcheck" type="checkbox"  value=""  /></span><span><label>'+lang.authDiskLocal+'</label></span>  </div>            <div class="clear"> </div>            <div ><span ><input  name="localconfigcheck" type="checkbox"  value=""  /></span><span><label>'+lang.authLogSearchLocal+'</label></span>  </div>            <div class="clear"> </div>            <div ><span ><input  name="localconfigcheck" type="checkbox"  value=""  /></span><span><label>'+lang.authUserUpdateLocal+'</label></span>  </div>            <div class="clear"> </div>            <div ><span ><input  name="localconfigcheck" type="checkbox"  value=""  /></span><span><label>'+lang.authDefalutLocal+'</label></span>  </div>            <div class="clear"> </div>            <div ><span ><input  name="localconfigcheck" type="checkbox"  value=""  /></span><span><label>'+lang.authShutdownLocal+'</label></span>  </div>            <div class="clear"> </div>        </div>        <div id="remoteconfig"  class="userconfig" style="display:none">           <div style="margin-top: 10px"><span ><input  id="remoteconfigselectall"  type="checkbox"  value=""  /></span><span><label>'+lang.allchannel+'</label></span>  </div>            <div class="clear"> </div>            <div ><span ><input  name="remoteconfigcheck" type="checkbox"  value=""  /></span><span><label>'+lang.authParamconfigRemote+'</label></span>  </div>            <div class="clear"> </div>            <div ><span ><input  name="remoteconfigcheck" type="checkbox"  value=""  /></span><span><label>'+lang.authUserChannelsetRemote+'</label></span>  </div>            <div class="clear"> </div>            <div ><span ><input  name="remoteconfigcheck" type="checkbox"  value=""  /></span><span><label>'+lang.authUserControlRemote+'</label></span>  </div>            <div class="clear"> </div>            <div ><span ><input  name="remoteconfigcheck" type="checkbox"  value=""  /></span><span><label>'+lang.authDiskRemote+'</label></span>  </div>            <div class="clear"> </div>            <div ><span ><input  name="remoteconfigcheck" type="checkbox"  value=""  /></span><span><label>'+lang.authLogSearchRemote+'</label></span>  </div>            <div class="clear"> </div>            <div ><span ><input  name="remoteconfigcheck" type="checkbox"  value=""  /></span><span><label>'+lang.authUserUpdateRemote+'</label></span>  </div>            <div class="clear"> </div>            <div ><span ><input  name="remoteconfigcheck" type="checkbox"  value=""  /></span><span><label>'+lang.authDefalutRemote+'</label></span>  </div>            <div class="clear"> </div>            <div ><span ><input  name="remoteconfigcheck" type="checkbox"  value=""  /></span><span><label>'+lang.authShutdownRemote+'</label></span>  </div>            <div class="clear"> </div>        </div>        <div id="chanelconfig" class="userconfig" style="display: none">            <div style="margin-top: 10px"> </div>            <div><span class="width200"><label>'+lang.channelauthor+'</label></span><span ><select class="medium-input" id="channelauthor" name="channelauthor"></select></span></div>            <div class="clear"> </div>            <div ><span ><input id="channelselectall" name="channelselect" type="checkbox"  value=""  /></span><span><label>'+lang.allchannel+'</label></span>  </div>            <div class="clear"> </div>            <div id="channellist" style="overflow-x:hidden;">            </div>        </div>            <div class="form-item" style="margin-top: 40px;margin-left: 43px;">    <span><input type="button" class="btn browser-btn" id="usereditOK" onclick="authoritysetButton('+n+","+m_setOK+')" value ="'+lang.confirm+'" /></span><span><input type="button" class="btn browser-btn" id="usereditCancel" value ="'+lang.cancel+'" /></span><span><input type="button" class="btn browser-btn" id="usereditOK" onclick="authoritysetButton('+n+","+m_setApply+')" value ="'+lang.apply+'"/></span></div>        </div>    </div>');$userediteditDiv.css({height:"auto","padding-bottom":"10px"});$("body").prepend($usereditallDiv).prepend($userediteditDiv);$("#channelauthor").append('<option value="0">'+lang.authPreviewLocal+'</option><option value="1">'+lang.authPreviewRemote+'</option><option value="2">'+lang.authRecordLocal+'</option><option value="3">'+lang.authRecordRemote+'</option><option value="4">'+lang.authPlayBackLocal+'</option><option value="5">'+lang.authPlayBackRemote+'</option><option value="6">'+lang.authUserptzLocal+'</option><option value="7">'+lang.authUserptzRemote+'</option><option value="8">'+lang.authExportLocal+'</option><option value="9">'+lang.authExportRemote+"</option>");$("#useredit").draggable({handle:".usereditHeader"});$("#usereditCancel").click(function(){$usereditallDiv.remove();$userediteditDiv.remove()});var g=$("#authorityHead a");var c=$(".userconfig");g.each(function(i){var j=g.eq(i);j.click(function(){g.removeClass("current");j.addClass("current");c.hide();c.eq(i).attr("style","display:block")})});$("#channellist").html("");for(var m=0;m<userManageVariables.channelNum;m++){$('<div class="clear"> </div>').appendTo($("#channellist"));if(m%8==0){if(m<9){$('<div id="ch'+m+'"><span ><input id="pbch'+m+'" name="chDetails"  type="checkbox"    /></span><span ><label >CH0'+(m+1)+"</label></span></div>").appendTo($("#channellist"))}else{$('<div id="ch'+m+'"><span ><input id="pbch'+m+'" name="chDetails"  type="checkbox"    /></span><span ><label >CH'+(m+1)+"</label></span></div>").appendTo($("#channellist"))}}else{if(m<9){$('<div id="ch'+m+'"><span ><input id="pbch'+m+'"  name="chDetails" type="checkbox"    /></span><span ><label >CH0'+(m+1)+"</label></span></div>").appendTo($("#channellist"))}else{$('<div id="ch'+m+'"><span ><input id="pbch'+m+'"  name="chDetails" type="checkbox"    /></span><span ><label >CH'+(m+1)+"</label></span></div>").appendTo($("#channellist"))}}}$('input[name="localconfigcheck"]').each(function(){$("#localconfigselectall").prop("checked",$('input[name="localconfigcheck"]:visible').not(":checked").length===0)});$('input[name="remoteconfigcheck"]').click(function(){$("#remoteconfigselectall").prop("checked",$('input[name="remoteconfigcheck"]:visible').not(":checked").length===0)});$('input[name="chDetails"]').each(function(i){$("#channelselectall").prop("checked",$('input[name="chDetails"]:visible').not(":checked").length===0)});var e=binaryToArray(String(arrayUser[n].local_config_data_bit));var q=binaryToArray(String(arrayUser[n].remote_config_data_bit));for(var m=0;m<e.length;++m){if(e[m]&1){$('input[name="localconfigcheck"]').eq(m).prop("checked",true)}else{$('input[name="localconfigcheck"]').eq(m).prop("checked",false)}}for(var h=0;h<q.length;++h){if(q[h]&1){$('input[name="remoteconfigcheck"]').eq(h).prop("checked",true)}else{$('input[name="remoteconfigcheck"]').eq(h).prop("checked",false)}}var o=arrayUser[n].camera_config_data_bit;for(var f=0;f<userManageVariables.channelNum;f++){var p=binaryToArray(String(o[f].permission));lliveview_data_bit[f]=p[0];rliveview_data_bit[f]=p[1];lrecord_data_bit[f]=p[2];rrecord_data_bit[f]=p[3];lplayback_data_bit[f]=p[4];rplayback_data_bit[f]=p[5];lptzcontrol_data_bit[f]=p[6];rptzcontrol_data_bit[f]=p[7];llocalfilebackup[f]=p[8];rlocalfilebackup[f]=p[9]}for(var d=0;d<userManageVariables.channelNum;d++){if(lliveview_data_bit[d]&1){$('input[name="chDetails"]').eq(d).prop("checked",true)}else{$('input[name="chDetails"]').eq(d).prop("checked",false)}}$("#localconfigselectall").prop("checked",GetLocalConfigAllSelectStatus());$("#remoteconfigselectall").prop("checked",GetRometeConfigAllSelectStatus());$("#channelselectall").prop("checked",GetChannelConfigAllSelectStatus());$("#channelauthor").change(function(){var k=$(this).val();var u=null;switch(parseInt(k)){case 0:u=lliveview_data_bit;break;case 1:u=rliveview_data_bit;break;case 2:u=lrecord_data_bit;break;case 3:u=rrecord_data_bit;break;case 4:u=lplayback_data_bit;break;case 5:u=rplayback_data_bit;break;case 6:u=lptzcontrol_data_bit;break;case 7:u=rptzcontrol_data_bit;break;case 8:u=llocalfilebackup;break;case 9:u=rlocalfilebackup;break}if(isXVR()){var t=getDevHDNum(getDevConf("platformType"),userManageVariables.channelNum);if($("#channelauthor").val()==21||$("#channelauthor").val()==63||$("#channelauthor").val()==62||$("#channelauthor").val()==61||$("#channelauthor").val()==10){for(var r=t;r<userManageVariables.channelNum;r++){var s="#ch"+r;$(s).hide()}}else{for(var r=t;r<userManageVariables.channelNum;r++){var s="#ch"+r;$(s).show()}}}for(var j=0;j<userManageVariables.channelNum;j++){if(u[j]&1){$('input[name="chDetails"]').eq(j).prop("checked",true)}else{$('input[name="chDetails"]').eq(j).prop("checked",false)}}$("#channelselectall").prop("checked",GetChannelConfigAllSelectStatus())});$("#channelselectall").click(function(){$('input[name="chDetails"]').prop("checked",$(this).prop("checked"))});$("#localconfigselectall").click(function(){$('input[name="localconfigcheck"]').prop("checked",$(this).prop("checked"))});$("#remoteconfigselectall").click(function(){$('input[name="remoteconfigcheck"]').prop("checked",$(this).prop("checked"))})};getManagerPsw(a,b)}function GetLocalConfigAllSelectStatus(){for(var a=0;a<m_nlocalremotenum;a++){if(!($('input[name="localconfigcheck"]:visible').eq(a).is(":checked"))){return false}}return true}function GetRometeConfigAllSelectStatus(){for(var a=0;a<m_nlocalremotenum;a++){if(!($('input[name="remoteconfigcheck"]:visible').eq(a).is(":checked"))){return false}}return true}function GetChannelConfigAllSelectStatus(){for(var a=0;a<userManageVariables.channelNum;a++){if(!($('input[name="chDetails"]:visible').eq(a).is(":checked"))){return false}}return true}function add_user(){$usereditallDiv=$('<div id="all"></div>').css("opacity",0.7);$userediteditDiv=$('<div id="useredit">            <div class="usereditHeader">'+lang.logadduer+'</div>            <div class="clear" > </div>            <div class="usereditConten form-item">                <div><span class="width200"><label>'+lang.adminPsw+'</label></span><span ><input maxlength="31" class="small-input" id="managerPsw" name="managerPsw" type="password"  value=""  /></span></div>                <div class="clear"> </div>                <div><span class="width200"><label>'+lang.userName+'</label></span><span ><input maxlength="31" class="small-input" id="userName" name="userName" type="text"  value=""  /></span></div>                <div class="clear"> </div>                <div><span class="width200"><label>'+lang.pwd+'</label></span><span><input maxlength="31" class="small-input" id="pwd" name="pwd" type="password"  value=""  /></span></div>                <div class="clear"> </div>                <div><span class="width200"><label>'+lang.confirmPwd+'</label></span><span ><input maxlength="31" class="small-input" id="confirmPwd" name="confirmPwd" type="password"  value=""  /></span></div>                <div class="clear"> </div>                <div><span class="width200"><label>'+lang.userlevel+'</label></span><span ><select class="small-select" id="userright" name="userright"><option value="1"> '+lang.operator+'</option><option value="2"> '+lang.cunsumer+'</option></select></span></div>                <div class="clear"> </div>                <div class="form-item btn-block">        <span><input type="button" class="btn browser-btn" id="usereditOK" onclick="useraddOK()" value ="'+lang.confirm+'"/></span>    <span><input type="button" class="btn browser-btn" id="usereditCancel" value ="'+lang.cancel+'" /></span>    </div>            </div>        </div>');$userediteditDiv.css("width","425px").css("height","296px");$("body").prepend($usereditallDiv).prepend($userediteditDiv);$("#useredit").draggable({handle:".usereditHeader"});$("#usereditCancel").click(function(){$usereditallDiv.remove();$userediteditDiv.remove()});$("#userName").bind("keydown keyup blur",function(){if(!isXVR()){checkStringValid($(this).val(),this,1)}else{checkStringValid($(this).val(),this,2)}})}function useraddOK(){if(!checkUserPwdValid($("#pwd").val())){rightPopup(lang.nosupport);return}if($("#pwd").val()!=$("#confirmPwd").val()){rightPopup(lang.usertip7);return}if($("#pwd").val()==""){rightPopup(lang.usertip6);return}if($("#managerPsw").val()==""){rightPopup(lang.inputAdminPsw);return}if($("#managerPsw").val()!=getAuth()){rightPopup(lang.usertip13);return}if(!passwordLevel($("#pwd").val())||passwordLevel($("#pwd").val())==3){rightPopup(lang.pwdTips8);return}if(arrayUser.length>=32&&isNVR()){rightPopup(lang.usertip32);return}if(arrayUser.length>=256){rightPopup(lang.usertip1);return}var a=$("#userName").val();if(String(ParseInt(a))==a&&a.length>=10){rightPopup(lang.nosupport3);return}if(a==""){rightPopup(lang.usertip2);return}if(a=="admin"){rightPopup(lang.usertip4);return}if(a=="root"){rightPopup(lang.usertip4);return}for(var b=0;b<arrayUser.length;b++){if(a==arrayUser[b].user_name){rightPopup(lang.usertip5);return}}setConfigDatabit((parseInt($("#userright").val())));$("#usereditOK").prop("disabled","disabled");var c=getUserName();api.newGetCapability(REQUEST_GET,{username:c},function(d,i,k){var n=getAuth();var l=i.encryptionType[0];var m=roundOne();var j=roundTwo(c,i.param[l].salt,m[0],n);var h=reverseRoundThree(j);var g=roundFour(i.param[l].iterations,h);var e=roundFive(g);var f={encryptionType:l,loginName:String(getUserName()),datetime:m[1],iv:"afe13ds34cdjk08c",adminPassword:encrypt($("#managerPsw").val(),e),userId:"0",username:encrypt(a,e),password:encrypt($("#pwd").val(),e),passwordStrength:parseInt(passwordLevel($("#pwd").val())),userLevel:parseInt($("#userright").val()),localPermission:addulocalconfigdatabit,remotePermission:adduremoteconfigdatabit,channelPermission:adducameraconfigdatabit};api.userManager("add",f,function(o,p){if(o!=CODE_SUCCESS){return}rightPopup(lang.saved);$usereditallDiv.remove();$userediteditDiv.remove();getUserData()})})}function setConfigDatabit(a){if(isXVR()){if(a==1){addulocalconfigdatabit="17";adduremoteconfigdatabit="17";adducameraconfigdatabit=[];for(var b=0;b<userManageVariables.channelNum;b++){adducameraconfigdatabit.push({channel:b,permission:"1023"})}}else{if(a==2){addulocalconfigdatabit="17";adduremoteconfigdatabit="17";adducameraconfigdatabit=[];for(var b=0;b<userManageVariables.channelNum;b++){adducameraconfigdatabit.push({channel:b,permission:"51"})}}}}else{if(a==1){addulocalconfigdatabit="17";adduremoteconfigdatabit="17";adducameraconfigdatabit=[];for(var b=0;b<userManageVariables.channelNum;b++){adducameraconfigdatabit.push({channel:b,permission:"1023"})}}else{if(a==2){addulocalconfigdatabit="17";adduremoteconfigdatabit="17";adducameraconfigdatabit=[];for(var b=0;b<userManageVariables.channelNum;b++){adducameraconfigdatabit.push({channel:b,permission:"51"})}}}}}function getManagerPsw(b,a){$usereditallDiv=$('<div id="all"></div>').css("opacity",0.7);$userediteditDiv=$('<div id="useredit">                <div class="usereditHeader">'+lang.inputAdminPsw+'</div>                <div class="clear" > </div>                <div class="usereditConten form-item">                <div><span class="width200"><label>'+lang.adminPsw+'</label></span><span ><input maxlength="31" class="small-input" id="managerPsw" name="managerPsw" type="password"  value=""  /></span></div>                <div class="form-item btn-block">            <span><input type="button" class="btn browser-btn J-manager-psw-ok" id="usereditOK" value ="'+lang.confirm+'" /></span>        <span><input type="button" class="btn browser-btn" id="usereditCancel" value ="'+lang.cancel+'" /></span>        </div>                </div>            </div>');$("body").prepend($usereditallDiv).prepend($userediteditDiv);$("#useredit").draggable({handle:".usereditHeader"});$("#usereditCancel").click(function(){$usereditallDiv.remove();$userediteditDiv.remove();userManageVariables.hasPassword=false});$(".J-manager-psw-ok").click(function(){var c=$("#managerPsw").val();if(!c){userManageVariables.hasPassword=false;rightPopup(lang.inputAdminPsw);return}if(c!=getAuth()){rightPopup(lang.usertip13);return}$usereditallDiv.remove();$userediteditDiv.remove();userManageVariables.adminPsw=c;b&&b(a);userManageVariables.hasPassword=true})}function between(c,b,a){c=ParseInt(c);b=ParseInt(b);a=ParseInt(a);return c>=b&&c<=a};