var generalSetVariables={getResolution:"",recordDays:0,autoLogoutTimeInit:0,enableAutoLogin:false,channelNum:getTotalChannelNum(),currentDate:new Date(),getSyncEnable:"",timeZone:null,dstNtp:0,dstOffsetFlag:0};function onLoad(){initDot();bindTagHead();initDeviceSet();initDateSetting();initDst()}function onDeviceSetLoad(){getGeneralSet()}function initDeviceSet(){setTitle(lang.baseOptions);initLanguageSelect();renderResolution();initDeviceSettingsEvent()}function initDeviceSettingsEvent(){$(".J-device-save").on("click",function(){deviceSave()});$("input[name=autoName]").click(function(a){if($("#getLoginEnable").prop("checked")){$("#getLogoutEnable").prop("disabled",true);$(".J-auto-logout-time").attr("disabled",true)}else{if($("#getLogoutEnable").prop("checked")){$("#getLoginEnable").prop("disabled",true)}else{$("#getLoginEnable").prop("disabled",false);$("#getLogoutEnable").prop("disabled",false)}}$(".J-auto-logout-time").attr("disabled",true).val(generalSetVariables.autoLogoutTimeInit);if($("#getLogoutEnable").prop("checked")){$(".J-auto-logout-time").attr("disabled",false)}});$("#getDevName").bind("keydown keyup blur",function(){if(!isXVR()){checkStringValid($("#getDevName").val(),this,1)}else{checkStringValid($("#getDevName").val(),this,0)}})}function getGeneralSet(){api.generalSet(REQUEST_GET,{},function(a,b){if(a!=CODE_SUCCESS){return}renderRecordDays(b);autoFillValue("general",b);generalSetVariables.recordDays=b.recordDays;generalSetVariables.autoLogoutTimeInit=b.autoLogoutTime;setConf("isLiteMode",b.videoStandard=="1");$("#getLogoutEnable").prop("disabled",!b.enableAutoLogout);$("#getLoginEnable").prop("disabled",!b.enableAutoLogin);$("#getLogoutEnable").prop("checked")?$(".J-auto-logout-time").attr("disabled",false):$(".J-auto-logout-time").attr("disabled",true)})}function deviceSave(){if($(".J-record-days").val()!=generalSetVariables.recordDays){if(confirm(lang.dvr)==false){return}}if(generalSetVariables.getResolution!=$(".J-resolution").val()){if(confirm(lang.reslution)){if(isXVR()){if(!nSynConfigDatabit[19]){rightPopup(lang.nolimit);return}}else{if(!nSynConfigDatabit[23]){rightPopup(lang.nolimit);return}}}else{return}}if(generalSetVariables.getResolution!=$(".J-resolution").val()){deviceSetting(function(a,b){if(a!=CODE_SUCCESS){return}rightPopup(lang.saved);window.top.doRestartCount();api.systemDisplay(REQUEST_SET,{resolution:$(".J-resolution option:selected").text()},function(c,d){if(c!=CODE_SUCCESS){return}})})}else{deviceSetting(function(a,b){if(a!=CODE_SUCCESS){return}getGeneralSet();rightPopup(lang.saved)})}}function deviceSetting(b){var a=getMatchValue("general");api.generalSet(REQUEST_SET,a,function(c,d){if(c!=CODE_SUCCESS){return}b&&b(c,d)})}function renderResolution(){api.systemDisplay(REQUEST_GET,{},function(c,d){if(c!==CODE_SUCCESS){return}$(".J-resolution").html("");var a="";for(var b=0;b<d.resolutionList.length;b++){a+="<option value='"+d.resolutionList[b]+"' >"+d.resolutionList[b]+"</option>"}$(".J-resolution").append(a);$(".J-resolution").val(d.resolution);generalSetVariables.getResolution=d.resolution})}function renderRecordDays(d){var b="";$(".J-record-days").children().not("[value=0]").remove();if(getConf("recDayMax")==15){var a=[15,10,7,5,1];for(var c=0;c<a.length;c++){b+='<option value="'+Number(c+1)+'">'+a[c]+"</option>"}}else{var e=d.recordDaysList.length;for(var c=1;c<e;c++){b+='<option value="'+c+'">'+d.recordDaysList[c]+"</option>"}}$(".J-record-days").append(b)}function initLanguageSelect(){var a=["中文简体","中文繁體","English","Polskie","České","русский","ไทย","עברית","ةيبرعلا","Български","日本語","Deutsch","français","Português","türk","Español","italiano","magyar","română","한국어","Nederlands","Greek","Người việt nam"];var c="";$(".J-device-language").empty();for(var b=0;b<a.length;++b){if((isNVR()&&b!=10)){if(a[b]!=="日本語"){c+="<option value="+b+">"+a[b]+"</option>";continue}}else{if(isXVR()){c+="<option value="+b+">"+a[b]+"</option>"}}}$(".J-device-language").append(c);if(isNVR()){$(".J-device-language").append("<option value="+a.length+">日本語</option>");$(".J-video-mode").parent().parent().hide();$(".timeLang label").text(lang.waitTime)}$(".J-device-language").val(-1)}function onDateTimeLoad(){loadCheckTimeInfo();loadGeneralTime()}function initDateSetting(){setTitle(lang.timeOption);initTimeZoneSel();!isNVR()&&$(".J-xvr-tip").removeClass("hide");initTimeSelet();initChannelCheckTime();initDateEventBind();setDeviceTime()}function initChannelCheckTime(){$("#checkTimeEnable").children().not(".J-check-all").html("");var c="";for(var a=0;a<generalSetVariables.channelNum;a++){var b=a>=9?"":0;c+='<span><input id="checkTime'+a+'"  name="playbackDetails" type="checkbox" /></span>            <span><label >CH'+b+(a+1)+"</label></span>"}$('<div class="form-item"></div>').appendTo($("#checkTimeEnable"));$("#checkTimeEnable").children("div").eq(1).append(c)}function initTimeSelet(){var d=$("#getSystemTimeMinutes");for(var a=0;a<60;a++){d.append('<option value="'+a+'">'+zeroComplement(a)+"</option>")}var c=$("#getSystemTimeHour");for(var a=0;a<24;a++){c.append('<option value="'+a+'">'+zeroComplement(a)+"</option>")}var b=$("#getSystemTimeSeconds");for(var a=0;a<60;a++){b.append('<option value="'+a+'">'+zeroComplement(a)+"</option>")}$("#setDate").commCal({bUsePdCal:isBSCal(),bAwayShow:false}).commCal("setSelDate",new Date())}function initTimeZoneSel(){var c=$("#getNvrNtpTimeZone");var a=[];generalSetVariables.timeZone=a=getTimeZoneOpt(isXVR());for(var d=0;d<a.length;++d){c.append('<option value="'+d+'">'+a[d]+" </option>")}for(var d=0,b=null;d<generalSetVariables.timeZone.length;++d){b=generalSetVariables.timeZone[d].match(/GMT([+-]\d+):(\d+)/);generalSetVariables.timeZone[d]=(b[1]*60+parseInt(b[2]))*60*1000}}function initDateEventBind(){$("#wifiGetNtpServer").change(function(){if($("#wifiGetNtpServer").val()!="custom"){$("#customNtpServer").prop("disabled","disabled")}else{$("#customNtpServer").prop("disabled",false)}});$("#datetimeSave").on("click",function(){datetimeSave()});$('input[name="ucModel"]').click(function(){var a=$(this);ucModelChecked(a)});$("#checkTimeselectall").click(function(){if($("#checkTimeselectall").is(":checked")){for(var b=0;b<generalSetVariables.channelNum;b++){var a="#checkTime"+b;$(a).prop("checked",true)}}else{for(var b=0;b<generalSetVariables.channelNum;b++){var a="#checkTime"+b;$(a).prop("checked",false)}}});setEditNumberStyle("#getNtpPort",false,null);setEditNumberStyle("#getNtInterval",false,null);setEditNumberStyle("#getChnTimeInterval",false,null);$("#getNvrNtpTimeZone").change(function(){setZoneTime(parseInt($("#getNvrNtpTimeZone").val()))})}function loadCheckTimeInfo(){api.channelCheckTime(REQUEST_GET,{},function(c,d){if(c!=CODE_SUCCESS){return}generalSetVariables.getSyncEnable=d.enable;$("#getChnTimeInterval").val(d.interval);var e=d.channelMask;for(var b=0;b<generalSetVariables.channelNum;b++){if(parseInt(e.substr(b,1))==1){var a="#checkTime"+b}$(a).prop("checked",true)}})}function ucModelChecked(b){$("#setDate").attr("disabled","disabled");$("#getSystemTimeHour").attr("disabled","disabled");$("#getSystemTimeMinutes").attr("disabled","disabled");$("#getSystemTimeSeconds").attr("disabled","disabled");$("#pcTime").attr("disabled","disabled");$("#getNtpTimeZone").attr("disabled","disabled");$("#getNtpPort").attr("disabled","disabled");$("#getNtInterval").attr("disabled","disabled");$("#getNtpTimeZone").attr("disabled","disabled");$("#wifiGetNtpServer").attr("disabled","disabled");$("#customNtpServer").attr("disabled","disabled");var a=parseInt(b.val());switch(a){case 0:$('input[name="ucModel"][value="0"]').prop("checked",true);$('input[name="ucModel"][value="1"]').prop("checked",false);$('input[name="ucModel"][value="2"]').prop("checked",false);$("#setDate").prop("disabled",false);$("#getSystemTimeHour").prop("disabled",false);$("#getSystemTimeMinutes").prop("disabled",false);$("#getSystemTimeSeconds").prop("disabled",false);break;case 1:$('input[name="ucModel"][value="1"]').prop("checked",true);$('input[name="ucModel"][value="0"]').prop("checked",false);$('input[name="ucModel"][value="2"]').prop("checked",false);$("#pcTime").prop("disabled",false);break;case 2:$('input[name="ucModel"][value="2"]').prop("checked",true);$('input[name="ucModel"][value="0"]').prop("checked",false);$('input[name="ucModel"][value="1"]').prop("checked",false);$("#getNtpTimeZone").prop("disabled",false);$("#getNtpPort").prop("disabled",false);$("#getNtInterval").prop("disabled",false);$("#getNtpTimeZone").prop("disabled",false);$("#wifiGetNtpServer").prop("disabled",false);if($("#wifiGetNtpServer").val()=="custom"){$("#customNtpServer").prop("disabled",false)}break}}function setDeviceTime(){var a=new Date();$("#pcTime").val($("#setDate").commCal("getDateStr",a)+a.Format(" hh:mm:ss"));setTimeout("setDeviceTime()",1000)}function loadGeneralTime(){api.systemTime(REQUEST_GET,{},function(b,g){if(b!==0){return}var c=g.time;autoFillValue("dateSet",c);var h=c.second;var e=c.hour;var f=c.minute;var j=c.year;var i=c.month;var k=c.day;var a=new Date(j,i-1,k,e,f,h);generalSetVariables.currentDate=new Date(a.getTime()-(generalSetVariables.timeZone[0]+a.getTimezoneOffset()*60000));i=i>9?i:"0"+i;var l=new Date(String(j),String(i-1),String(k));$("#setDate").commCal("setSelDate",l);$("#setDate").val(l.Format("yyyy-MM-dd"));var d=g.timeFomat;autoFillValue("timeFormat",d);$("#getNvrNtpTimeZone").val(d.timeZone)});api.NTP(REQUEST_GET,{},function(b,c){if(b!==0){return}var d=c.enable;if(d==false){$('input[name="ucModel"][value="0"]').attr("checked","checked");ucModelChecked($('input[name="ucModel"]:checked'))}else{if(d==true){$('input[name="ucModel"][value="2"]').attr("checked","checked");ucModelChecked($('input[name="ucModel"]:checked'))}}$("#getNtpPort").val(c.port);$("#getNtInterval").val(c.updateIntervalTime<30?30:c.updateIntervalTime);var a=c.server;$("#wifiGetNtpServer").val(a);if($("#wifiGetNtpServer").val()!==a){$("#wifiGetNtpServer").val("custom");$("#customNtpServer").val(String(a));$("#customNtpServer").prop("disabled",false)}else{$("#customNtpServer").prop("disabled","disabled")}})}function dataSaveNormal(c){var i="";var t="";var r="";var f=0;var q=0;var j=0;var o=false;var d="";var m=0;var p=0;var b=0;var e=0;var k=0;var n=0;var u=parseInt($("input[name='ucModel']:checked").val());var l=new Date();switch(u){case 0:var s=$("#setDate").commCal("getSelDate");i=s.getFullYear();t=s.getMonth()+1;r=s.getDate();f=$("#getSystemTimeHour").val();q=$("#getSystemTimeMinutes").val();j=$("#getSystemTimeSeconds").val();break;case 1:i=l.getFullYear();t=(parseInt(l.getMonth())+1);r=l.getDate();f=l.getHours();q=l.getMinutes();j=l.getSeconds();break;case 2:o=true;i=l.getFullYear();t=(parseInt(l.getMonth())+1);r=l.getDate();f=l.getHours();q=l.getMinutes();j=l.getSeconds();break}d=$("#wifiGetNtpServer").val()=="custom"?$("#customNtpServer").val():$("#wifiGetNtpServer").val();m=$("#getNvrNtpTimeZone").val();p=$("#getNtInterval").val();b=$("#getNtpDateFormat").val();e=$("#getNtpDateSeparator").val();k=$("#getNtpTimeFormat").val();n=$("#getNtpPort").val();var g={year:i,month:t,day:r,hour:parseInt(f),minute:parseInt(q),second:parseInt(j)};var a={timeZone:parseInt(m),dateFormat:parseInt(b),dateSeparator:parseInt(e),timeFormat:parseInt(k)};api.systemTime(REQUEST_SET,{time:g,timeFomat:a},function(v,w){if(v!==0){return}c&&c(v,w)});var h={enable:o,server:d,port:parseInt(n),updateIntervalTime:parseInt(p)};api.NTP(REQUEST_SET,h,function(v,w){if(v!==0){return}c&&c(v,w)})}function datetimeSave(d){var f=0;var a=parseInt($("input[name='ucModel']:checked").val());if(!getConf("isAllowNTPandDST")&&parseInt(f)==1&&a==2){rightPopup(lang.dstntp);return}if(!checkDomain($("#customNtpServer").val())&&$("#wifiGetNtpServer").val()=="custom"){rightPopup(lang.domain+lang.formatErr);return}if(isXVR()){if(!d){xvr.getPlayBackStatus(function(g,i){if(g!=HTTP_OK){rightPopup(lang.savedfail)}var h=splitOkVal(i);if(h.getpbstatus&&h.getpbstatus){if(h.getpbstatus!=0){rightPopup(lang.pb7);return}}datetimeSave(true)});return}}else{dataSaveNormal(function(g,h){rightPopup(lang.saved)})}var e="";for(var c=0;c<generalSetVariables.channelNum;c++){var b="#checkTime"+c;if($(b).is(":checked")){e=e+"1"}else{e=e+"0"}}api.channelCheckTime(REQUEST_SET,{enable:generalSetVariables.getSyncEnable,interval:parseInt($("#getChnTimeInterval").val()),channelMask:e},function(g,h){if(g!=CODE_SUCCESS){return}if(isXVR()){dataSaveNormal(function(i,j){rightPopup(lang.saved)})}})}function setZoneTime(c){var a=generalSetVariables.timeZone[c];var b=new Date(generalSetVariables.currentDate.getTime()+generalSetVariables.currentDate.getTimezoneOffset()*60000+a);$("#getSystemTimeHour").val(b.getHours());$("#getSystemTimeMinutes").val(b.getMinutes());$("#getSystemTimeSeconds").val(b.getSeconds());$("#setDate").commCal("setSelDate",b)}function isBSCal(){return getLang()==="bs"}function onDstLoad(){getSummerTimeData()}function initDst(){setTitle(lang.dst1);initDstDateTime();initDstEvent()}function initDstEvent(){$(".J-dst-save").on("click",function(){setDSTSave()})}function initDstDateTime(){var d=$("#getSummerTimeStartHour"),e=$("#getSummerTimeEndHour"),c=$("#getSummerTimeStartMin"),b=$("#getSummerTimeEndMin");var a=function(f,j){var k="";for(var h=0;h<f;h++){k+='<option value="'+h+'">'+zeroComplement(h)+"</option>"}for(var g=0;g<j.length;g++){j[g].append(k)}};a(24,[d,e]);a(60,[c,b]);$("#startDate").val(new Date().Format("yyyy-MM-dd"));$("#startDate").datepicker({changeYear:true,changeMonth:true,dateFormat:"yy-mm-dd",showButtonPanel:true});$("#stopDate").val(new Date().Format("yyyy-MM-dd"));$("#stopDate").datepicker({changeYear:true,changeMonth:true,dateFormat:"yy-mm-dd",showButtonPanel:true});$(".J-summertime-type").change(function(f){var g=$(this).val();dstTimeTypeChange(g)})}function getSummerTimeData(){api.systemTime(REQUEST_GET,{},function(a,b){if(a!=CODE_SUCCESS){return}var b=b.summerTime;autoFillValue("summerTime",b);generalSetVariables.dstNtp=1;dstTimeTypeChange(b.timeType);generalSetVariables.dstOffsetFlag=b.offsetFlag;generalSetVariables.currentDate=new Date(b.startYear,b.startMon,b.startMday);$("#startDate").datepicker("setDate",generalSetVariables.currentDate);generalSetVariables.currentDate=new Date(b.endYear,b.endMon,b.endMday);$("#stopDate").datepicker("setDate",generalSetVariables.currentDate);$("#getSummerTimetDst").prop("checked",b.timeIsDst==1?true:false)})}function setDSTSave(f){var d=$('input[id="getSummerTimetDst"]:checked').length>0?"1":"0";if(!getConf("isAllowNTPandDST")&&d=="1"&&ParseInt(generalSetVariables.dstNtp)==1){rightPopup(lang.dstntp);return}var c=$(".J-summertime-type").val()=="0";var e=$("#startDate").datepicker("getDate");e.setHours(ParseInt($("#getSummerTimeStartHour").val()));e.setMinutes(ParseInt($("#getSummerTimeStartMin").val()));e.setSeconds(0);e.setMilliseconds(0);var b=$("#stopDate").datepicker("getDate");b.setHours(ParseInt($("#getSummerTimeEndHour").val()));b.setMinutes(ParseInt($("#getSummerTimeEndMin").val()));b.setSeconds(0);b.setMilliseconds(0);if(c){e.setMonth(ParseInt($("#getSummerTimeStartMon").val()));b.setMonth(ParseInt($("#getSummerTimeEndMon").val()))}else{if(isXVR()){if(e-b>=0){rightPopup(lang.dsttip);return}}else{if(cmpInMonth(e,b)>=0){rightPopup(lang.tipDstMonth);return}}}if(isXVR()&&!f){xvr.getPlayBackStatus(function(g,i){if(g!=HTTP_OK){rightPopup(lang.savedfail)}var h=splitOkVal(i);if(h.getpbstatus&&h.getpbstatus!=0){rightPopup(lang.pb7);return}setDSTSave(true)});return}var a={timeIsDst:$("#getSummerTimetDst").is(":checked")?1:0,timeType:parseInt($(".J-summertime-type").val()),timeOffset:parseInt($("#getSummerTimeTmoffset").val()),offsetFlag:generalSetVariables.dstOffsetFlag,startYear:e.getFullYear(),startMon:e.getMonth(),startWeekType:parseInt($("#getSummerTimeStartWeekType").val()),startWeekDay:parseInt($("#getSummerTimeStartWeekday").val()),startMday:e.getDate(),startHour:e.getHours(),startMin:e.getMinutes(),endYear:b.getFullYear(),endMon:b.getMonth(),endWeekType:parseInt($("#getSummerTimeEndWeekType").val()),endWeekDay:parseInt($("#getSummerTimeEndWeekday").val()),endMday:b.getDate(),endHour:b.getHours(),endMin:b.getMinutes()};api.systemTime(REQUEST_SET,{summerTime:a},function(g,h){if(g!==CODE_SUCCESS){return}rightPopup(lang.saved)})}function dstTimeTypeChange(a){switch(a){case"0":$("#getSummerTimeStartMon,#getSummerTimeStartWeekType,#getSummerTimeStartWeekday").show();$("#startDate,#stopDate").hide();$("#getSummerTimeEndWeekType,#getSummerTimeEndWeekday,#getSummerTimeEndMon").show();break;case"1":$("#getSummerTimeStartWeekType,#getSummerTimeStartWeekday,#getSummerTimeStartMon").hide();$("#getSummerTimeEndWeekType,#getSummerTimeEndWeekday,#getSummerTimeEndMon").hide();$("#startDate,#stopDate").show();break;default:break}};