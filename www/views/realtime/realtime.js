var realtimeVariables={isShowPtz:true,channelStreamArray:[],windowPlayStatus:[],currentWindow:0,channelPlayStatus:[],channelRecordStatus:[],channelAudioStatus:[],channelZoomStatus:[],deviceChannelNum:getTotalChannelNum(),isOpenTalk:0,pureInfo:{},wsList:[]};function onLoad(){initDot();setTitle(lang.realTime);isSafari()&&(priviewVariables.showWindowNum=realtimeVariables.deviceChannelNum);initPreset();$("#deviceType").text(getDeviceName());$("#videoBlock").isPlayer({width:1920,height:1080,window:getMaxWindowNum(getEnbChNum(realtimeVariables.deviceChannelNum))}).on("contextmenu",function(a){if(isIE()){return false}});initRealtime();initRealtimeEvent();initChannelEvent(realtimeVariables.deviceChannelNum);initBtnStatus();m_bPlayAll=false;setConf("isRealtime",true)}function onBeforeunload(){setConf("isRealtime",false);m_bRecordAll=false;document.removeEventListener("webkitvisibilitychange",newHandle);window.realtime&&clearTimeout(window.realtime);$("#videoBlock").isPlayer("destroy")}function initRealtime(){var b=$("#videoBlock");b.isPlayer("initVideoWindow",getDeviceValue()).isPlayer("setDeviceChannelNum",realtimeVariables.deviceChannelNum);priviewVariables.showWindowNum=realtimeVariables.deviceChannelNum;for(var a=0;realtimeVariables.deviceChannelNum>a;a++){realtimeVariables.channelStreamArray[a]=[];realtimeVariables.windowPlayStatus[a]=-1;realtimeVariables.channelPlayStatus[a]=false;realtimeVariables.channelRecordStatus[a]=0;realtimeVariables.channelAudioStatus[a]=false}isCpuEq("CPU_3520DV400_4AHD_NRT_6158C_2G")&&$("#sound").parent().remove();isNVR()&&b.isPlayer("getTalkStatus")&&$(".J-talk").toggleClass("active");isSupportChannel();!isPure()&&monitorAction();(!isIE()&&!isFirefox())&&loading(true);setConf("selectWindowIndex",0);setConf("playAllVideo",false)}function initRealtimeEvent(){$(".J-channel-block ul li").hover(function(){$(this).children("div").hide()});$(".J-window-select p a").on("click",function(){var b=$(this).attr("data-num");showWindowNum(b)});$(".J-stream-select p a").on("click",function(){var b=$(this).attr("data-num");showStreamNum(b);$(".J-stream-select").data("stream",b)});$(".J-operate-block-right button,.J-tab-content span,.J-tab-content3 span").on("click",function(){var d=$(this).attr("data-func");if(d){var c=getFuncName(d);var b="recordAll";if(isPure()&&b.indexOf(c.func)>-1){return alert(lang.noSupport14)}window[c.func](c.param)}});$(".J-talk").on("click",function(){var b=$(this);if(isPure()){return alert(lang.noSupport14)}var c=counter(1,function(){var d,e=$("#videoBlock");if(!b.hasClass("active")){stopAllSound();realtimeVariables.isOpenTalk=1;d=e.isPlayer("talk",realtimeVariables.isOpenTalk,getTotalChannelNum(),getTalkStream());b.addClass("active")}else{realtimeVariables.isOpenTalk=0;d=e.isPlayer("talk",realtimeVariables.isOpenTalk,getTotalChannelNum(),getTalkStream());b.removeClass("active")}talkBtnStatus(d)});getTalkEncode(c)});$(".J-stretch-btn").click(function(){realtimeVariables.isShowPtz=$(this).hasClass("stretch-btns")?true:false;$(this).toggleClass("stretch-btns");onPlayWindowResize()});var a=0;$(".J-btn-block-ptz li a").on("mousedown",function(){var b=$(this).attr("data-id");a=parseInt(b)+1;ptzMouseDown(b)}).on("mouseup",function(){ptzMouseUp(a)});$(".J-input-speed").bind("keyup",function(){this.value=this.value.replace(/[^\d]/g,"")});$(".J-slide").slider({max:PTZ_SPEED,min:ZERO,value:$(".J-input-speed").val(),slide:function(b,c){$(".J-input-speed").val(c.value)}});$(".J-confirm-patrol").on("click",function(){confirmPatrol()});$(".J-cancel-patrol").on("click",function(){cancelPatrol()});$(window).resize(onPlayWindowResize).resize();document.addEventListener&&document.addEventListener("webkitvisibilitychange",newHandle);$("#playAll").on("click",function(){var b=$(this).hasClass("active")?false:true;setConf("pureAllStop",b)})}function initPreset(){initPresetConfig();$(".J-right-tab li").on("click",function(){$(".J-right-tab li a").removeClass("tabons");$(this).find("a").toggleClass("tabons");var a=$(this).attr("data-tab");showRightTab(a)}).eq(0).click()}function getAudioEncode(b,a,c){!b&&(b=0);api.audioEncode(REQUEST_GET,{channel:parseInt(b)},function(d,e){a&&a();if(d!=CODE_SUCCESS&&c){c()}$("#videoBlock").data("audioInfo",AUDIO_CODEC[e.encodeType])})}function getTalkEncode(a){api.talkEncode(REQUEST_GET,"",function(b,c){c.encodeType=AUDIO_CODEC[c.encodeType];$("#videoBlock").data("talkInfo",c);a&&a()})}function getVideoStream(b,c){b==null&&(b=1);var a=$("#videoBlock").data("videoInfo");c&&c();return a?a[b]:null}function getAudioStream(b){var a=$("#videoBlock").data("audioInfo");b&&b();return a?a:null}function getTalkStream(){var a=$("#videoBlock").data("talkInfo");return a}function isSupportChannel(){var a=getMaxWindowNum(getEnbChNum(realtimeVariables.deviceChannelNum));switch(a){case 4:$(".c3,.c4,.c5,.c6,.c7").hide();break;case 9:$(".c4,.c5,.c6,.c7").hide();break;case 16:$(".c5,.c6,.c7").hide();break;case 25:$(".c6,.c7").hide();break;case 32:case 36:$(".c7").hide();break}showWindowNum(a)}function onPlayWindowResize(){var d=$("#realTime");d.show();var j=window.innerWidth;var e=window.innerHeight;var f=0;var a=0;var i=0;var h=0;var b=0;if(typeof j!="number"){if(document.compatMode!="BackCompat"){j=document.documentElement.clientWidth;e=document.documentElement.clientHeight;if(i==0){i=e}}else{j=document.body.clientWidth;e=document.body.clientHeight}if(i>e){}e=i;f=j/screen.width;a=e/screen.height;b=(screen.width)*f;h=(screen.height)*a}else{f=j/screen.width;a=e/screen.height;b=(screen.width)*f;h=(screen.height)*a}var g=b-220-200;if(realtimeVariables.isShowPtz){g=b-220-200;$(".J-right-content").css("width","220px")}else{g=b-200-10;$(".J-right-content").css("width","10px")}d.css("width",g+"px");if(isPure()){return setCanvasWidth(null,true)}var c=parseFloat(getDpiI())/96,k=$("#videoBlock");k.isPlayer("setPluginPosition",k.width(),k.height())}function getDpiI(){var b=new Array();if(window.screen.deviceXDPI!=undefined){b[0]=window.screen.deviceXDPI;b[1]=window.screen.deviceYDPI}else{var a=document.createElement("DIV");a.style.cssText="width:1in;height:1in;position:absolute;left:0px;top:0px;z-index:99;visibility:hidden";document.body.appendChild(a);b[0]=parseInt(a.offsetWidth);b[1]=parseInt(a.offsetHeight);a.parentNode.removeChild(a)}return b[0]}function currentBtnStatus(c,a,e,b){var d="";switch(a){case BTN_NORMAL:d=c+"-btn";break;case BTN_ACTIVE:d=c+"-btns";break;case BTN_DISABLE:d=c+"-btn-disable";break}$("#"+c).removeClass().addClass(d);e&&$("#"+c).attr("title",e);b&&$("#"+c).attr("disable",b)}function talkBtnStatus(a){switch(a){case TALK_ERROR:rightPopup(lang.setFaile);break;case TALK_DEVICE_BUSY:rightPopup(lang.devBusy);break;case TALK_INSEARCH_ERROR:rightPopup(lang.insearchM);break}$(".J-talk").hasClass("active")&&(a==TALK_ERROR||a==TALK_INSEARCH_ERROR||a==TALK_DEVICE_BUSY)&&$(".J-talk").toggleClass("active")}function monitorAction(){var b=$("#videoBlock"),a="",e="",d=isIE()?parseInt(b.isPlayer("getCurrentWindow")):getConf("selectWindowIndex"),c=realtimeVariables.windowPlayStatus[d];if(c==-1||isNaN(c)){a=0;e=0}else{a=parseInt(c)+1;e=b.isPlayer("getBitRate",c)}$("#playChannel").text(a);$("#nowStatues").text(e);getSelectWindowBtnStatus(d);window.realtime=setTimeout("monitorAction()",500)}function getSelectWindowBtnStatus(i){realtimeVariables.currentWindow=i;var d=realtimeVariables.windowPlayStatus[realtimeVariables.currentWindow];var g="",c="",a=lang.closesound,b=BTN_NORMAL,j=lang.startzoom,f=BTN_NORMAL,e=lang.allrecord,h=BTN_NORMAL;if(realtimeVariables.channelPlayStatus[d]){c=false;if(priviewVariables.showWindowNum==1){g=false}if(m_bRecordAll){h=BTN_ACTIVE;e=lang.allrecstop}if(realtimeVariables.channelAudioStatus[d]){a=lang.opensound;b=BTN_ACTIVE}if(realtimeVariables.channelZoomStatus[d]){j=lang.stopzoom;f=BTN_ACTIVE}}else{c="disabled";if(priviewVariables.showWindowNum!=1){g="disabled"}}currentBtnStatus("records",h,e);currentBtnStatus("zoom",f,j);currentBtnStatus("sound",b,a)}function onBitRate(a){$("#nowStatues").text(a)}function initBtnStatus(f){var g=["records","zoom","sound"],c=["capture","prev","next"],e=f?false:"disabled",b=f?"-btn":"-btn-disable",a=f?"-btn":"-btn active";for(var d=0;d<g.length;d++){$("#"+g[d]).removeClass().addClass(g[d]+b).attr("disabled",e);$("#"+c[d]).removeClass().addClass("operate-btn "+c[d]+a).attr("disabled",e);if((c[d]=="prev"||c[d]=="next")&&parseInt(priviewVariables.showWindowNum)>1){$("#"+c[d]).addClass("active").attr("disabled",true)}}}function onImplement(){$(document).attr("title",lang.realTime)}function setSdk(){if(isPure()){loading(false);window.realtime&&clearTimeout(window.realtime);$(".J-channel-list .play").removeClass("active");setConf("selectWindowIndex",0);deviceSdk.initVariable();initPure();listenFullScreen()}}function initPure(){$(".J-plugin-block").html();var a=counter(1,function(){var b=isFirefox()?getMaxWindowNum(getEnbChNum(realtimeVariables.deviceChannelNum)):priviewVariables.showWindowNum;$(".J-plugin-block").html(dotRender("addCanvasModel",{num:b,width:realtimeVariables.pureInfo.width,height:realtimeVariables.pureInfo.height}));$(".J-pure-block").on("click",function(){$(this).addClass("active").siblings(".pure-block").removeClass("active");var e=parseInt($(this).attr("data-id"));setConf("selectWindowIndex",e);var c=realtimeVariables.windowPlayStatus[e];var d=realtimeVariables.wsList[c]>-1?parseInt(c)+1:0;$("#playChannel").html(d);getSelectWindowBtnStatus(e)})});setCanvasWidth(a)}function setCanvasWidth(f,a,e){var b=e?e:$("#videoBlock"),d=b.width(),c=b.height();switch(parseInt(priviewVariables.showWindowNum)){case 4:d=d/2-2;c=c/2-2;break;case 9:d=d/3-2;c=c/3-2;break;case 16:d=d/4-2;c=c/4-2;break;case 25:d=d/5-2;c=c/5-2;break;case 36:d=d/6-2;c=c/6-2;break;case 64:d=d/7-2;c=c/7-2;break}if(a){return resizeCanvasWidth(d,c)}realtimeVariables.pureInfo={width:d,height:c};f&&f()}function resizeCanvasWidth(c,b){for(var a=0;a<priviewVariables.showWindowNum;a++){$(".J-pure-block").eq(a).css({width:c,height:b})}}function changeCanvas(b,a){var d=".block"+a,c=b!=PLAY_MODE_H265?'<video id="v264'+a+'" class="v264 auto-fill" muted></video>':'<canvas id="c265'+a+'" class="c265" muted></canvas>';$(".J-pure-block "+d).html(c)}function monitorPlay(){if(!deviceSdk.wfs){return}var b=deviceSdk.wfs.config;for(var a=0;a<b.length;a++){if(b[a].type=="H265Raw"&&parseInt(b[a].width)>=1920&&parseInt(b[a].height)>=1080){deviceSdk.monitorPlayNum.v265++}deviceSdk.monitorPlayNum.other++}if(deviceSdk.monitorPlayNum.v265>3||deviceSdk.monitorPlayNum.other>10){return rightPopup(lang.insufficientPerformance,"",5000)}}function onStartTalk(a){a!=CODE_SUCCESS&&$("#videoBlock").isPlayer("talk",false);talkBtnStatus(a)}function onOpenSound(b){if(b!=CODE_SUCCESS){var a=realtimeVariables.windowPlayStatus[getConf("selectWindowIndex")];realtimeVariables.channelAudioStatus[a]=false;currentBtnStatus("sound",BTN_NORMAL,lang.closesound)}};