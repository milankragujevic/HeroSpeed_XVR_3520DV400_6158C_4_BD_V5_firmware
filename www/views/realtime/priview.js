var priviewVariables={isChangePage:false,isNextPage:false,isPrevPage:false,currentStream:1,currentChannel:0,currentChannelPage:CHANNEL_PAGE_INITIAL_VALUE,switchStream:false,playList:[],playIndex:0,changeStremPlay:[],pureWindowPlayStatus:[],closeIndex:0,showWindowNum:DEFAULT_WINDOW_NUM};function getMaxWindowNum(a){var a=ParseInt(a);var c=[1,4,9,16,25,36,64];for(var b=0;b<c.length;++b){if(c[b]>=a){return c[b]}}return a}function initChannelEvent(c){for(var d=0;d<c;d++){var b={};b.stream=1;realtimeVariables.channelStreamArray[d]||(realtimeVariables.channelStreamArray[d]=[]);realtimeVariables.channelStreamArray[d].push(b);if(nLiveviewDatabit[d]&&vChannelConfig[d]!=4){realtimeVariables.channelPlayStatus[d]=false}}$(".J-channel-list li").on("mouseleave",function(){$(this).children("div").hide()}).children(".stream-btn").on("mouseenter",function(){var e=$(this),f=e.parent().children("div"),a=e.attr("id").split("stream")[1];f.show().find("p").off("click").on("click",function(){var g=$(this).index();priviewVariables.switchStream=true;changeStream(a,g)})});$(".J-channel-list li .play").on("click",function(){var a=$(this).attr("id").split("play")[1];if(nLiveviewDatabit[a]==0){rightPopup(lang.nolimit);return}play(a)}).next("a").on("click",function(){$(this).prev("a").click()}).next(".record").on("click",function(){var a=$(this).attr("id").split("record")[1];record(a)})}function showWindowNum(b){if(b==1){if(m_bPlayAll){return tipConfirm(lang.stopallchange)}priviewVariables.currentChannelPage=CHANNEL_PAGE_INITIAL_VALUE}var a=b==32||b==36?36:b;priviewVariables.showWindowNum=a;setWindowStyle(a);!isPure()?$("#videoBlock").isPlayer("setPlayWindowNum",a):setCanvasWidth(null,true);priviewVariables.isChangePage=priviewVariables.showWindowNum==1?true:false;var c=parseInt(b)>1?true:false;c?$("#prev,#next").addClass("active"):$("#prev,#next").removeClass("active");$("#prev,#next").attr("disabled",c)}function setWindowStyle(a){var b="";switch(ParseInt(a)){case 1:b="window1";break;case 4:b="window-icon-btn";break;case 9:b="window9";break;case 16:b="window16";break;case 25:b="window25";break;case 32:case 36:b="window36";break;case 64:b="window64";break}$("#splitScreen").removeClass().addClass("tool-icons "+b)}function showStreamNum(f){var g=$.extend([],realtimeVariables.windowPlayStatus),h=$(".J-channel-list .active").length!==0,k=$("#videoBlock");priviewVariables.changeStremPlay=[];if(m_bRecordAll){isIE()?k.isPlayer("stopAllRec"):k.isPlayer("stopRec",-1);m_bRecordAll=false}if(m_bPlayAll){priviewVariables.isChangePage=priviewVariables.showWindowNum==1?true:false;if(isIE()){k.isPlayer("stopAllVideo")}else{window.realtime&&clearTimeout(window.realtime);k.isPlayer("stopPreview",-1)}m_bPlayAll=false;$("#playAll").toggleClass("active").attr("title",lang.allplay);for(var e=0;e<realtimeVariables.deviceChannelNum;e++){realtimeVariables.channelAudioStatus[e]=false;realtimeVariables.channelPlayStatus[e]=false;realtimeVariables.windowPlayStatus[e]=-1;realtimeVariables.channelZoomStatus[e]=false;realtimeVariables.channelRecordStatus[e]=0;$("#play"+e).removeClass("active").attr("title",lang.play);$("#record"+e).removeClass().addClass("record").attr("title",lang.starRecord)}}priviewVariables.currentStream=f;priviewVariables.playIndex=0;var m=0;for(var e=0;e<g.length;++e){var a=parseInt(g[e]);if(a==-1){continue}++m;if(e<priviewVariables.showWindowNum){if(isIE()){k.isPlayer("getCurrentWindow",e);k.isPlayer("setHttpPort").isPlayer("startPreview",priviewVariables.currentStream,a)}else{priviewVariables.changeStremPlay.push({ch:a,wnd:e});realtimeVariables.wsList.push(e)}realtimeVariables.channelPlayStatus[g[e]]=true;realtimeVariables.windowPlayStatus[e]=a;var c="#play"+a;$(c).addClass("active").attr("title",lang.stop)}}if(m===0){var b=Math.min(priviewVariables.showWindowNum,realtimeVariables.deviceChannelNum);isIE()&&k.isPlayer("startAllPreview",f,b);for(var e=0;e<priviewVariables.showWindowNum;e++){realtimeVariables.channelPlayStatus[e]=true;realtimeVariables.windowPlayStatus[e]=e;if(!isIE()){priviewVariables.changeStremPlay.push({ch:e,wnd:e});realtimeVariables.wsList.push(e)}var c="#play"+e;$(c).addClass("active").attr("title",lang.stop)}}m_bPlayAll=true;initBtnStatus(true);setConf("changeStremPlayVideo",true);isMiddleware()&&changeStremVideoPlay();isPure()&&pureStopAllPlay();$("#playAll").toggleClass("active").attr("title",lang.allstop);for(var d=0;d<realtimeVariables.deviceChannelNum;d++){var l="#stream"+d;$(l).removeClass().addClass("stream"+f);realtimeVariables.channelStreamArray[d][0].stream=f}$("#changeStream").removeClass().addClass("tool-icons stream-icon-btn"+(ParseInt(f)+1))}function playAll(f){var e=$("#videoBlock");if(priviewVariables.showWindowNum==1){priviewVariables.isChangePage=true}if(priviewVariables.currentChannelPage==CHANNEL_PAGE_INITIAL_VALUE){priviewVariables.currentChannelPage=0}priviewVariables.playIndex=0;priviewVariables.playList=[];if(isPlayingLabel()&&!f){m_bPlayAll=true}if(!m_bPlayAll){var c=Math.min(priviewVariables.showWindowNum,realtimeVariables.deviceChannelNum);for(var d=0;d<priviewVariables.showWindowNum;d++){if(nLiveviewDatabit[d]==0){rightPopup(lang.nolimit);continue}realtimeVariables.channelPlayStatus[d]=true;realtimeVariables.windowPlayStatus[d]=d;var g="#play"+d;$(g).addClass("active").attr("title",lang.stop)}for(var b=0;b<realtimeVariables.deviceChannelNum;b++){var h="#stream"+b;$(h).removeClass().addClass("stream"+priviewVariables.currentStream);realtimeVariables.channelStreamArray[b][0].stream=priviewVariables.currentStream;if(!isIE()&&b<c){priviewVariables.playList.push(b)}}if(isIE()){e.isPlayer("startAllPreview",priviewVariables.currentStream,c)}if(!isIE()){playAllVideo()}m_bPlayAll=true;$("#playAll").addClass("active");initBtnStatus(true)}else{initBtnStatus();setConf("playAllVideo",false);$("#playAll").removeClass("active");priviewVariables.currentChannelPage=CHANNEL_PAGE_INITIAL_VALUE;m_bRecordAll=false;m_bPlayAll=false;for(var d=0;d<realtimeVariables.deviceChannelNum;d++){realtimeVariables.channelAudioStatus[d]=false;realtimeVariables.channelPlayStatus[d]=false;realtimeVariables.windowPlayStatus[d]=-1;realtimeVariables.channelZoomStatus[d]=false;var g="#play"+d;$(g).removeClass("active").attr("title",lang.play);var a="#record"+d;realtimeVariables.channelRecordStatus[d]=0;$(a).removeClass().addClass("record").attr("title",lang.starRecord)}if(isPure()){return pureStopAllPlay()}isIE()?e.isPlayer("stopAllRec").isPlayer("stopAllVideo"):e.isPlayer("stopPreview",-1)}}function isPlayingLabel(){var a=false;$(".J-channel-list .play").each(function(){if($(this).hasClass("active")){a=true;return false}});return a}function setLoopPlay(d,e,a,c){if(nLiveviewDatabit[d]==0){rightPopup(lang.nolimit);return}var b=$("#videoBlock");e==null&&(e=priviewVariables.currentStream);c==null&&(c=realtimeVariables.currentWindow);getPlayEncodeInfo(d,function(g,h,f){if(g!=CODE_SUCCESS&&(getConf("playAllVideo")||getConf("changeStremPlayVideo"))){return onStartPlay()}!a&&b.isPlayer("stopPreview",d);!isIE()&&$("#play"+d).addClass("active");b.isPlayer("startPreview",e,d,c,h[e],f)})}function playAllVideo(){setConf("playAllVideo",true);var a=priviewVariables.playList[priviewVariables.playIndex];if(a==null){return setConf("playAllVideo",false)}if(!isPure()){return setLoopPlay(a,priviewVariables.currentStream,true,a)}if(nLiveviewDatabit[a]==0){return}play(a,true,a)}function onStartPlay(){if(getConf("playAllVideo")){$("#playAll").addClass("active");priviewVariables.playIndex++;if(priviewVariables.playIndex>=priviewVariables.playList.length){monitorPlay();return setConf("playAllVideo",false)}if(!isPure()){return setLoopPlay(priviewVariables.playIndex,priviewVariables.currentStream,true,priviewVariables.playIndex)}play(priviewVariables.playIndex,true,priviewVariables.playIndex)}if(getConf("changeStremPlayVideo")&&isMiddleware()){var b=priviewVariables.changeStremPlay,a=b.length;priviewVariables.playIndex++;priviewVariables.playIndex<a?setLoopPlay(b[priviewVariables.playIndex].ch,priviewVariables.currentStream,true,b[priviewVariables.playIndex].wnd):setConf("changeStremPlayVideo",false)}}function changeStremVideoPlay(){var a=priviewVariables.changeStremPlay[priviewVariables.playIndex];a!=null?setLoopPlay(a.ch,priviewVariables.currentStream,true,a.wnd):setConf("changeStremPlayVideo",false)}function play(e,a,d,f){if(nLiveviewDatabit[e]==0){rightPopup(lang.nolimit);return}var b=$("#videoBlock"),c=0;if(isIE()){c=b.isPlayer("getCurrentWindow");realtimeVariables.currentWindow=c;playStep(e,c)}else{c=getConf("selectWindowIndex")?getConf("selectWindowIndex"):0;if(a){c=d}realtimeVariables.currentWindow=c;getPlayEncodeInfo(e,function(g){if(g!=CODE_SUCCESS){return onStartPlay()}if(isPure()){if(!$("#play"+e).hasClass("active")){var h=realtimeVariables.windowPlayStatus[c];if(h!=-1){var h=h;sendStopMessage(getWsListIndex(h));$("#play"+h).removeClass("active").attr("title",lang.play)}}setTimeout(function(){realtimeVariables.channelPlayStatus[e]=true;var i=$("#stream"+e).attr("class"),j=["stream-btn","stream1"];stream=j.indexOf(i)>-1?1:0;purePlay(e,stream,c,a,f)},500)}else{playStep(e,c)}})}}function playStep(f,e){var c=$("#videoBlock");var g="#play"+f;for(var b=0;b<realtimeVariables.deviceChannelNum;b++){if(realtimeVariables.windowPlayStatus[b]==f&&realtimeVariables.channelPlayStatus[f]){if(realtimeVariables.channelRecordStatus[f]){var a="#record"+f;realtimeVariables.channelRecordStatus[f]=0;$(a).toggleClass("active").attr("title",lang.starRecord)}if(realtimeVariables.channelAudioStatus[f]){realtimeVariables.channelAudioStatus[f]=false;currentBtnStatus("sound",BTN_NORMAL,lang.closesound)}if(realtimeVariables.channelZoomStatus[f]){realtimeVariables.channelZoomStatus[f]=false;currentBtnStatus("zoom",BTN_NORMAL,lang.startzoom)}m_bRecordAll=false;c.isPlayer("stopPreview",f);realtimeVariables.channelPlayStatus[f]=false;realtimeVariables.windowPlayStatus[b]=-1;$("#play"+f).toggleClass("active").attr("title",lang.play);$("#playAll").toggleClass("active").attr("title",lang.allplay);m_bPlayAll=false;for(var b=0;b<realtimeVariables.deviceChannelNum;b++){if(realtimeVariables.channelPlayStatus[b]){$("#playAll").toggleClass("active").attr("title",lang.allstop);if(priviewVariables.showWindowNum==1){priviewVariables.isChangePage=true}initBtnStatus();m_bPlayAll=true;break}}return}if(realtimeVariables.windowPlayStatus[e]==b){if(!realtimeVariables.channelPlayStatus[f]){var d="#play"+b;if(realtimeVariables.channelRecordStatus[b]){var a="#record"+b;realtimeVariables.channelRecordStatus[b]=0;$(a).toggleClass("active").attr("title",lang.starRecord)}if(realtimeVariables.channelAudioStatus[b]){realtimeVariables.channelAudioStatus[b]=false}if(realtimeVariables.channelZoomStatus[b]){realtimeVariables.channelZoomStatus[b]=false}m_bRecordAll=false;c.isPlayer("stopPreview",b);realtimeVariables.channelPlayStatus[b]=false;realtimeVariables.windowPlayStatus[e]=-1;$(d).toggleClass("active").attr("title",lang.play);if(b==f){m_bPlayAll=false;$("#playAll").toggleClass("active").attr("title",lang.allplay);for(var b=0;b<realtimeVariables.deviceChannelNum;++b){if(realtimeVariables.channelPlayStatus[b]){$("#playAll").toggleClass("active").attr("title",lang.allstop);if(priviewVariables.showWindowNum==1){priviewVariables.isChangePage=true}m_bPlayAll=true;break}}return}break}}}if(!realtimeVariables.channelPlayStatus[f]){if(priviewVariables.showWindowNum==1&&priviewVariables.isChangePage){m_bRecordAll=false;if(priviewVariables.currentChannelPage==CHANNEL_PAGE_INITIAL_VALUE){priviewVariables.currentChannelPage=0}priviewVariables.isPrevPage=false;priviewVariables.isNextPage=false;priviewVariables.isChangePage=true}priviewVariables.isChangePage=false;$(g).addClass("active").attr("title",lang.stop);realtimeVariables.channelPlayStatus[f]=true;realtimeVariables.windowPlayStatus[e]=f;var h=realtimeVariables.channelStreamArray[f][0].stream;isIE()&&c.isPlayer("setHttpPort");c.isPlayer("startPreview",h,f,e,getVideoStream(h),getAudioStream());m_bPlayAll=true;$("#playAll").addClass("active").attr("title",lang.allstop);initBtnStatus(true);if(priviewVariables.showWindowNum==1){priviewVariables.isChangePage=true}}else{realtimeVariables.channelZoomStatus[f]=false;realtimeVariables.channelPlayStatus[f]=false;realtimeVariables.windowPlayStatus[e]=-1;$(g).toggleClass("active").attr("title",lang.play);if(realtimeVariables.channelRecordStatus[f]){var a="#record"+f;c.isPlayer("startRec",f,e);realtimeVariables.channelRecordStatus[f]=0;$(a).toggleClass("active").attr("title",lang.starRecord)}if(realtimeVariables.channelAudioStatus[f]){realtimeVariables.channelAudioStatus[f]=false}if(realtimeVariables.channelZoomStatus[f]){realtimeVariables.channelZoomStatus[f]=false}c.isPlayer("stopPreview",f);$("#playAll").toggleClass("active").attr("title",lang.allplay);m_bPlayAll=false;for(var b=0;b<realtimeVariables.deviceChannelNum;b++){if(realtimeVariables.channelPlayStatus[b]){$("#playAll").toggleClass("active").attr("title",lang.allstop);if(priviewVariables.showWindowNum==1){priviewVariables.isChangePage=true}m_bPlayAll=true;break}}}priviewVariables.isPrevPage=false;priviewVariables.isNextPage=false;priviewVariables.currentChannelPage=f;c.isPlayer("getWindowInfo",function(i){setConf("selectChannel",i.channel)})}function recordAll(){if(!m_bPlayAll){return}priviewVariables.playIndex=0;var d=BTN_ACTIVE,b=lang.allrecstop,e=lang.endRecord;$("#records").data("isRecordAll",true);isIE()&&$("#videoBlock").isPlayer(!m_bRecordAll?"startAllRec":"stopAllRec");for(var c=0;c<realtimeVariables.deviceChannelNum;c++){var a="#record"+c;realtimeVariables.channelRecordStatus[c]=!m_bRecordAll?1:0;$(a).toggleClass("active").attr("title",e)}if(!m_bRecordAll){m_bRecordAll=true;$("#records").data("isRecordAll",true);isMiddleware()&&$("#videoBlock").isPlayer("startRec",realtimeVariables.windowPlayStatus[priviewVariables.playIndex],priviewVariables.playIndex)}else{m_bRecordAll=false;d=BTN_NORMAL;b=lang.allrecord;e=lang.starRecord;$("#videoBlock").isPlayer("stopRec",-1);$("#records").data("isRecordAll",false)}currentBtnStatus("records",d,b)}function onRecord(a){if($("#records").data("isRecordAll")){priviewVariables.playIndex++;if(priviewVariables.playIndex>=getDevConf("channelTotalNum")){return $("#records").data("isRecordAll",false)}$("#videoBlock").isPlayer("startRec",realtimeVariables.windowPlayStatus[priviewVariables.playIndex],priviewVariables.playIndex)}}function record(d){if(isPure()){return alert(lang.noSupport14)}var a="#record"+d;if(realtimeVariables.channelPlayStatus[d]){var e=lang.endRecord,c=realtimeVariables.channelRecordStatus[d]==1?true:false;$("#videoBlock").isPlayer("startRec",d,realtimeVariables.currentWindow,c);if(!realtimeVariables.channelRecordStatus[d]){m_bRecordAll=true;realtimeVariables.channelRecordStatus[d]=1}else{realtimeVariables.channelRecordStatus[d]=0;m_bRecordAll=false;for(var b=0;b<realtimeVariables.deviceChannelNum;b++){if(realtimeVariables.channelRecordStatus[b]){m_bRecordAll=true;break}}e=lang.starRecord}$(a).toggleClass("active").attr("title",e)}}function capture(){var c=getConf("selectWindowIndex"),b=realtimeVariables.windowPlayStatus[c];if(isPure()){var a="",d="";$(".J-pure-block").each(function(){var e=$(this).attr("class");if(e.indexOf("active")>-1){a=$(this).find("div").children().attr("id");return}});d=$("#"+a)[0];return deviceSdk.capture(c,function(e){e&&downImgFromDataUrl(e)},getWsListIndex(b),d)}$("#videoBlock").isPlayer("capture",b,c)}function sound(){if($(".J-talk").hasClass("active")){return}var c=getConf("selectWindowIndex"),b=realtimeVariables.windowPlayStatus[c];if(isPure()){return pureSound(getWsListIndex(b))}for(var a=0;a<realtimeVariables.deviceChannelNum;a++){if(realtimeVariables.channelAudioStatus[a]){if(b!=a){!isPure()?$("#videoBlock").isPlayer("audio",isIE()?a:false,c):deviceSdk.stopAudio(getWsListIndex(b));realtimeVariables.channelAudioStatus[a]=false;currentBtnStatus("sound",BTN_NORMAL,lang.closesound)}}}setTimeout(function(){var e=realtimeVariables.channelAudioStatus[b];var d=!isPure()?$("#videoBlock").isPlayer("audio",isIE()?b:!e,c):true,f,g;if(!realtimeVariables.channelAudioStatus[b]){f=BTN_ACTIVE;g=lang.opensound}else{f=BTN_NORMAL;g=lang.closesound}realtimeVariables.channelAudioStatus[b]=d;currentBtnStatus("sound",f,g)},500)}function checkAudioStatus(b,c,d){var a=false;api.audioEncode(REQUEST_GET,{channel:parseInt(b)},function(e,f){a=f.enable;if(isXVR()&&!a){api.videoEncode(REQUEST_GET,{channel:parseInt(b)},function(h,g){var k=g.streamEncode;for(var j=0;j<k.length;j++){if(k[j].streamNo==c){a=k[j].streamType==1?true:false;break}}$("#videoBlock").data("audioEnable",a);d&&d()})}else{$("#videoBlock").data("audioEnable",a);d&&d()}})}function zoom(){var e=getConf("selectWindowIndex"),d=realtimeVariables.windowPlayStatus[e],b=true,a=BTN_ACTIVE,f=lang.stopzoom;if(realtimeVariables.channelZoomStatus[d]){b=false;a=BTN_NORMAL;f=lang.startzoom}realtimeVariables.channelZoomStatus[d]=b;currentBtnStatus("zoom",a,f);if(getLocalServerWebsocketStatus()){return pureZoom(b)}var c=isIE()?d:e;$("#videoBlock").isPlayer("zoom",c,b)}function fullscreen(){$("#videoBlock").isPlayer("setFullScreenMulti").isPlayer("setFullScreen")}function changeStream(d,e){var c=$("#videoBlock");if(realtimeVariables.channelPlayStatus[d]){var f="#stream"+d,b=ParseInt(e);$(f).removeClass().addClass("stream"+b);realtimeVariables.channelStreamArray[d][0].stream=e;if(realtimeVariables.channelRecordStatus[d]){var a="#record"+d;realtimeVariables.channelRecordStatus[d]=0;$(a).toggleClass("active").attr("title",lang.starRecord)}if(realtimeVariables.channelAudioStatus[d]){realtimeVariables.channelAudioStatus[d]=false}if(realtimeVariables.channelZoomStatus[d]){c.isPlayer("zoom",d);realtimeVariables.channelZoomStatus[d]=false}m_bRecordAll=false;if(isIE()){c.isPlayer("setHttpPort").isPlayer("startPreview",e,d)}else{if(isPure()){sendStopMessage(getWsListIndex(d));realtimeVariables.wsList[getWsListIndex(d)]&&delete realtimeVariables.wsList[getWsListIndex(d)];setTimeout(function(){purePlay(d,e)},5000)}else{setLoopPlay(d,e,true)}}$(".J-channel-block ul li").children("div").hide()}}function pageTurning(f){if(ISCLICK){ISCLICK=false;if(!priviewVariables.isChangePage){return}var k=$(".J-channel-list a.active"),g=$("#videoBlock");if(k.length===0){var c=f?$(".J-channel-list a.play").eq(0):$(".J-channel-list a.play").last();priviewVariables.currentChannelPage=ParseInt(c.attr("id").substr(4))}else{var h=k.parent();var e=f?h.prev():h.next();if(e.length===0){priviewVariables.currentChannelPage=ParseInt($(".J-channel-list a.play").eq(0).attr("id").substr(4))}else{priviewVariables.currentChannelPage=ParseInt(e.find("[id^=play]").attr("id").substr(4))}}var d=null;var a=null;priviewVariables.isPrevPage=!f;priviewVariables.isNextPage=f;isIE()&&g.isPlayer("stopAllRec").isPlayer("stopAllVideo");isMiddleware()&&g.isPlayer("stopRec",-1).isPlayer("stopPreview",-1);isPure()&&pureStopAllPlay(function(){play(priviewVariables.currentChannelPage,null,null,true)},true);m_bPlayAll=false;m_bRecordAll=false;$("#playAll").removeClass("active");for(var b=0;b<realtimeVariables.deviceChannelNum;b++){realtimeVariables.channelAudioStatus[b]=false;realtimeVariables.channelZoomStatus[b]=false;realtimeVariables.channelRecordStatus[b]=0;realtimeVariables.channelPlayStatus[b]=false;d="#record"+b;a="#play"+b;$(d).removeClass("active").attr("title",lang.starRecord);$(a).removeClass("active").attr("title",lang.play)}a="#play"+priviewVariables.currentChannelPage;$(a).addClass("active").attr("title",lang.stop);$("#playAll").addClass("active").attr("title",lang.allstop);m_bPlayAll=true;realtimeVariables.channelPlayStatus[priviewVariables.currentChannelPage]=true;realtimeVariables.windowPlayStatus[0]=priviewVariables.currentChannelPage;var j=realtimeVariables.channelStreamArray[priviewVariables.currentChannelPage][0].stream;isIE()&&g.isPlayer("setHttpPort").isPlayer("startPreview",j,priviewVariables.currentChannelPage);if(!isIE()){realtimeVariables.windowPlayStatus[0]=-1;realtimeVariables.channelPlayStatus[priviewVariables.currentChannelPage]=false;isMiddleware()&&play(priviewVariables.currentChannelPage)}setTimeout(function(){ISCLICK=true},1500)}}function onSelectWindowChange(a){}function stopAllSound(){var c=getConf("selectWindowIndex"),b=realtimeVariables.windowPlayStatus[c];for(var a=0;a<realtimeVariables.deviceChannelNum;a++){if(realtimeVariables.channelAudioStatus[a]){!isPure()?$("#videoBlock").isPlayer("audio",isIE()?a:false,c):deviceSdk.stopAudio(getWsListIndex(b));realtimeVariables.channelAudioStatus[a]=false;currentBtnStatus("sound",BTN_NORMAL,lang.closesound)}}}function purePlay(h,k,i,j,d){k==null&&(k=1);var e=$("#videoBlock").data("videoInfo")[k],f=$("#videoBlock").data("audioInfo"),a=i?i:getConf("selectWindowIndex"),c=getWsListIndex(h);if(!$("#play"+h).hasClass("active")||priviewVariables.switchStream||j||d){var g=PLAY_MODE_H265,b="H265Raw",l="c265"+a;if((!e||e.videoCode==VIDEO_CODEC.mjpeg)&&getConf("playAllVideo")){return onStartPlay()}switch(e.videoCode){case VIDEO_CODEC.h264:g=PLAY_MODE_H264;b="H264Raw";l="v264"+a;break;case VIDEO_CODEC.mjpeg:rightPopup(lang.mjpegTip);break}changeCanvas(g,a);$("#videoBlock").isPlayer("setPlayMode",g);realtimeVariables.wsList.length<=priviewVariables.showWindowNum&&realtimeVariables.wsList.push(h);deviceSdk.init({tags:l,deviceIp:String(getHost()),devicePort:String(getHttpPort()),width:e.width,height:e.height,audioCode:f==2?17:16,videoCode:b,loginMode:1,onCallback:onPureMsg,sessionID:getCookie(USER_ID)});if(parseInt(e.width)>1920||parseInt(e.height)>1080){rightPopup(lang.useControl)}deviceSdk.play(false,h,k,c);realtimeVariables.windowPlayStatus[a]=h;$("#play"+h).addClass("active").attr("title",lang.stop);$("#playAll").addClass("active").attr("title",lang.stop);initBtnStatus(true);priviewVariables.switchStream=false;m_bPlayAll=true}else{$("#play"+h).removeClass("active").attr("title",lang.play);deviceSdk.stopAudio(c);sendStopMessage(c);initBtnStatus();realtimeVariables.channelPlayStatus[h]=false;realtimeVariables.windowPlayStatus[a]=-1;m_bPlayAll=isPlaying();!m_bPlayAll&&$("#playAll").removeClass("active").attr("title",lang.allplay)}}function isPlaying(){var b=false;for(var a=0;a<realtimeVariables.channelPlayStatus.length;a++){if(realtimeVariables.channelPlayStatus[a]){b=true;break}}return b}function pureSound(c){var b=realtimeVariables.windowPlayStatus[getConf("selectWindowIndex")];if(b==-1){return}if($("#sound").hasClass("sound-btn")){pureStopOthereSound();var a="",d=counter(1,function(){a=$("#videoBlock").data("audioEnable");soundStatus=a?BTN_ACTIVE:BTN_NORMAL;title=a?lang.opensound:lang.closesound;realtimeVariables.channelAudioStatus[b]=a;currentBtnStatus("sound",soundStatus,title);if(!a){return}deviceSdk.playAudio(c);$("#sound").removeClass().addClass("sound-btns").attr("title",lang.closesound)});checkAudioStatus(b,realtimeVariables.channelStreamArray[b][0].stream,d)}else{deviceSdk.stopAudio(c);realtimeVariables.channelAudioStatus[b]=false;$("#sound").removeClass().addClass("sound-btn").attr("title",lang.opensound)}}function pureStopOthereSound(){var b=deviceSdk.wfs.config;for(var a=0;a<b.length;a++){if(b[a]){b[a].openSound&&deviceSdk.stopAudio(a);realtimeVariables.channelAudioStatus[realtimeVariables.wsList[a]]=false}}}function downImgFromDataUrl(c){var a=document.createElement("a"),e=new Date(),b=e.toLocaleDateString()+"_"+e.getHours()+"_"+e.getMinutes()+"_"+e.getSeconds();a.href=!isSafari()?URL.createObjectURL(dataURLtoBlob(c)):c;a.download=b+".jpeg";var d=document.createEvent("MouseEvents");d.initMouseEvent("click",true,false,window,0,0,0,0,0,false,false,false,false,0,null);a.dispatchEvent(d)}function dataURLtoBlob(c){var a=c.split(","),e=a[0].match(/:(.*?);/)[1],b=atob(a[1]),f=b.length,d=new Uint8Array(f);while(f--){d[f]=b.charCodeAt(f)}return new Blob([d],{type:e})}function pureZoom(b){var c="canvasEnlarge"+getConf("selectWindowIndex");$("#"+c).show();var a=$("#"+c).prev().children().attr("id");deviceSdk.enlarge(c,b,a)}function listenFullScreen(){if(typeof window.screenX==="number"){var b=document.querySelector("#fullscreen"),a=document.querySelector(".J-plugin-block");b.addEventListener&&b.addEventListener("click",function(){if(runPrefixMethod(document,"FullScreen")||runPrefixMethod(document,"IsFullScreen")){runPrefixMethod(document,"CancelFullScreen")}else{if(!runPrefixMethod(a,"RequestFullScreen")){}}$(".J-plugin-block").hide();setTimeout(function(){$(".J-plugin-block").show();setCanvasWidth(null,true,$(".J-plugin-block"))},500)});document.addEventListener("fullscreenchange",function(){if(!document.fullscreenElement){setCanvasWidth(null,true,$(".J-plugin-block"))}})}}function runPrefixMethod(a,c){var b;["webkit","moz","ms","o",""].forEach(function(e){if(b){return}if(e===""){c=c.slice(0,1).toLowerCase()+c.slice(1)}var d=typeof a[e+c];if(d+""!=="undefined"){b=d==="function"?a[e+c]():a[e+c]}});return b}function getWsListIndex(b){for(var a=0;a<realtimeVariables.wsList.length;a++){if(b==realtimeVariables.wsList[a]){return a}}}function onPureMsg(a,d,b){switch(a){case"open":onStartPlay();break;case"close":delete realtimeVariables.wsList[priviewVariables.closeIndex];if(getConf("pureAllStop")){priviewVariables.closeIndex++;if(!realtimeVariables.wsList[priviewVariables.closeIndex]){return setConf("pureAllStop",false)}realtimeVariables.wsList[priviewVariables.closeIndex]&&deviceSdk.stopVideo(priviewVariables.closeIndex)}break;case"code":loading(false);var c=getDeviceCode(d.code);d.code!=CODE_SUCCESS&&rightPopup(c);break;case"video":break}}function pureStopAllPlay(d,c){var a=0;var b=setInterval(function(){if(a<realtimeVariables.wsList.length){sendStopMessage(a);a++}else{clearInterval(b);deviceSdk.clientNum=0;deviceSdk.monitorPlayNum={v265:0,other:0};if(deviceSdk.wfs){deviceSdk.wfs.initWebsocketData();deviceSdk.wfs.config=[];realtimeVariables.wsList=[]}if(getConf("changeStremPlayVideo")&&!c){m_bPlayAll=false;playAll(true)}d&&d()}},500)}function sendStopMessage(a){if(!deviceSdk.wfs){return}deviceSdk.wfs.sendMessage(a,{action:"stop",data:{sessionID:getCookie(USER_ID)}});setTimeout(function(){deviceSdk.stopVideo(a)},500)};