var pwdResetVariable={checkCode:"",encryptionType:"sha256-1"};$(commonInit(init));function init(){initDot();setTitle(lang.forgetPwd);window.api=new api();if(versionconfig.type.indexOf("XVR")>-1){$(".logo").addClass("logo-xvr").removeClass("logo")}$(".J-back").on("click",function(){window.location.href=URL_LOGIN});$(".J-import-btn").on("click",function(){secretKey()});$(".J-btn-next").on("click",function(){nextStep()});$(".J-btn-pre").on("click",function(){preStep()});$(".J-btn-cancel").on("click",function(){clearAll()});$(".J-re-login").on("click",function(){window.location.href=URL_LOGIN});$(".J-identify-way").change(function(){$(".J-import-key, .J-question").hide();var a=$(this).val()==1?"J-import-key":"J-question";$(".J-tip-error").hide();$("."+a).show();$(".J-btn-next").prop("disabled",a==="J-question"?false:true)})}function preStep(){$(".J-first-page").show();$(".J-btn-pre").hide();$(".J-second-page").hide();$(".J-flow-path div.circle").addClass("gray").eq(0).removeClass("gray");$(".J-flow-path div.rectangle").addClass("gray").eq(0).removeClass("gray")}function nextStep(){$(".J-tip-error").hide();if($(".J-first-page:visible").length!==0){firstNext()}else{if($(".J-second-page:visible").length!==0){secondNext()}else{thirdNext()}}setTimeout(function(){$(".J-btn-next").prop("disabled",false)},1000)}function firstNext(){var a=ParseInt($(".J-identify-way").val());if(a==0){if(checkEmpty($(".J-tip-error"),$(".J-first-page"))){return}}$(".J-btn-pre").show();goNext()}function secretKey(){window.encContent=null;if(isIE()){var b=function(){var c=document.getElementById("plugin");return c?c:{}};var a=b().brwoseFileName(2);$("#uploadFileName").val("");if(a){a=a.split("*");$("#uploadFileName").val(a[0]);a[1]&&(window.encContent=a[1])}$(".J-btn-next").prop("disabled",window.encContent?false:true);return false}$("#upload").click().on("change",function(){var d=$("#upload").val(),e=d.length,f=0;f=d.indexOf("/")!=-1?d.lastIndexOf("/"):d.lastIndexOf("\\");f<=-1?f=0:f+=1;d=d.substring(f,e);if(d.split(".")[1]!="hs"){return rightPopup(lang.formatError)}$("#uploadFileName").val(d);var c=new FileReader();c.onload=function(){if(c.result){window.encContent=c.result;$(".J-btn-next").prop("disabled",window.encContent?false:true)}};c.readAsText($(this)[0].files[0])})}function clearAll(){$(".J-tip-error").hide();if($(".J-first-page:visible").length!==0){$(".J-question-select").val(0);$(".file-name").val(0);$("input[type='text'],input[type='password']").val("");$("#uploadFileName").val("");var a=$(".J-identify-way").val()==1?"J-import-key":"J-question";$(".J-btn-next").prop("disabled",a==="J-question"?false:true)}else{if($(".J-second-page:visible").length!==0){$(".J-new-pwd,.J-confirm-pwd").val("")}}}function goNext(){$(".J-next").hide();$(".J-second-page, .J-page-foot").show();$(".J-flow-path div.circle").addClass("gray").eq(1).removeClass("gray");$(".J-flow-path div.rectangle").addClass("gray").eq(1).removeClass("gray")}function goNextTwo(){$(".J-next").hide();$(".J-third-page").show();$(".J-flow-path div.circle").addClass("gray").eq(2).removeClass("gray");$(".J-flow-path div.rectangle").addClass("gray");$(".J-page-foot input[type='button']").hide().eq(3).show()}function secondNext(){var f=$(".J-new-pwd").val();var j=$(".J-confirm-pwd").val();if(0<checkEmpty($(".J-tip-error"),$(".J-second-page"))){return}else{if(f!==j){return rightPopup(lang.pwdTips1)}else{if(!checkUserPwdValid(f)){return rightPopup(lang.nosupport)}else{if(!passwordLevel(f)){return rightPopup(lang.pwdTips8)}}}}var e=$("#question1").val(),a=$("#question2").val(),i=$("#question3").val(),c=$("#answer1").val(),k=$("#answer2").val(),g=$("#answer3").val();var b=$(".J-identify-way").val()==1?true:false;var h=roundOne();if(!b){var h=roundOne();var d={encryptionType:pwdResetVariable.encryptionType,datetime:h[1]};api.getCheckCode(REQUEST_GET,d,function(m,n){if(m!=CODE_SUCCESS){return}pwdResetVariable.checkCode=n.key;var l={encryptionType:n.key,datetime:h[1],iv:"afe13ds34cdjk08c",question1:Number(e),answer1:encrypt(c,pwdResetVariable.checkCode),question2:Number(a),answer2:encrypt(k,pwdResetVariable.checkCode),question3:Number(i),answer3:encrypt(g,pwdResetVariable.checkCode),passwordStrength:parseInt(passwordLevel(f)),newPassword:encrypt(f,pwdResetVariable.checkCode)};api.questionRecover(REQUEST_SET,l,function(o,p){if(o!=CODE_SUCCESS){return rightPopup(lang.setFaile)}goNextTwo()})})}else{var h=roundOne();var d={encryptionType:pwdResetVariable.encryptionType,datetime:h[1]};api.getCheckCode(REQUEST_GET,d,function(m,n){if(m!=CODE_SUCCESS){return}pwdResetVariable.checkCode=n.key;var l={encryptionType:pwdResetVariable.encryptionType,datetime:h[1],iv:"afe13ds34cdjk08c",importKey:window.encContent,passwordStrength:parseInt(passwordLevel(f)),newPassword:encrypt(f,pwdResetVariable.checkCode)};api.secretKeyRecover(REQUEST_SET,l,function(o,p){if(o!=CODE_SUCCESS){return rightPopup(lang.setFaile)}goNextTwo()})})}}function getCheckCode(){var a=roundOne();var b={encryptionType:pwdResetVariable.encryptionType,datetime:a[1]};api.getCheckCode(REQUEST_GET,b,function(c,d){if(c!=CODE_SUCCESS){return}pwdResetVariable.checkCode=d.key})};